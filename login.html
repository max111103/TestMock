<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SCM System - Weblike</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f7fa;
            color: #333;
        }

        /* Layout */
        .app-container {
            display: grid;
            grid-template-columns: auto 1fr;
            height: 100vh;
        }

        .app-container.panel-active {
            grid-template-columns: auto 1fr 350px;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: #1e293b;
            /* dark navy */
            color: #fff;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
        }

        .logo {
            padding: 16px 32px;
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo-title {
            flex: 1;
            white-space: nowrap;
        }

        .icon-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            background: transparent;
            cursor: pointer;
            transition: opacity .2s, transform .2s, background-color .2s;
            color: #6b7280;
            /* gray tone */
            flex-shrink: 0;
        }

        .icon-btn svg {
            width: 28px;
            height: 28px;
            stroke: currentColor;
        }

        .icon-btn:hover {
            opacity: 0.8;
            background-color: #f3f4f6;
        }

        .icon-btn:active {
            transform: scale(0.98);
        }

        /* Icon button for CSV and FAX */
        .icon-btn-csv {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #059669;
            border-radius: 8px;
            background: #059669;
            cursor: pointer;
            transition: all 0.2s;
            color: #ffffff;
            flex-shrink: 0;
            margin-left: 8px;
        }

        .icon-btn-fax {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
            cursor: pointer;
            transition: all 0.2s;
            color: #374151;
            flex-shrink: 0;
            margin-left: 8px;
        }

        .icon-btn-csv:hover:not(:disabled) {
            background: #047857;
            border-color: #047857;
        }

        .icon-btn-fax:hover:not(:disabled) {
            background: #e5e7eb;
            border-color: #d1d5db;
        }

        .icon-btn-csv:disabled,
        .icon-btn-fax:disabled {
            background: #e0e1e4 !important;
            color: #9ca3af !important;
            border-color: #e5e7eb !important;
            cursor: not-allowed !important;
        }

        .icon-btn-csv svg,
        .icon-btn-fax svg {
            width: 25px;
            height: 25px;
            stroke: currentColor;
        }

        /* Collapsed sidebar */
        .sidebar {
            transition: width .25s ease;
        }

        .sidebar.collapsed {
            width: 0;
            padding: 0;
            overflow: hidden;
            box-shadow: none;
            border: none;
        }

        /* hide everything inside when collapsed so the panel is completely hidden */
        .sidebar.collapsed * {
            display: none !important;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0 20px 0;
            /* keeps no horizontal padding; left alignment handled by .nav-item */
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 32px;
            cursor: pointer;
            transition: all 0.2s;
            color: #fff;
            text-decoration: none;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            border-right: 3px solid #2563eb;
        }

        .nav-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
        }

        /* Main Content */
        /* --- Normalize vertical spacing across views (quotation/order/delivery) --- */
        #quotation-view,
        #order-view,
        #delivery-view {
            margin-top: 0 !important;
            /* remove accidental top gaps */
            display: flex;
            flex-direction: column;
            flex: 1;
            min-height: 0;
        }

        #quotation-view .tabs,
        #order-view .tabs,
        #delivery-view .tabs {
            margin-top: 0 !important;
            /* ensure tabs hug the top area */
        }

        /* As a safety net, ensure the first child in .content never adds unexpected top margin */
        .content>div:first-child {
            margin-top: 0 !important;
        }

        /* --- Normalize vertical spacing across views (quotation/order/delivery) --- */
        #quotation-view,
        #order-view,
        #delivery-view {
            margin-top: 0 !important;
            /* remove accidental top gaps */
        }

        #quotation-view .tabs,
        #order-view .tabs,
        #delivery-view .tabs {
            margin-top: 0 !important;
            /* ensure tabs hug the top area */
        }

        /* As a safety net, ensure the first child in .content never adds unexpected top margin */
        .content>div:first-child {
            margin-top: 0 !important;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Bar */
        .top-bar {
            background: #fff;
            padding: 16px 32px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title {
            font-size: 20px;
            font-weight: 600;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .logout-btn {
            padding: 8px 16px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        /* Content Area */
        .content {
            flex: 1;
            padding: 8px 32px 8px;
            /* minimized bottom padding for maximum table space */
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .warehouse-card {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .warehouse-card.zama {
            background-color: #dcfce7;
        }

        .warehouse-card.yokohama {
            background-color: #fff8e5;
        }

        .warehouse-card.koshien {
            background-color: #fddada;
        }

        .warehouse-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        .warehouse-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .warehouse-name {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }

        .warehouse-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
        }

        .warehouse-info {
            color: #6b7280;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .status-item {
            background: #f9fafb;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .status-label {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 4px;
        }

        .status-value {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
        }

        .status-link {
            color: #2563eb;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s;
        }

        .status-link:hover {
            color: #1d4ed8;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
            flex-shrink: 0;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            color: #6b7280;
            position: relative;
            margin-bottom: -2px;
        }

        .tab:hover {
            color: #2563eb;
        }

        .tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
        }

        .tab-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Data Table */
        .data-table-container {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 0 !important;
            padding-bottom: 0 !important;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            height: calc(100vh - 170px);
            /* さらに下まで引き伸ばし */
        }

        .table-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #e5e7eb;
        }

        .search-fields {
            display: flex;
            gap: 16px;
            flex: 1;
            max-width: 1200px; /* 最大幅を少し大きくする */
            align-items: flex-end;
            flex-wrap: wrap; /* 必要に応じて折り返し */
        }

        .search-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 200px;
            flex: 1 1 auto; /* より柔軟なサイズ調整 */
            max-width: 350px; /* 最大幅を制限 */
        }

        .search-field label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .search-field .search-input {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .search-field .search-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .search-box {
            display: flex;
            gap: 12px;
            flex: 1;
            max-width: 600px;
        }

        .search-input {
            flex: 1;
            padding: 10px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        /* Search field with filter button */
        .search-field-with-filter {
            display: flex;
            align-items: flex-end;
            gap: 8px;
        }

        .search-field-with-filter .search-field {
            flex: 1;
        }

        .search-filter-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #f9fafb;
            cursor: pointer;
            transition: all 0.2s;
            color: #374151;
            flex-shrink: 0;
        }

        .search-filter-btn:hover:not(:disabled) {
            background: #e5e7eb;
            border-color: #d1d5db;
        }

        .search-filter-btn:disabled {
            background: #f3f4f6 !important;
            color: #9ca3af !important;
            border-color: #e5e7eb !important;
            cursor: not-allowed !important;
        }

        .search-filter-btn svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
        }

        /* Search button style手配済にする */
        .search-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #2563eb;
            border-radius: 8px;
            background: #2563eb;
            cursor: pointer;
            transition: all 0.2s;
            color: #ffffff;
            flex-shrink: 0;
            margin-left: 8px;
            margin-right: 8px;
        }

        .search-btn:hover:not(:disabled) {
            background: #1d4ed8;
            border-color: #1d4ed8;
        }

        .search-btn:disabled {
            background: #f3f4f6 !important;
            color: #9ca3af !important;
            border-color: #e5e7eb !important;
            cursor: not-allowed !important;
        }

        .search-btn svg {
            width: 20px;
            height: 20px;
            stroke: currentColor;
        }

        /* Additional filter fields */
        .additional-filters {
            display: none;
            padding: 16px 20px;
            background: #f8fafc;
        }

        .additional-filters.show {
            display: block;
        }

        /* 追加フィルターグリッド */
        .additional-filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            max-width: 800px;
        }

        .filter-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .filter-field label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .filter-field input {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .filter-field input:focus {
            outline: none;
            border-color: #2563eb;
        }

        /* Date range field styles */
        .date-range-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .date-range-field label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .date-range-inputs {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .date-range-inputs input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .date-range-inputs input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .date-range-separator {
            font-size: 12px;
            color: #6b7280;
            white-space: nowrap;
        }

        /* 出荷日フィールドを右にずらす */
        .date-range-field.ship-date-field {
            margin-left: 40px;
        }

        /* 複数検索フィールドのスタイル */
        .multi-search-container {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .multi-search-container.show {
            display: block;
        }

        .multi-search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 16px;
        }

        .multi-search-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .multi-search-field label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .multi-search-field textarea {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            resize: vertical;
            min-height: 60px;
            transition: border-color 0.2s;
        }

        .multi-search-field textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        .multi-search-field textarea::placeholder {
            color: #9ca3af;
        }

        /* 自社管理番号と担当備考フィールドのスタイル */
        .management-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
            max-width: 530px;
        }

        .management-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .management-field label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .management-field input,
        .management-field textarea {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .management-field input:focus,
        .management-field textarea:focus {
            outline: none;
            border-color: #2563eb;
        }

        .management-field textarea {
            resize: vertical;
            min-height: 60px;
        }

        /* New search form styles */
        .search-form-2 {
            display: flex;
            position: relative;
            max-width: 600px;
            flex: 1;
        }

        .search-form-2 label {
            flex: 1;
            position: relative;
        }

        .search-form-2 input[type="text"] {
            width: 100%;
            padding: 10px 50px 10px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .search-form-2 input[type="text"]:focus {
            outline: none;
            border-color: #2563eb;
        }

        .search-form-2 button[type="submit"] {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            color: #6b7280;
            transition: color 0.2s;
        }

        .search-form-2 button[type="submit"]:hover {
            color: #2563eb;
        }

        .search-form-2 button[type="submit"]::before {
            content: "";
            width: 20px;
            height: 20px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='currentColor'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E");
            background-size: contain;
            background-repeat: no-repeat;
        }

        .filter-btn {
            padding: 10px 8px;
            min-width: 60px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-btn:hover {
            background: #e5e7eb;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            /* enable fixed layout for column resizing */
            min-width: 1200px;
            /* minimum width to trigger horizontal scroll */
        }

        .data-table th {
            background: #1e293b;
            padding: 8px 12px;
            /* narrower header padding */
            text-align: left;
            font-weight: 600;
            color: #ffffff;
            font-size: 12px;
            /* smaller header text */
            border-bottom: 1px solid #e5e7eb;
            white-space: nowrap;
            /* prevent header text wrapping */
            position: relative;
            user-select: none;
            /* prevent text selection during resize */
            border-right: 1px solid #374151;
            /* visible border for resizing */
            cursor: pointer;
            /* sortable columns */
        }

        .data-table th.sortable:hover {
            background: #334155;
        }

        .data-table th .sort-indicator {
            display: inline-block;
            width: 0;
            height: 0;
            margin-left: 8px;
            vertical-align: middle;
            opacity: 0.6;
        }

        .data-table th.sort-asc .sort-indicator {
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 6px solid #ffffff;
        }

        .data-table th.sort-desc .sort-indicator {
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-top: 6px solid #ffffff;
        }

        .data-table th:not(.sort-asc):not(.sort-desc) .sort-indicator {
            border-left: 4px solid transparent;
            border-right: 4px solid transparent;
            border-bottom: 6px solid rgba(255, 255, 255, 0.3);
        }

        /* Header resize handle */
        .data-table th::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            cursor: col-resize;
            background: transparent;
            border-right: 2px solid transparent;
        }

        .data-table th:hover {
            background-color: #5b5c5e;
        }

        .data-table td {
            padding: 10px 12px;
            /* narrower cell padding */
            border-bottom: 1px solid #f3f4f6;
            font-size: 12px;
            white-space: nowrap;
            /* prevent cell content wrapping */
            overflow: hidden;
            text-overflow: ellipsis;
            /* show ellipsis for long content */
            border-right: 1px solid #f3f4f6;
        }

        /* --- Quotation Processing Table Row Height Adjustment --- */
        #quotation-view table.data-table th,
        #quotation-view table.data-table td,
        #order-view table.data-table th,
        #order-view table.data-table td {
            padding-top: 8px;
            padding-bottom: 8px;
        }

        /* Enhanced quotation view table cells for better content display */
        #quotation-view table.data-table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: none;
            vertical-align: top;
            line-height: 1.4;
        }

        /* Enhanced order view table cells for better content display */
        #order-view table.data-table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: none;
            vertical-align: top;
            line-height: 1.4;
        }

        /* Enhanced delivery view table cells for better content display */
        #delivery-view table.data-table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: none;
            vertical-align: top;
            line-height: 1.4;
        }

        /* Specific handling for long text columns in quotation view */
        #quotation-view table.data-table td:nth-child(n+5) {
            min-width: 120px;
        }

        /* Specific handling for long text columns in order view */
        #order-view table.data-table td:nth-child(n+5) {
            min-width: 120px;
        }

        /* Specific handling for long text columns in delivery view */
        #delivery-view table.data-table td:nth-child(n+5) {
            min-width: 120px;
        }

        /* Quotation view table container with horizontal scroll */
        #quotation-view .table-scroll {
            overflow-x: auto;
            overflow-y: auto;
            max-width: 100%;
        }

        /* Order view table container with horizontal scroll */
        #order-view .table-scroll {
            overflow-x: auto;
            overflow-y: auto;
            max-width: 100%;
        }

        /* Delivery view table container with horizontal scroll */
        #delivery-view .table-scroll {
            overflow-x: auto;
            overflow-y: auto;
            max-width: 100%;
        }

        /* Quotation view table with minimum width to ensure horizontal scroll */
        #quotation-view .data-table {
            min-width: 1600px;
            table-layout: auto;
        }

        /* Order view table with minimum width to ensure horizontal scroll */
        #order-view .data-table {
            min-width: 1600px;
            table-layout: auto;
        }

        /* Delivery view table with minimum width to ensure horizontal scroll */
        #delivery-view .data-table {
            min-width: 1600px;
            table-layout: auto;
        }

        /* Quotation view header auto-resize indicator */
        #quotation-view table.data-table th.sortable:hover::after {
            position: absolute;
            bottom: -20px;
            left: 0;
            font-size: 10px;
            color: #6b7280;
            white-space: nowrap;
            pointer-events: none;
            z-index: 1000;
        }

        .data-table tr:hover {
            background: #f9fafb;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Scrollable table area */
        .table-scroll {
            flex: 1;
            overflow: auto;
            min-height: 0;
            overflow-x: auto;
            /* enable horizontal scrolling */
            overflow-y: auto;
            /* enable vertical scrolling */
        }

        /* Keep table headers visible while scrolling */
        .data-table thead th {
            position: sticky;
            top: 0;
            z-index: 2;
            background: #1e293b;
            /* ensure header background is maintained */
        }

        /* Action Buttons */
        .action-bar {
            display: flex;
            gap: 12px;
            padding: 20px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 14px;
        }

        .btn-primary {
            padding: 8px 16px;
            /* narrower buttons */
        }

        .btn-success {
            padding: 10px 24px;
        }

        .btn-primary {
            background: #2563eb;
            color: white;
        }

        .btn-primary:hover {
            background: #1d4ed8;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .btn-success {
            background: #ff8433;
            color: white;
        }

        .btn-success:hover {
            background: #ff8433;
        }

        .btn-danger {
            background: #ef4444;
            color: #fff;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* FAX出力ボタン専用スタイル */
        #fax-modal-btn,
        #order-fax-modal-btn,
        #order-delay-fax-modal-btn,
        #delivery-fax-modal-btn {
            background: #8b5cf6;
            color: white;
            border-color: #8b5cf6;
        }

        #fax-modal-btn:hover,
        #order-fax-modal-btn:hover,
        #order-delay-fax-modal-btn:hover,
        #delivery-fax-modal-btn:hover {
            background: #7c3aed;
            border-color: #7c3aed;
        }

        /* Details row in table */
        .toggle-details-btn {
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .toggle-details-btn:hover {
            background-color: #f3f4f6;
        }

        .toggle-details-btn svg {
            width: 16px;
            height: 16px;
            transition: transform 0.2s;
        }

        .data-table tr.details-row-container.open .toggle-details-btn svg {
            transform: rotate(180deg);
        }

        .details-row {
            display: none;
            /* Initially hidden */
        }

        .details-row td {
            padding: 0 !important;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            /* Match table border */
        }

        .details-card {
            padding: 20px;
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .details-card img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            background: #eee;
        }

        .details-card-info {
            flex: 1;
        }

        .details-card-info div {
            margin-bottom: 8px;
            font-size: 14px;
            line-height: 1.6;
        }

        .details-card-info .label {
            font-weight: 600;
            color: #374151;
            display: inline-block;
            width: 120px;
        }

        .details-card-info .value {
            color: #6b7280;
        }

        /* Disabled button styles */
        .btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .btn:disabled:hover {
            background: #d1d5db;
        }

        /* Custom colors for specific order action buttons */
        #btn-to-shipment-wait {
            background-color: #007bff;
            /* same blue as 見積送信 */
            border-color: #007bff;
        }

        #btn-to-in-progress,
        #btn-to-done {
            background-color: #f3f4f6;
            /* same as .filter-btn */
            border-color: #e5e7eb;
            /* same border as .filter-btn */
            color: #374151;
            /* same text color as .filter-btn */
        }

        #btn-to-in-progress:hover,
        #btn-to-done:hover {
            background-color: #e5e7eb;
            /* same hover as .filter-btn:hover */
        }

        /* Order panel buttons - match the same color scheme */
        #order-panel-done-btn {
            background-color: #ebebeb !important;
            border-color: #e5e7eb !important;
            color: #374151 !important;
        }

        #order-panel-done-btn:hover:not(:disabled) {
            background-color: #e5e7eb !important;
        }

        /* Always show dynamic actions (order view). Buttons will be disabled until a row is selected. */
        #order-view .dynamic-actions {
            display: flex !important;
        }

        #order-view .dynamic-actions button {
            display: inline-flex;
            align-items: center;
        }

        /* Always show dynamic actions (delivery view). Buttons will be disabled until a row is selected. */
        #delivery-view .dynamic-actions {
            display: flex !important;
        }

        #delivery-view .dynamic-actions button {
            display: inline-flex;
            align-items: center;
        }

        /* Modal */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal-backdrop.show {
            display: flex;
        }

        .modal {
            width: 520px;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            position: absolute;
            cursor: move;
        }

        .modal.dragging {
            user-select: none;
        }

        .modal-header {
            padding: 20px 24px 8px 24px;
            font-size: 20px;
            font-weight: 700;
            color: #111827;
        }

        .modal-subinfo {
            padding: 0 24px 16px 24px;
            color: #6b7280;
            font-size: 14px;
        }

        .modal-body {
            padding: 0 24px 8px 24px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .form-select,
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 10px;
            font-size: 14px;
            outline: none;
        }

        .form-select:focus,
        .form-input:focus {
            border-color: #2563eb;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding: 16px 24px 24px 24px;
        }

        .btn-muted {
            background: #e5e7eb;
            color: #374151;
        }

        /* Sidebar user menu */
        .sidebar-user {
            position: relative;
        }

        /* Quick actions (設定 / ヘルプ) vertical list above user section */
        .sidebar-quick {
            padding: 12px 20px 4px 35px;
        }

        .sidebar-quick .quick-item {
            width: 100%;
            background: none;
            border: none;
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            color: #f1f5f9;
            /* light text */
            font-size: 16px;
            /* match nav item text size */
            font-weight: 500;
            text-align: left;
            line-height: 1.2;
        }

        .sidebar-quick .quick-item .qi-icon {
            width: 20px;
            /* match .nav-icon */
            height: 20px;
            color: #cbd5e1;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            flex: 0 0 20px;
        }

        .sidebar-quick .quick-item:hover {
            color: #ffffff;
        }

        .sidebar-quick .quick-item:hover .qi-icon {
            color: #ffffff;
        }

        /* Inline vertical quick buttons placed at right of user info */
        .user-quick-vertical {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding-top: 2px;
            /* slight alignment tweak */
        }

        .user-quick-vertical .quick-item {
            background: none;
            border: none;
            padding: 2px 0;
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            color: #f1f5f9;
            font-size: 14px;
            font-weight: 500;
            line-height: 1.1;
            text-align: left;
            white-space: nowrap;
        }

        .user-quick-vertical .quick-item .qi-icon {
            width: 16px;
            height: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            flex: 0 0 16px;
        }

        .user-quick-vertical .quick-item:hover {
            color: #ffffff;
        }

        .user-quick-vertical .quick-item:hover .qi-icon {
            color: #ffffff;
        }

        .user-menu {
            position: absolute;
            left: 16px;
            /* align to left inside the sidebar */
            bottom: 64px;
            /* dark style to match sidebar */
            background: #1f2937;
            /* dark slate */
            border: 1px solid rgba(255, 255, 255, 0.06);
            border-radius: 8px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.32);
            padding: 6px 6px;
            display: none;
            z-index: 3000;
            min-width: 160px;
        }

        .user-menu.show {
            display: block;
        }

        .user-menu .menu-item {
            width: 100%;
            text-align: left;
            padding: 8px 10px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            font-size: 14px;
            color: #f8fafc;
            /* light text for dark bg */
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-menu .menu-item .menu-icon {
            width: 18px;
            height: 18px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            color: #cbd5e1;
            flex: 0 0 18px;
        }

        .user-menu .menu-item:hover {
            background: rgba(255, 255, 255, 0.04);
        }

        /* Pagination */
        .pagination {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 20px 20px;
            flex-wrap: wrap;
            gap: 16px;
            position: relative;
        }

        .pagination-summary {
            position: absolute;
            left: 20px;
            font-size: 13px;
            color: #6B7280;
            line-height: 1.4;
            flex-shrink: 0;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-shrink: 0;
        }

        .page-btn {
            padding: 6px 12px;
            border: 1px solid #e5e7eb;
            background: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .page-btn:hover {
            background: #f3f4f6;
        }

        .page-btn.active {
            background: #2563eb;
            color: #fff;
            border-color: #2563eb;
        }

        .page-btn[disabled] {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Notification Area */
        .notification-area {
            margin-top: 24px;
        }

        .notification {
            background: #fef3c7;
            border: 1px solid #fde68a;
            border-radius: 8px;
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .notification-icon {
            width: 20px;
            height: 20px;
            color: #f59e0b;
        }

        .notification-text {
            flex: 1;
            color: #92400e;
            font-size: 14px;
        }

        /* Update notification styles */
        .update-notification {
            position: relative;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .update-notification:hover {
            background-color: #e0f2fe;
        }

        .update-notification.unread {
            border-left: 4px solid #0ea5e9;
        }

        .update-notification.read {
            opacity: 0.8;
        }

        .update-icon {
            width: 20px;
            height: 20px;
            color: #0ea5e9;
            flex-shrink: 0;
        }

        .update-title {
            font-weight: 600;
            color: #0ea5e9;
            cursor: pointer;
            text-decoration: underline;
        }

        .update-title:hover {
            color: #0284c7;
        }

        .view-all-notifications-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #0ea5e9;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        }

        .view-all-notifications-btn:hover {
            background: #0284c7;
        }

        /* All Notifications Modal Styles */
        .all-notifications-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }

        .all-notifications-modal-backdrop.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .all-notifications-modal {
            background: white;
            border-radius: 8px;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .all-notifications-modal-header {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .all-notifications-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #0ea5e9;
        }

        .all-notifications-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .all-notifications-modal-close:hover {
            color: #374151;
        }

        .all-notifications-modal-body {
            padding: 16px;
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        .all-notifications-list-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 16px;
        }

        .notification-detail-panel {
            width: 400px;
            border-left: 1px solid #e2e8f0;
            padding-left: 16px;
            overflow-y: auto;
            display: none;
        }

        .notification-detail-panel.show {
            display: block;
        }

        .notification-detail-header {
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .notification-detail-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .notification-detail-date {
            font-size: 14px;
            color: #6b7280;
        }

        .notification-detail-content {
            line-height: 1.6;
            color: #374151;
        }

        .notification-detail-content h4 {
            color: #1f2937;
            margin-bottom: 12px;
            font-size: 16px;
            font-weight: 600;
        }

        .notification-detail-content p {
            margin-bottom: 12px;
        }

        .notification-detail-content ul {
            margin-bottom: 12px;
            padding-left: 20px;
        }

        .notification-detail-content li {
            margin-bottom: 8px;
        }

        /* レスポンシブデザイン対応 */
        @media (max-width: 768px) {
            .all-notifications-modal-body {
                flex-direction: column;
            }

            .notification-detail-panel {
                width: 100%;
                border-left: none;
                border-top: 1px solid #e2e8f0;
                margin-top: 16px;
                padding-left: 0;
                padding-top: 16px;
            }

            .all-notifications-list-container {
                padding-right: 0;
            }
        }

        .all-notifications-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .all-notifications-list li {
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
            color: #374151;
        }

        .all-notifications-list li:last-child {
            border-bottom: none;
        }

        .notification-title-btn {
            background: none;
            border: none;
            width: 100%;
            text-align: left;
            padding: 12px 0;
            color: #374151;
            cursor: pointer;
            font-size: inherit;
        }

        .notification-title-btn:hover {
            color: #0ea5e9;
            background: #f8fafc;
        }

        .notification-title-btn.selected {
            background: #e0f2fe;
            color: #0ea5e9;
            font-weight: 600;
        }

        .new-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: #ef4444;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Update modal styles */
        .update-modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
        }

        /* Delivery Alert Modal styles */
        .delivery-alert-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 4000;
        }

        .delivery-alert-modal {
            background: white;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .delivery-alert-header {
            background: #dc2626;
            color: white;
            padding: 20px 24px;
            border-radius: 12px 12px 0 0;
            display: flex;
            align-items: center;
            justify-content: between;
            gap: 12px;
        }

        .delivery-alert-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }

        .delivery-alert-title {
            font-size: 20px;
            font-weight: 700;
            flex: 1;
        }

        .delivery-alert-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .delivery-alert-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .delivery-alert-body {
            padding: 24px;
        }

        .delivery-alert-summary {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .delivery-alert-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .delivery-alert-item {
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .delivery-alert-item:last-child {
            border-bottom: none;
        }

        .delivery-alert-item:nth-child(odd) {
            background-color: #f9fafb;
        }

        .delivery-alert-item-content {
            flex: 1;
        }

        .delivery-alert-item-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .warehouse-summary-item {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .warehouse-summary-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .warehouse-summary-content {
            flex: 1;
        }

        .warehouse-summary-name {
            font-weight: 600;
            font-size: 16px;
            color: #374151;
            margin-bottom: 4px;
        }

        .warehouse-summary-detail {
            font-size: 14px;
            color: #6b7280;
        }

        .warehouse-summary-actions {
            display: flex;
            align-items: center;
            flex-direction: column;
            gap: 8px;
        }

        .warehouse-overdue-count {
            background: #ff7979;
            color: white;
            padding: 8px 35px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 400;
            min-width: 50px;
            text-align: center;
        }

        .delivery-detail-btn {
            background: #1a69e7;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 400;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: underline;
        }

        .delivery-detail-btn:hover {
            background: #2563eb;
        }

        .delivery-delay-days {
            background: #dc2626;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .warehouse-header-section {
            background: #f3f4f6;
            padding: 12px 16px;
            font-weight: 600;
            color: #374151;
            border-bottom: 2px solid #d1d5db;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }

        .warehouse-header-section:first-child {
            margin-top: 0;
        }

        .warehouse-header-zama {
            background-color: #dcfce7;
        }

        .warehouse-header-yokohama {
            background-color: #fff8e5;
        }

        .warehouse-header-koshien {
            background-color: #fddada;
        }

        .update-modal-backdrop.show {
            display: flex;
        }

        /* ボタンの disabled (初期グレーアウト) スタイル */
        #fax-modal-btn:disabled,
        #order-fax-modal-btn:disabled,
        #order-delay-fax-modal-btn:disabled,
        #delivery-fax-modal-btn:disabled,
        #export-dropdown-btn:disabled,
        #order-export-csv-btn:disabled,
        #order-delay-export-csv-btn:disabled,
        #delivery-export-dropdown-btn:disabled,
        #delay-processing-btn:disabled {
            background: #d1d5db !important;
            /* グレー */
            color: #9ca3af !important;
            /* 文字色も薄く */
            border-color: #d1d5db !important;
            cursor: not-allowed !important;
            opacity: 1 !important;
        }

        .update-modal {
            width: 600px;
            max-width: 90vw;
            max-height: 80vh;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .update-modal-header {
            padding: 20px 24px;
            background: #f0f9ff;
            border-bottom: 1px solid #e0f2fe;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .update-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #0ea5e9;
        }

        .update-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .update-modal-close:hover {
            background: #e5e7eb;
        }

        .update-modal-body {
            padding: 24px;
            line-height: 1.6;
            color: #374151;
            overflow-y: auto;
            max-height: 60vh;
        }

        /* Filter Panel */
        .filter-panel {
            position: fixed;
            right: -300px;
            top: 0;
            width: 300px;
            height: 100vh;
            background: #fff;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: right 0.3s;
            z-index: 1000;
            padding: 24px;
        }

        .filter-panel.active {
            right: 0;
        }

        .filter-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .filter-title {
            font-size: 18px;
            font-weight: 600;
        }

        .close-btn {
            width: 24px;
            height: 24px;
            cursor: pointer;
            color: #6b7280;
        }

        .filter-group {
            margin-bottom: 24px;
        }

        .filter-label {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
        }

        .filter-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }

        /* Dynamic Action Buttons */
        /* Dynamic action container used for CSV/FAX/etc. */
        .dynamic-actions {
            display: none;
            gap: 12px;
            align-items: center;
            /* default for contexts outside table-tools */
            justify-content: flex-start;
        }

        /* When shown, keep baseline centered by default */
        .dynamic-actions.show {
            display: flex;
        }

        /* In the table-tools area we want action buttons to align to the same baseline
           as the search/filter buttons (those use align-items:flex-end). Apply
           a more specific rule so CSV/FAX align with search/filter vertically. */
        .table-tools>.dynamic-actions,
        .table-tools .dynamic-actions {
            display: flex;
            align-items: flex-end;
        }

        /* Always show dynamic actions (quotation view). Buttons will be disabled until a row is selected. */
        #quotation-view .dynamic-actions {
            display: flex !important;
        }

        /* Dropdown Styles */
        .dropdown {
            position: relative;
        }

        .dropdown-btn {
            padding: 10px 20px;
            background: #059669;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }

        .dropdown-btn:hover {
            background: #059669;
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            min-width: 120px;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px 16px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            border-bottom: 1px solid #f3f4f6;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f9fafb;
        }

        /* Selected details panel */
        .selected-info {
            margin: 16px 20px 20px 20px;
            background: #fff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .selected-info__header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 16px;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
        }

        .selected-info__title {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
        }

        .selected-info__count {
            font-size: 12px;
            color: #6b7280;
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            /* unify column widths */
        }

        .details-table th {
            background: #fff;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            font-size: 13px;
            border-bottom: 1px solid #e5e7eb;
        }

        .details-table td {
            padding: 12px;
            border-bottom: 1px solid #f3f4f6;
            font-size: 13px;
            color: #1f2937;
        }

        /* Keep cells on one line and show ellipsis */
        .details-table th,
        .details-table td {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Right-align the quantity column (last column) */
        .details-table td:last-child {
            text-align: right;
        }

        .selected-info__body {
            max-height: 280px;
            overflow: auto;
        }

        #btn-back-to-arranged {
            background: #ef4444;
            color: #fff;
        }

        #btn-back-to-arranged:hover:not(:disabled) {
            background: #dc2626;
        }

        /* 手配済に戻すボタンのdisabled状態は標準のグレースタイルを使用 */
        #btn-back-to-arranged:disabled {
            background: #d1d5db !important;
            color: #9ca3af !important;
            cursor: not-allowed !important;
        }

        /* RC担当備考の重要な情報のスタイル */
        .rc-memo-important {
            background-color: #fef08a !important;
            color: #000000 !important;
            font-weight: 500 !important;
            border-left: 1px solid #eab308 !important;
            border-top: 1px solid #eab308 !important;
            border-bottom: 1px solid #eab308 !important;
            border-right: 1px solid #f3f4f6 !important; /* グリッド線を維持 */
            padding: 6px !important;
            border-radius: 4px !important;
            font-size: 13px !important;
            line-height: 1.4 !important;
        }

        /* ホバー時により目立たせる */
        .rc-memo-important:hover {
            background-color: #fde047 !important;
            border-color: #ca8a04 !important;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {

            /* Layout adjustments */
            .app-container {
                flex-direction: column;
                height: 100vh;
            }

            /* Sidebar mobile behavior */
            .sidebar {
                position: fixed;
                top: 0;
                left: -260px;
                width: 260px;
                height: 100vh;
                z-index: 9999;
                transition: left 0.3s ease;
            }

            .sidebar.mobile-open {
                left: 0;
            }

            .sidebar.collapsed {
                left: -260px;
            }

            /* Mobile overlay */
            .mobile-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.5);
                z-index: 9998;
                display: none;
            }

            .mobile-overlay.show {
                display: block;
            }

            /* Main content full width on mobile */
            .main-content {
                width: 100%;
                margin-left: 0;
            }

            /* Top bar mobile adjustments */
            .top-bar {
                padding: 12px 16px;
                position: relative;
            }

            .page-title {
                font-size: 18px;
                margin-left: 40px;
            }

            /* Mobile menu button */
            .mobile-menu-btn {
                position: absolute;
                left: 16px;
                top: 50%;
                transform: translateY(-50%);
                background: none;
                border: none;
                font-size: 24px;
                color: #374151;
                cursor: pointer;
                padding: 4px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* Content area mobile */
            .content {
                padding: 16px;
            }

            /* Dashboard cards mobile */
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 16px;
                margin-bottom: 24px;
            }

            .warehouse-card {
                padding: 16px;
            }

            .warehouse-name {
                font-size: 16px;
            }

            .warehouse-info {
                font-size: 13px;
                margin-bottom: 16px;
            }

            .status-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .status-item {
                padding: 10px;
            }

            .status-label {
                font-size: 11px;
            }

            .status-value {
                font-size: 14px;
                line-height: 1.4;
            }

            /* Tables mobile */
            .data-table-container {
                margin: 0 -16px;
                border-radius: 0;
            }

            .table-tools {
                padding: 16px;
                flex-direction: column;
                gap: 12px;
            }

            .search-fields {
                flex-direction: column;
                max-width: none;
                gap: 12px;
            }

            .search-field {
                min-width: auto;
                width: 100%;
            }

            .search-form-2 {
                max-width: none;
                order: 1;
            }

            .dynamic-actions {
                order: 2;
                justify-content: flex-start;
                flex-wrap: wrap;
            }

            .table-scroll {
                max-height: 60vh;
                overflow: auto;
            }

            .data-table {
                font-size: 12px;
            }

            .data-table th,
            .data-table td {
                padding: 8px 6px;
                min-width: 80px;
            }

            .data-table th {
                font-size: 11px;
            }

            /* RC担当備考 mobile */
            .rc-memo-important {
                font-size: 11px !important;
                padding: 4px !important;
                line-height: 1.3 !important;
            }

            /* Buttons mobile */
            .btn {
                padding: 8px 12px;
                font-size: 13px;
                white-space: nowrap;
            }

            .dropdown-btn {
                padding: 8px 12px;
                font-size: 13px;
            }

            /* Tabs mobile */
            .tabs {
                margin-bottom: 16px;
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .tab {
                padding: 10px 16px;
                white-space: nowrap;
                font-size: 14px;
            }

            /* Modal mobile */
            .modal {
                width: 95vw;
                max-width: 95vw;
                margin: 20px;
            }

            .modal-header {
                padding: 16px 20px 8px 20px;
                font-size: 18px;
            }

            .modal-body {
                padding: 0 20px 8px 20px;
            }

            .modal-footer {
                padding: 12px 20px 20px 20px;
            }

            /* Update modal mobile */
            .update-modal {
                width: 95vw;
                max-width: 95vw;
                margin: 20px;
            }

            /* Filter panel mobile */
            .filter-panel {
                width: 100vw;
                right: -100vw;
            }

            /* User info mobile */
            .user-info {
                gap: 8px;
            }

            .user-avatar {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }

            .logout-btn {
                padding: 6px 12px;
                font-size: 13px;
            }

            /* Warehouse dropdown mobile */
            #header-warehouse-dropdown {
                position: relative;
            }

            .dropdown-menu {
                position: fixed;
                top: auto;
                left: 16px;
                right: 16px;
                width: auto;
                max-height: 300px;
                overflow-y: auto;
            }

            /* Notification mobile */
            .notification {
                margin: 0 -16px 12px -16px;
                border-radius: 0;
                padding: 12px 16px;
            }

            .notification-text {
                font-size: 13px;
            }

            /* Pagination mobile */
            .pagination {
                padding: 12px 16px 16px;
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            .pagination-summary {
                text-align: center;
                font-size: 12px;
            }

            .pagination-controls {
                justify-content: center;
            }

            .page-btn {
                padding: 6px 10px;
                font-size: 13px;
            }

            /* Selected info panel mobile */
            .selected-info {
                margin: 16px 0 20px 0;
                border-radius: 8px;
            }

            .selected-info__body {
                max-height: 200px;
            }

            .details-table {
                font-size: 12px;
            }

            .details-table th,
            .details-table td {
                padding: 8px 6px;
            }

            /* Action bar mobile */
            .action-bar {
                padding: 16px;
                flex-wrap: wrap;
                gap: 8px;
            }

            /* Details card mobile */
            .details-card {
                padding: 16px;
                flex-direction: column;
                gap: 16px;
            }

            .details-card img {
                width: 80px;
                height: 80px;
                align-self: center;
            }

            .details-card-info .label {
                width: 100px;
            }
        }

        /* Small mobile (phones in portrait) */
        @media (max-width: 480px) {
            .page-title {
                font-size: 16px;
                margin-left: 36px;
            }

            .mobile-menu-btn {
                left: 12px;
                font-size: 20px;
            }

            .top-bar {
                padding: 10px 12px;
            }

            .content {
                padding: 12px;
            }

            .warehouse-card {
                padding: 12px;
            }

            .warehouse-name {
                font-size: 15px;
            }

            .status-value {
                font-size: 13px;
            }

            .data-table {
                font-size: 11px;
            }

            .data-table th,
            .data-table td {
                padding: 6px 4px;
                min-width: 70px;
            }

            .btn {
                padding: 6px 10px;
                font-size: 12px;
            }

            .tab {
                padding: 8px 12px;
                font-size: 13px;
            }

            .dropdown-menu {
                left: 12px;
                right: 12px;
            }

        }

        /* 必須マークのスタイル */
        .required-mark {
            color: #ef4444;
            font-size: 12px;
            margin-left: 4px;
            font-weight: bold;
        }

        /* セクション区切り線のスタイル */
        .section-divider {
            border: none;
            height: 1px;
            background: #e5e7eb;
            margin: 20px 0;
        }

        /* 詳細確認ボタンのバッジ */
        .delivery-detail-btn {
            position: relative;
        }

        .detail-btn-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff7979;
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        /* 右側固定パネルスタイル */
        .right-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 350px;
            height: 100vh;
            background: white;
            border-left: 1px solid #e0e0e0;
            padding: 20px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            transition: width .25s ease;
        }

        .right-panel.show {
            display: block;
        }

        /* Collapsed right panel */
        .right-panel.collapsed {
            width: 60px;
            padding: 0;
            overflow: hidden;
        }

        /* hide everything inside when collapsed except the header */
        .right-panel.collapsed .right-panel-body {
            display: none !important;
        }

        .right-panel.collapsed .right-panel-title {
            display: none !important;
        }

        .right-panel.collapsed .right-panel-header {
            padding: 16px 8px;
            justify-content: center;
        }

        .main-content.quotation-panel-active {
            margin-right: 350px;
        }

        .main-content.quotation-panel-collapsed {
            margin-right: 60px;
        }

        /* Order panel styles */
        .main-content.order-panel-active {
            margin-right: 350px;
        }

        .main-content.order-panel-collapsed {
            margin-right: 60px;
        }

        /* Delivery panel styles */
        .main-content.delivery-panel-active {
            margin-right: 350px;
        }

        .main-content.delivery-panel-collapsed {
            margin-right: 60px;
        }

        /* Responsive order panel */
        @media (max-width: 1024px) {

            .main-content.order-panel-active,
            .main-content.order-panel-collapsed {
                margin-right: 0;
            }
        }

        /* トップバーを固定幅に保つ */
        .main-content.quotation-panel-active .top-bar {
            position: fixed;
            top: 0;
            left: 280px;
            /* サイドバーの幅分オフセット */
            right: 0;
            /* 画面右端まで */
            z-index: 100;
            margin-right: 0;
            /* パネルの影響を受けないように */
        }

        .main-content.quotation-panel-collapsed .top-bar {
            position: fixed;
            top: 0;
            left: 280px;
            /* サイドバーの幅分オフセット */
            right: 60px;
            /* 折りたたまれたパネル分の余白 */
            z-index: 100;
            margin-right: 0;
            /* パネルの影響を受けないように */
        }

        /* パネルが表示されているときのコンテンツエリア調整 */
        .main-content.quotation-panel-active .content {
            margin-top: 80px;
            /* トップバーの高さ分上にずらす */
        }

        .main-content.quotation-panel-collapsed .content {
            margin-top: 80px;
            /* トップバーの高さ分上にずらす */
        }

        /* サイドバーが折りたたまれた場合のトップバー位置調整 */
        .sidebar.collapsed~.main-content.quotation-panel-active .top-bar {
            left: 0;
            /* サイドバーが非表示の場合は左端から */
        }

        .sidebar.collapsed~.main-content.quotation-panel-collapsed .top-bar {
            left: 0;
            /* サイドバーが非表示の場合は左端から */
        }

        /* Delivery panel top bar adjustments */
        .main-content.delivery-panel-active .top-bar {
            position: fixed;
            top: 0;
            left: 280px;
            /* サイドバーの幅分オフセット */
            right: 0;
            /* 画面右端まで */
            z-index: 100;
            margin-right: 0;
            /* パネルの影響を受けないように */
        }

        .main-content.delivery-panel-collapsed .top-bar {
            position: fixed;
            top: 0;
            left: 280px;
            /* サイドバーの幅分オフセット */
            right: 60px;
            /* 折りたたまれたパネル分の余白 */
            z-index: 100;
            margin-right: 0;
            /* パネルの影響を受けないように */
        }

        /* Delivery panel content adjustments */
        .main-content.delivery-panel-active .content {
            margin-top: 80px;
            /* トップバーの高さ分上にずらす */
        }

        .main-content.delivery-panel-collapsed .content {
            margin-top: 80px;
            /* トップバーの高さ分上にずらす */
        }

        .sidebar.collapsed~.main-content.delivery-panel-active .top-bar {
            left: 0;
            /* サイドバーが非表示の場合は左端から */
        }

        .sidebar.collapsed~.main-content.delivery-panel-collapsed .top-bar {
            left: 0;
            /* サイドバーが非表示の場合は左端から */
        }

        .right-panel-header {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 20px;
            padding: 0;
        }

        .right-panel-title {
            font-size: 18px;
            font-weight: 600;
            flex: 1;
            margin: 0 16px;
        }

        .section-divider {
            border: none;
            border-top: 1px solid #e5e7eb;
            margin: 20px 0;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .button-group.vertical {
            flex-direction: column;
        }

        .selection-count {
            padding: 8px 12px;
            background: #f3f4f6;
            border-radius: 6px;
            font-size: 14px;
            color: #374151;
            font-weight: 500;
        }

        /* Enhanced Tag input styles with modern design */
        .enhanced-tag-input-container {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 8px 12px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            min-height: 48px;
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .enhanced-tag-input-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .enhanced-tag-input-container:hover::before {
            left: 100%;
        }

        .enhanced-tag-input-container:focus-within {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-1px);
        }

        .enhanced-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-right: 8px;
        }

        /* 拡張タグ入力の3列グリッドレイアウト */
        .enhanced-tag-input-container.has-tags .enhanced-tags {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            width: 100%;
            margin-right: 0;
        }

        .enhanced-tag {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            padding: 4px 8px 4px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.2);
            transition: all 0.2s ease;
            animation: tagSlideIn 0.3s ease;
            width: 100%;
            justify-content: space-between;
            min-height: 28px;
            box-sizing: border-box;
            overflow: hidden;
        }

        .enhanced-tag span:first-child {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }

        @keyframes tagSlideIn {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-10px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .enhanced-tag:hover {
            transform: translateY(-1px) scale(1.05);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        .enhanced-tag .remove {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .enhanced-tag .remove:hover {
            background: rgba(239, 68, 68, 0.9);
            transform: scale(1.1);
        }

        .enhanced-tag-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 120px;
            padding: 8px 4px;
            font-size: 14px;
            background: transparent;
            color: #374151;
        }

        .enhanced-tag-input::placeholder {
            color: #9ca3af;
            font-style: italic;
        }

        /* Search field wrapper with icon */
        .enhanced-search-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 180px;
            position: relative;
        }

        .enhanced-search-field label {
            font-size: 13px;
            font-weight: 600;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .enhanced-search-field .field-icon {
            width: 16px;
            height: 16px;
            color: #6b7280;
        }

        /* Help text styling - now as tooltip */
        .search-help-text {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            margin-bottom: 8px;
        }

        .search-help-text::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 6px solid transparent;
            border-top-color: #1f2937;
        }

        .search-help-text .help-icon {
            width: 12px;
            height: 12px;
            color: #9ca3af;
            margin-right: 4px;
        }

        .enhanced-tag-input-container:hover .search-help-text,
        .enhanced-tag-input-container:focus-within .search-help-text {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(-4px);
        }

        /* Enhanced search field positioning for tooltip */
        .enhanced-search-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 180px;
            position: relative;
        }

        /* Statistics display */
        .search-stats {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 6px;
            font-size: 11px;
            color: #6b7280;
        }

        .search-stats .stat-item {
            display: flex;
            align-items: center;
            gap: 3px;
            padding: 2px 6px;
            background: #f3f4f6;
            border-radius: 10px;
            font-weight: 500;
        }

        .search-stats .stat-number {
            color: #3b82f6;
            font-weight: 600;
        }

        /* Clear all button */
        .clear-all-btn {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 20px;
            height: 20px;
            border: none;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            z-index: 1;
        }

        .clear-all-btn:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .enhanced-tag-input-container:hover .clear-all-btn {
            display: flex;
        }

        /* Mobile responsive adjustments */
        @media (max-width: 768px) {
            .enhanced-search-field {
                min-width: 150px;
            }

            .enhanced-tag-input-container {
                min-height: 44px;
                padding: 6px 10px;
            }

            .enhanced-tag {
                font-size: 11px;
                padding: 3px 6px 3px 10px;
            }

            .enhanced-tag-input {
                min-width: 100px;
                font-size: 13px;
            }

            /* タブレット・モバイルでは2列表示 */
            .tag-input-container.has-tags {
                grid-template-columns: repeat(2, 1fr);
            }

            .enhanced-tag-input-container.has-tags .enhanced-tags {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* 非常に小さい画面では1列表示 */
        @media (max-width: 480px) {
            .tag-input-container.has-tags {
                grid-template-columns: 1fr;
            }

            .enhanced-tag-input-container.has-tags .enhanced-tags {
                grid-template-columns: 1fr;
            }
        }

        /* Animation for stats update */
        @keyframes statsUpdate {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
                color: #3b82f6;
            }

            100% {
                transform: scale(1);
            }
        }

        .search-stats .stat-item.updated {
            animation: statsUpdate 0.4s ease;
        }

        /* Tag-based input styles */
        .tag-input-container {
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            gap: 4px;
            min-height: 40px;
            padding: 6px 8px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: white;
            cursor: text;
            transition: border-color 0.2s;
            max-height: none;
            overflow: visible;
            width: 100%; /* 親要素の幅を最大限活用 */
            box-sizing: border-box;
        }

        .tag-input-container:focus-within {
            border-color: #2563eb;
            outline: none;
        }

        .tag-input-container.compact {
            min-height: 38px;
            padding: 4px 6px;
        }

        /* タグを動的な幅で flexbox レイアウトで表示 */
        .tag-input-container.has-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            align-items: start;
            align-content: start;
            padding: 8px;
            min-width: 200px; /* 最小幅を設定 */
        }

        /* 入力フィールドを新しい行に配置 */
        .tag-input-container.has-tags .tag-input {
            flex-basis: 100%;
            margin-top: 4px;
        }

        .tag {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
            color: #374151;
            flex-shrink: 0;
            min-height: 28px;
            box-sizing: border-box;
            max-width: fit-content; /* コンテンツに合わせて幅を調整 */
        }

        .tag-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            min-width: 0;
        }

        .tag-remove {
            background: none;
            border: none;
            color: #6b7280;
            cursor: pointer;
            font-size: 14px;
            line-height: 1;
            padding: 0;
            margin-left: 2px;
            width: 14px;
            height: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .tag-remove:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .tag-input {
            border: none;
            outline: none;
            flex: 1;
            min-width: 120px;
            font-size: 14px;
            padding: 2px 4px;
            background: transparent;
        }

        .tag-input::placeholder {
            color: #9ca3af;
        }

        /* Radio button styles */
        .radio-group {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-bottom: 8px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            width: 16px;
            height: 16px;
            margin: 0;
            cursor: pointer;
        }

        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-size: 14px;
            font-weight: normal;
            color: #374151;
        }

        /* Delay processing specific styles */
        .delay-processing-section {
            display: none;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e5e7eb;
        }

        .delay-processing-section.show {
            display: block;
        }

        .delay-date-input {
            margin-top: 8px;
            display: none;
        }

        .delay-date-input.show {
            display: block;
        }

        #order-panel-delay-btn {
            background-color: #f1423c;
            color: white;
            border-color: #f1423c;
        }

        #order-panel-delay-btn:hover:not(:disabled) {
            background-color: #f1423c;
            border-color: #f1423c;
        }

        #order-panel-delay-btn:disabled {
            background-color: #f3f4f6 !important;
            color: #9ca3af !important;
            border-color: #e5e7eb !important;
            cursor: not-allowed !important;
        }

        /* Settings Modal Styles */
        .settings-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1001;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .settings-modal-backdrop.show {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 1;
        }

        .settings-modal {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 800px;
            height: 640px; /* 固定高さに変更 */
            max-height: 640px; /* 最大高さを固定 */
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .settings-modal-backdrop.show .settings-modal {
            transform: scale(1);
        }

        .settings-modal-header {
            background: #1e293b;
            color: white;
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e5e7eb;
        }

        .settings-modal-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .settings-modal-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .settings-modal-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .settings-modal-close svg {
            width: 20px;
            height: 20px;
        }

        .settings-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            background: #f9fafb;
        }

        .settings-tab {
            flex: 1;
            padding: 16px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .settings-tab:hover {
            color: #2563eb;
            background: rgba(37, 99, 235, 0.05);
        }

        .settings-tab.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background: white;
        }

        .settings-tab-content {
            display: none;
        }

        .settings-tab-content.active {
            display: block;
        }

        .settings-modal-body {
            padding: 24px;
            height: calc(600px - 170px); /* ヘッダー、タブ、フッターの高さを考慮 */
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 24px;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e5e7eb;
        }

        .delivery-options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .delivery-option-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .delivery-option-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .delivery-option-item.selected {
            background: #dbeafe;
            border-color: #2563eb;
        }

        .delivery-option-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2563eb;
        }

        .delivery-option-label {
            font-size: 14px;
            color: #374151;
            cursor: pointer;
            flex: 1;
            user-select: none;
        }

        .settings-modal-footer {
            padding: 20px 24px;
            background: #f9fafb;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .settings-select-all-btn {
            padding: 8px 16px;
            background: #f3f4f6;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            color: #374151;
            transition: all 0.2s;
        }

        .settings-select-all-btn:hover {
            background: #e5e7eb;
            border-color: #d1d5db;
        }

        .settings-footer-actions {
            display: flex;
            gap: 12px;
            margin-left: auto;
        }

        /* CSV export footer actions */
        .csv-footer-actions {
            display: flex;
            gap: 8px;
        }

        .csv-footer-actions button {
            padding: 8px 16px;
            background: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .csv-footer-actions button:hover {
            background: #e5e7eb;
        }

        .settings-save-btn {
            padding: 10px 24px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .settings-save-btn:hover {
            background: #1d4ed8;
        }

        .settings-cancel-btn {
            padding: 10px 24px;
            background: #e5e7eb;
            color: #374151;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.2s;
        }

        .settings-cancel-btn:hover {
            background: #d1d5db;
        }

        /* Input Assistance Settings Styles */
        .input-assistance-controls {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .add-item-section {
            padding: 20px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .add-item-form {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }

        .add-item-form .form-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .add-item-form .form-input:focus {
            outline: none;
            border-color: #2563eb;
        }

        .add-item-form .btn {
            padding: 12px 24px;
            white-space: nowrap;
        }

        .assistance-items-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .assistance-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .assistance-item:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .assistance-item.disabled {
            background: #f3f4f6;
            color: #9ca3af;
        }

        .assistance-item-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #2563eb;
        }

        .assistance-item-text {
            flex: 1;
            font-size: 14px;
            color: #374151;
        }

        .assistance-item.disabled .assistance-item-text {
            color: #9ca3af;
        }

        .empty-assistance-message {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
            font-size: 14px;
            background: #f9fafb;
            border: 1px dashed #d1d5db;
            border-radius: 8px;
        }

        /* FAX送付先設定のスタイル */
        .fax-destination-form {
            margin-bottom: 24px;
        }

        .form-row {
            display: flex;
            gap: 16px;
            align-items: end;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-row .form-group:last-child {
            flex: 0 0 auto;
        }

        .fax-destinations-list {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .fax-destination-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
            transition: background-color 0.2s;
        }

        .fax-destination-item:last-child {
            border-bottom: none;
        }

        .fax-destination-item:hover {
            background-color: #f9fafb;
        }

        .fax-destination-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .fax-destination-company {
            font-weight: 600;
            color: #1f2937;
            font-size: 14px;
        }

        .fax-destination-contact {
            color: #6b7280;
            font-size: 13px;
        }

        .fax-destination-actions {
            display: flex;
            gap: 8px;
        }

        .fax-destination-actions button {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
            border: 1px solid;
            cursor: pointer;
            transition: all 0.2s;
        }

        .fax-destination-edit-btn {
            background: #ffffff;
            color: #2563eb;
            border-color: #2563eb;
        }

        .fax-destination-edit-btn:hover {
            background: #2563eb;
            color: #ffffff;
        }

        .fax-destination-delete-btn {
            background: #ffffff;
            color: #ef4444;
            border-color: #ef4444;
        }

        .fax-destination-delete-btn:hover {
            background: #ef4444;
            color: #ffffff;
        }

        .empty-fax-destinations-message {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
            font-size: 14px;
            background: #f9fafb;
            border: 1px dashed #d1d5db;
            border-radius: 8px;
        }

        /* CSV出力項目設定のスタイル */
        .csv-export-controls {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .csv-export-instructions {
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .csv-export-instructions p {
            margin: 0;
            color: #374151;
            font-size: 14px;
            line-height: 1.5;
        }

        .csv-export-items-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 12px;
            max-height: 400px;
            overflow-y: auto;
            padding: 8px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #ffffff;
        }

        .csv-export-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .csv-export-item:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .csv-export-item.selected {
            background: #eff6ff;
            border-color: #2563eb;
        }

        .csv-export-item-checkbox {
            width: 18px;
            height: 18px;
            accent-color: #2563eb;
            cursor: pointer;
        }

        .csv-export-item-label {
            flex: 1;
            font-size: 14px;
            color: #374151;
            cursor: pointer;
        }

        .csv-export-item.disabled .csv-export-item-label {
            color: #9ca3af;
        }

        .csv-export-item-order {
            width: 60px;
            padding: 6px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
            background: white;
            transition: border-color 0.2s;
        }

        .csv-export-item-order:focus {
            outline: none;
            border-color: #2563eb;
        }

        .csv-export-item-order:disabled {
            background: #f3f4f6;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .csv-export-actions {
            display: none;
        }

        /* FAX印刷設定のスタイル */
        .fax-print-enable-section {
            margin-bottom: 24px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .fax-print-enable-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            cursor: pointer;
        }

        .fax-print-enable-checkbox {
            width: 16px;
            height: 16px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }

        .fax-print-enable-checkbox:checked {
            background: #2563eb;
            border-color: #2563eb;
        }

        .fax-sender-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .fax-sender-form .form-row {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        .fax-sender-form .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .fax-sender-form .form-group .form-input {
            width: 100%;
            height: 40px;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .fax-sender-form .form-group .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        #fax-sender-info-section {
            opacity: 0.5;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        #fax-sender-info-section.enabled {
            opacity: 1;
            pointer-events: auto;
        }

        /* FAX Modal Styles */
        .fax-modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .fax-modal-backdrop.show {
            display: flex;
        }

        .fax-modal {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            display: flex;
            flex-direction: column;
        }

        .fax-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f9fafb;
        }

        .fax-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
        }

        .fax-modal-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            color: #6b7280;
            transition: all 0.2s;
        }

        .fax-modal-close:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .fax-modal-close svg {
            width: 20px;
            height: 20px;
        }

        .fax-modal-controls {
            padding: 16px 24px;
            border-bottom: 1px solid #e5e7eb;
            background: #ffffff;
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .fax-destination-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 200px;
        }

        .fax-destination-field label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .fax-font-size-field {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 140px;
        }

        .fax-font-size-field label {
            font-size: 12px;
            font-weight: 600;
            color: #374151;
        }

        .fax-destination-select,
        .fax-font-size-select {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            transition: border-color 0.2s;
        }

        .fax-destination-select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .fax-font-size-select:focus {
            outline: none;
            border-color: #2563eb;
        }

        .fax-send-btn {
            padding: 8px 16px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-left: auto;
        }

        .fax-send-btn:hover {
            background: #1d4ed8;
        }

        /* FAXアクションボタンのスタイル */
        .fax-action-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            padding: 24px;
            margin-top: 16px;
            border-top: 1px solid #e5e7eb;
        }

        .fax-pdf-arrange-btn,
        .fax-pdf-only-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .fax-pdf-arrange-btn {
            background: #2563eb;
            color: white;
        }

        .fax-pdf-arrange-btn:hover {
            background: #1d4ed8;
        }

        .fax-pdf-only-btn {
            background: #6b7280;
            color: white;
        }

        .fax-pdf-only-btn:hover {
            background: #4b5563;
        }

        .fax-modal-body {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: #ffffff;
        }

        .fax-template {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border: 1px solid #e5e7eb;
            font-family: 'MS Gothic', monospace;
            font-size: 12px;
            line-height: 1.4;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .fax-header {
            text-align: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #000;
            padding-bottom: 10px;
        }

        .fax-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .fax-company-info {
            text-align: right;
            margin-bottom: 15px;
            font-size: 10px;
            line-height: 1.3;
        }

        .fax-recipient-info {
            margin-bottom: 15px;
            font-size: 11px;
        }

        .fax-content {
            margin-bottom: 20px;
        }

        .fax-greeting {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .fax-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
            border: 2px solid #000;
        }

        .fax-table th,
        .fax-table td {
            border: 1px solid #000;
            padding: 8px;
            text-align: center;
            font-size: 11px;
        }

        .fax-table th {
            background: #f5f5f5;
            font-weight: bold;
        }

        .fax-table .item-name {
            text-align: left;
            font-size: 10px;
            line-height: 1.2;
        }

        .fax-table .item-description {
            text-align: left;
            font-size: 10px;
            line-height: 1.2;
        }

        .fax-table .quantity {
            text-align: right;
        }

        .fax-footer {
            margin-top: 20px;
            font-size: 10px;
            line-height: 1.5;
        }

        /* Font size variations for FAX template */
        .fax-template.font-small {
            font-size: 10px;
        }

        .fax-template.font-medium {
            font-size: 12px;
        }

        .fax-template.font-large {
            font-size: 14px;
        }

        .fax-template.font-small .fax-title {
            font-size: 16px;
        }

        .fax-template.font-medium .fax-title {
            font-size: 18px;
        }

        .fax-template.font-large .fax-title {
            font-size: 20px;
        }

        .fax-template.font-small .fax-table th,
        .fax-template.font-small .fax-table td {
            font-size: 10px;
            padding: 6px;
        }

        .fax-template.font-medium .fax-table th,
        .fax-template.font-medium .fax-table td {
            font-size: 12px;
            padding: 8px;
        }

        .fax-template.font-large .fax-table th,
        .fax-template.font-large .fax-table td {
            font-size: 14px;
            padding: 10px;
        }

        /* Individual font size classes for product and description */
        .fax-table .item-name.size-small {
            font-size: 10px !important;
        }

        .fax-table .item-name.size-medium {
            font-size: 12px !important;
        }

        .fax-table .item-name.size-large {
            font-size: 14px !important;
        }

        .fax-table .item-description.size-small {
            font-size: 10px !important;
        }

        .fax-table .item-description.size-medium {
            font-size: 12px !important;
        }

        .fax-table .item-description.size-large {
            font-size: 14px !important;
        }

        /* Inline editing styles for FAX template */
        .fax-table .item-name[contenteditable="true"],
        .fax-table .item-description[contenteditable="true"] {
            outline: 2px solid #2563eb;
            outline-offset: 2px;
            background-color: #fef3c7;
            transition: background-color 0.2s, outline 0.2s;
            cursor: text;
        }

        .fax-table .item-name[contenteditable="true"]:focus,
        .fax-table .item-description[contenteditable="true"]:focus {
            background-color: #fffbeb;
            outline-color: #1d4ed8;
        }

        .fax-table .item-name[contenteditable="true"]:hover,
        .fax-table .item-description[contenteditable="true"]:hover {
            background-color: #fef3c7;
        }

        .editable-indicator {
            position: relative;
        }

        .editable-indicator::before {
            content: "編集可能";
            position: absolute;
            top: -20px;
            left: 0;
            font-size: 10px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1;
        }

        .editable-indicator:hover::before {
            opacity: 1;
        }
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <span class="logo-title">Weblike SCM 2</span>
            </div>
            <nav class="nav-menu">
                <a href="#dashboard" class="nav-item active">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                    </svg>
                    ダッシュボード
                </a>
                <a href="#quotation" class="nav-item">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" />
                        <path fill-rule="evenodd"
                            d="M4 5a2 2 0 012-2 1 1 0 000 2H6a2 2 0 00-2 2v6a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-1a1 1 0 100-2h1a4 4 0 014 4v6a4 4 0 01-4 4H6a4 4 0 01-4-4V7a4 4 0 014-4z" />
                    </svg>
                    見積処理
                </a>
                <a href="#order" class="nav-item">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path
                            d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" />
                    </svg>
                    受注処理
                </a>
                <a href="#delivery" class="nav-item">
                    <svg class="nav-icon" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M8 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM15 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0z" />
                        <path
                            d="M3 4a1 1 0 00-1 1v10a1 1 0 001 1h1.05a2.5 2.5 0 014.9 0H10a1 1 0 001-1V5a1 1 0 00-1-1H3zM14 7a1 1 0 00-1 1v6.05A2.5 2.5 0 0115.95 16H17a1 1 0 001-1v-5a1 1 0 00-.293-.707l-2-2A1 1 0 0015 7h-1z" />
                    </svg>
                    納品処理
                </a>
            </nav>
            <div class="sidebar-quick">
                <button class="quick-item" data-action="settings" aria-label="設定">
                    <span class="qi-icon" aria-hidden>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="3.2" />
                            <path
                                d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 01-2.83 2.83l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-4 0v-.17a1.65 1.65 0 00-1-1.51 1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83-2.83l.06-.06A1.65 1.65 0 004.6 15a1.65 1.65 0 00-1.51-1H3a2 2 0 010-4h.09c.67 0 1.25-.41 1.51-1A1.65 1.65 0 004.6 7.7l-.06-.06A2 2 0 017.37 4.8l.06.06c.49.49 1.14.78 1.82.78.68 0 1.33-.29 1.82-.78l.06-.06a2 2 0 012.83 2.83l-.06.06c-.3.3-.47.7-.47 1.12 0 .42.17.82.47 1.12.3.3.7.47 1.12.47.42 0 .82-.17 1.12-.47l.06-.06A2 2 0 0120.8 12l-.06.06c-.3.3-.47.7-.47 1.12 0 .42.17.82.47 1.12z" />
                        </svg>
                    </span>
                    設定
                </button>
                <button class="quick-item" data-action="help" aria-label="操作マニュアル">
                    <span class="qi-icon" aria-hidden>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="9" />
                            <path d="M9.3 9a3 3 0 115.4 1.5c-.6 1.2-2.7 2.1-2.7 2.1" />
                            <circle cx="12" cy="17" r=".8" />
                        </svg>
                    </span>
                    操作マニュアル
                </button>
                <button class="quick-item" data-action="feedback" aria-label="ご意見・ご要望フォーム">
                    <span class="qi-icon" aria-hidden>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z" />
                        </svg>
                    </span>
                    ご意見・ご要望フォーム
                </button>
            </div>
            <div class="sidebar-user"
                style="margin-top:auto; padding:16px; border-top:1px solid #e5e7eb; display:flex; align-items:flex-start; gap:12px;">
                <div class="user-main" style="display:flex; align-items:center; gap:12px; flex:1;">
                    <div class="user-avatar"
                        style="width:40px; height:40px; background:#2563eb; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; font-size:18px;">
                        山</div>
                    <div>
                        <button id="user-name-btn"
                            style="font-size:14px; font-weight:500; background:none; border:none; padding:0; cursor:pointer; color:#fff;">山田太郎</button>
                    </div>
                </div>
                <div class="user-menu" id="user-menu">
                    <button class="menu-item" data-action="logout">
                        <span class="menu-icon" aria-hidden>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 17l5-5-5-5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M21 12H9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                    stroke-linejoin="round" />
                                <path d="M13 19H6a2 2 0 01-2-2V7a2 2 0 012-2h7" stroke="currentColor" stroke-width="1.5"
                                    stroke-linecap="round" stroke-linejoin="round" />
                            </svg>
                        </span>
                        ログアウト
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div style="display:flex; align-items:center; gap:12px;">
                    <!-- Mobile menu button -->
                    <button id="mobile-menu-btn" class="mobile-menu-btn" aria-label="メニューを開く" style="display: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <!-- Desktop sidebar toggle button -->
                    <button id="sidebar-toggle" class="icon-btn" aria-label="サイドメニューの表示/非表示" style="margin-top: px;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="16" rx="3" ry="3" />
                            <line x1="9" y1="4" x2="9" y2="20" />
                            <circle cx="6" cy="8" r="1.4" />
                            <circle cx="6" cy="12" r="1.4" />
                            <circle cx="6" cy="16" r="1.4" />
                        </svg>
                    </button>
                    <h1 class="page-title">ダッシュボード</h1>
                    <!-- Warehouse Selection Dropdown (visible in quotation, order, and delivery views) -->
                    <div class="dropdown" id="header-warehouse-dropdown" style="display: none;">
                        <button class="filter-btn" id="warehouse-dropdown-btn"
                            style="padding: 8px 16px; font-size: 14px;">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 2L3 7v11a2 2 0 002 2h10a2 2 0 002-2V7l-7-5z"></path>
                                <polyline points="9,21 9,13 11,13 11,21"></polyline>
                            </svg>
                            <span id="warehouse-btn-text">全倉庫</span>
                            <svg width="12" height="12" fill="currentColor" viewBox="0 0 20 20"
                                style="margin-left: 4px;">
                                <path fill-rule="evenodd"
                                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z">
                                </path>
                            </svg>
                        </button>
                        <div class="dropdown-menu" id="warehouse-dropdown-menu">
                            <div class="dropdown-item" data-warehouse="all">全倉庫</div>
                            <div class="dropdown-item" data-warehouse="zama">座間倉庫</div>
                            <div class="dropdown-item" data-warehouse="yokohama">横浜倉庫</div>
                            <div class="dropdown-item" data-warehouse="koshien">甲子園倉庫</div>
                        </div>
                    </div>
                    <!-- Panel Toggle Button -->
                    <button id="panel-toggle-btn" class="icon-btn" aria-label="編集パネルの表示/非表示" style="display: none;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="16" rx="3" ry="3" />
                            <line x1="9" y1="4" x2="9" y2="20" />
                            <circle cx="6" cy="8" r="1.4" />
                            <circle cx="6" cy="12" r="1.4" />
                            <circle cx="6" cy="16" r="1.4" />
                            <line x1="15" y1="8" x2="19" y2="8" />
                            <line x1="15" y1="12" x2="19" y2="12" />
                            <line x1="15" y1="16" x2="19" y2="16" />
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="content">
                <!-- Delivery Alert Modal -->
                <div class="delivery-alert-backdrop" id="delivery-alert-modal">
                    <div class="delivery-alert-modal">
                        <div class="delivery-alert-header">
                            <svg class="delivery-alert-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd"
                                    d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                    clip-rule="evenodd" />
                            </svg>
                            <div class="delivery-alert-title">納期超過アラート</div>
                            <button class="delivery-alert-close" id="delivery-alert-close">&times;</button>
                        </div>
                        <div class="delivery-alert-body">
                            <div class="delivery-alert-summary">
                                <h4 style="color: #dc2626; margin-bottom: 8px; font-size: 16px;">⚠️  遅延処理を行ってください
                                </h4>
                                <p style="color: #7f1d1d; font-size: 14px;">お客様への影響を避けるため、早急なご確認とご対応をお願いいたします。</p>
                            </div>
                            <div class="delivery-alert-list">
                                <div class="warehouse-summary-item warehouse-header-zama">
                                    <div class="warehouse-summary-content">
                                        <div class="warehouse-summary-name">座間フルフィルメントセンター</div>
                                        <div class="warehouse-summary-detail">神奈川県座間市広野台2-10-10 GLP座間 1階A区</div>
                                    </div>
                                    <div class="warehouse-summary-actions">
                                        <button class="delivery-detail-btn"
                                            onclick="showWarehouseDetail('zama')">対象リスト<span
                                                class="detail-btn-badge">3</span></button>
                                    </div>
                                </div>

                                <div class="warehouse-summary-item warehouse-header-yokohama">
                                    <div class="warehouse-summary-content">
                                        <div class="warehouse-summary-name">横浜フルフィルメントセンター</div>
                                        <div class="warehouse-summary-detail">神奈川県横浜市金沢区福浦2-1-1 横浜物流センター 2階B区</div>
                                    </div>
                                    <div class="warehouse-summary-actions">
                                        <button class="delivery-detail-btn"
                                            onclick="showWarehouseDetail('yokohama')">対象リスト<span
                                                class="detail-btn-badge">2</span></button>
                                    </div>
                                </div>

                                <div class="warehouse-summary-item warehouse-header-koshien">
                                    <div class="warehouse-summary-content">
                                        <div class="warehouse-summary-name">甲子園フルフィルメントセンター</div>
                                        <div class="warehouse-summary-detail">兵庫県西宮市甲子園町8-15 甲子園ロジスティクス 3階C区</div>
                                    </div>
                                    <div class="warehouse-summary-actions">
                                        <button class="delivery-detail-btn"
                                            onclick="showWarehouseDetail('koshien')">対象リスト<span
                                                class="detail-btn-badge">1</span></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard View -->
                <div id="dashboard-view">
                    <!-- Update Information -->
                    <div class="notification-area" style="margin-top: 20px;">
                        <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">お知らせ</h3>
                        <div class="notification update-notification read" id="update-notification"
                            style="background-color: #f8fafc; border-color: #e2e8f0; position: relative;">
                            <div class="notification-text">
                                <div class="update-title" id="update-title">
                                    <ul style="list-style: none; padding: 0; margin: 0;">
                                        <li style="margin-bottom: 8px;">【2025年08月18日（月）】Webike-SCM お知らせ</li>
                                        <li style="margin-bottom: 8px;">【2025年08月20日（火）】システムメンテナンスのお知らせ</li>
                                        <li>【2025年08月15日（木）】新機能リリースのご案内</li>
                                    </ul>
                                </div>
                            </div>
                            <div class="new-badge" id="new-badge">NEW</div>
                            <button class="view-all-notifications-btn" id="view-all-notifications-btn">すべて見る</button>
                        </div>
                    </div>

                    <!-- Update Modal -->
                    <div class="update-modal-backdrop" id="update-modal">
                        <div class="update-modal">
                            <div class="update-modal-header">
                                <div class="update-modal-title">お知らせ</div>
                                <button class="update-modal-close" id="update-modal-close">&times;</button>
                            </div>
                            <div class="update-modal-body">
                                <h4 style="margin-bottom: 16px; color: #0ea5e9;">【2025年08月18日（月）】Webike-SCM お知らせ</h4>
                                <p style="margin-bottom: 16px;">平素より弊社サービスをご利用いただき、ありがとうございます。</p>
                                <p style="margin-bottom: 16px;">2025年08月18日（月）　夜間にWebike-SCMのバグ修正を行いました。</p>
                                <p style="margin-bottom: 16px;">
                                    今回のアップデートは、一部仕入先様の処理中に下記のエラーメッセージが表示される事象への対応となり、現在は解消しております。</p>
                                <p style="margin-bottom: 16px; font-weight: 600;">修正内容：</p>
                                <ul style="margin-left: 20px; margin-bottom: 16px;">
                                    <li style="margin-bottom: 8px;">見積処理中のタイムアウトエラーを修正</li>
                                    <li style="margin-bottom: 8px;">一部ブラウザでの表示崩れを修正</li>
                                    <li style="margin-bottom: 8px;">CSV出力時のエラーハンドリングを改善</li>
                                </ul>
                                <p style="color: #6b7280; font-size: 14px;">何かご不明な点がございましたら、サポートまでお問い合わせください。</p>
                            </div>
                        </div>
                    </div>

                    <!-- All Notifications Modal -->
                    <div class="all-notifications-modal-backdrop" id="all-notifications-modal-backdrop">
                        <div class="all-notifications-modal">
                            <div class="all-notifications-modal-header">
                                <div class="all-notifications-modal-title">過去のお知らせ</div>
                                <button class="all-notifications-modal-close" id="all-notifications-modal-close">&times;</button>
                            </div>
                            <div class="all-notifications-modal-body">
                                <div class="all-notifications-list-container">
                                    <ul class="all-notifications-list">
                                        <li><button class="notification-title-btn" data-index="0">【2025年08月18日（月）】Webike-SCM お知らせ</button></li>
                                        <li><button class="notification-title-btn" data-index="1">【2025年08月20日（火）】システムメンテナンスのお知らせ</button></li>
                                        <li><button class="notification-title-btn" data-index="2">【2025年08月15日（木）】新機能リリースのご案内</button></li>
                                        <li><button class="notification-title-btn" data-index="3">【2025年08月10日（月）】セキュリティアップデートのお知らせ</button></li>
                                        <li><button class="notification-title-btn" data-index="4">【2025年08月05日（水）】新機能追加のお知らせ</button></li>
                                        <li><button class="notification-title-btn" data-index="5">【2025年07月30日（火）】システム改善のお知らせ</button></li>
                                    </ul>
                                </div>
                                <div class="notification-detail-panel" id="notification-detail-panel">
                                    <div class="notification-detail-header">
                                        <div class="notification-detail-title" id="notification-detail-title"></div>
                                        <div class="notification-detail-date" id="notification-detail-date"></div>
                                    </div>
                                    <div class="notification-detail-content" id="notification-detail-content"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Warehouse Status -->
                    <div style="margin-top: 20px;">
                        <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">倉庫別ステータス件数</h3>
                        <div class="dashboard-grid">
                            <!-- 座間倉庫 -->
                            <div class="warehouse-card zama">
                                <div class="warehouse-header">
                                    <h3 class="warehouse-name">座間フルフィルメントセンター</h3>
                                    <div class="warehouse-status"></div>
                                </div>
                                <div class="warehouse-info">
                                    〒252-0012<br>
                                    神奈川県座間市広野台2-10-10 GLP座間 1階A区 001<br>
                                    電話番号：050-1743-7370
                                </div>
                                <div class="status-grid">
                                    <div class="status-item">
                                        <div class="status-label">見積処理</div>
                                        <div class="status-value">未処理: <span class="status-link" data-warehouse="zama"
                                                data-action="quotation-unprocessed">157件</span> / 見積中: 0件</div>
                                    </div>
                                    <div class="status-item">
                                        <div class="status-label">受注処理</div>
                                        <div class="status-value">未処理: <span class="status-link" data-warehouse="zama"
                                                data-action="order-unprocessed">7件</span> / 在庫あり: 3件 / 手配中: 0件 / 手配済: 2件
                                            / <span style="color: #ef4444;">納期超過: 1件</span> / BO: 2件</div>
                                    </div>
                                    <div class="status-item">
                                        <div class="status-label">納品処理</div>
                                        <div class="status-value">出荷待: <span class="status-link" data-warehouse="zama"
                                                data-action="delivery-wait">0件</span> / 出荷済: 5件</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 横浜倉庫 -->
                            <div class="warehouse-card yokohama">
                                <div class="warehouse-header">
                                    <h3 class="warehouse-name">横浜フルフィルメントセンター</h3>
                                    <div class="warehouse-status"></div>
                                </div>
                                <div class="warehouse-info">
                                    〒242-0008<br>
                                    神奈川県大和市中央林間西6丁目8-26 001<br>
                                    電話番号：050-5497-3532
                                </div>
                                <div class="status-grid">
                                    <div class="status-item">
                                        <div class="status-label">見積処理</div>
                                        <div class="status-value">未処理: <span class="status-link"
                                                data-warehouse="yokohama"
                                                data-action="quotation-unprocessed">157件</span> / 見積中: 0件</div>
                                    </div>
                                    <div class="status-item">
                                        <div class="status-label">受注処理</div>
                                        <div class="status-value">未処理: <span class="status-link"
                                                data-warehouse="yokohama" data-action="order-unprocessed">7件</span> /
                                            在庫あり: 3件 / 手配中: 0件 / 手配済: 2件 / <span style="color: #ef4444;">納期超過: 1件</span>
                                            / BO: 2件</div>
                                    </div>
                                    <div class="status-item">
                                        <div class="status-label">納品処理</div>
                                        <div class="status-value">出荷待: <span class="status-link"
                                                data-warehouse="yokohama" data-action="delivery-wait">0件</span> / 出荷済:
                                            5件</div>
                                    </div>
                                </div>
                            </div>

                            <!-- 甲子園倉庫 -->
                            <div class="warehouse-card koshien">
                                <div class="warehouse-header">
                                    <h3 class="warehouse-name">甲子園フルフィルメントセンター</h3>
                                    <div class="warehouse-status"></div>
                                </div>
                                <div class="warehouse-info">
                                    〒663-8142<br>
                                    兵庫県西宮市鳴尾浜1－20 GLP鳴尾浜 2階B区 001<br>
                                    電話番号：050-1753-8600
                                </div>
                                <div class="status-grid">
                                    <div class="status-item">
                                        <div class="status-label">見積処理</div>
                                        <div class="status-value">未処理: <span class="status-link"
                                                data-warehouse="koshien" data-action="quotation-unprocessed">157件</span>
                                            / 見積中: 0件</div>
                                    </div>
                                    <div class="status-item">
                                        <div class="status-label">受注処理</div>
                                        <div class="status-value">未処理: <span class="status-link"
                                                data-warehouse="koshien" data-action="order-unprocessed">7件</span> /
                                            在庫あり: 3件 / 手配中: 0件 / 手配済: 2件 / <span style="color: #ef4444;">納期超過: 1件</span>
                                            / BO: 2件</div>
                                    </div>
                                    <div class="status-item">
                                        <div class="status-label">納品処理</div>
                                        <div class="status-value">出荷待: <span class="status-link"
                                                data-warehouse="koshien" data-action="delivery-wait">0件</span> / 出荷済: 5件
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Warehouse Status -->
                    <div style="margin-top: 40px;">
                        <h3 style="margin-bottom: 16px; font-size: 18px; font-weight: 600;">全倉庫ステータス件数</h3>
                        <div class="warehouse-card"
                            style="background: #e2e8f0; color: #1f2937; max-width: 800px; border: 1px solid #cbd5e1;">
                            <div class="warehouse-header">
                                <h3 class="warehouse-name" style="color: #1f2937;">全フルフィルメントセンター合計</h3>
                                <div class="warehouse-status" style="background: #4CAF50;"></div>
                            </div>
                            <div class="warehouse-info" style="color: #64748b;">
                                座間・横浜・甲子園の3拠点合計値
                            </div>
                            <div class="status-grid">
                                <div class="status-item" style="background: #f8fafc; border: 1px solid #d1d5db;">
                                    <div class="status-label" style="color: #64748b;">見積処理</div>
                                    <div class="status-value" style="color: #1f2937; font-weight: 700;">未処理: <span
                                            class="status-link" data-warehouse="all"
                                            data-action="quotation-unprocessed">471件</span> / 見積中: 0件</div>
                                </div>
                                <div class="status-item" style="background: #f8fafc; border: 1px solid #d1d5db;">
                                    <div class="status-label" style="color: #64748b;">受注処理</div>
                                    <div class="status-value" style="color: #1f2937; font-weight: 700;">未処理: <span
                                            class="status-link" data-warehouse="all"
                                            data-action="order-unprocessed">21件</span> / 在庫あり: 9件 / 手配中: 0件 / 手配済: 6件 /
                                        <span style="color: #ef4444;">納期超過: 3件</span> / BO: 6件
                                    </div>
                                </div>
                                <div class="status-item" style="background: #f8fafc; border: 1px solid #d1d5db;">
                                    <div class="status-label" style="color: #64748b;">納品処理</div>
                                    <div class="status-value" style="color: #1f2937; font-weight: 700;">出荷待: <span
                                            class="status-link" data-warehouse="all"
                                            data-action="delivery-wait">0件</span> / 出荷済: 15件</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quotation Processing View (Hidden by default) -->
                <div id="quotation-view" style="display: none;">
                    <div class="tabs">
                        <div class="tab active" data-status="unprocessed">未処理 <span class="tab-badge">157</span></div>
                        <div class="tab" data-status="processing">見積中</div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-tools">
                            <!-- Enhanced Search Fields -->
                            <div class="search-fields">
                                <div class="search-field">
                                    <label for="maker-search">商品メーカー</label>
                                    <div class="tag-input-container compact" id="maker-tag-container">
                                        <input type="text" class="tag-input" id="maker-search"
                                            placeholder="商品メーカーを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="part-number-search">品番</label>
                                    <div class="tag-input-container compact" id="part-number-tag-container">
                                        <input type="text" class="tag-input" id="part-number-search"
                                            placeholder="品番を入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="jan-search">JAN</label>
                                    <div class="tag-input-container compact" id="jan-tag-container">
                                        <input type="text" class="tag-input" id="jan-search"
                                            placeholder="JANコードを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field-with-filter">
                                    <div class="search-field">
                                        <label for="scm-code-search">SCMコード</label>
                                        <div class="tag-input-container compact" id="scm-code-tag-container">
                                            <input type="text" class="tag-input" id="scm-code-search"
                                                placeholder="SCMコードを入力 (Enter/カンマで追加)">
                                        </div>
                                    </div>
                                    <button type="button" class="search-btn" id="quotation-search-btn" title="検索">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </button>
                                    <button type="button" class="search-filter-btn" title="詳細検索項目を追加表示します">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Dynamic Action Buttons -->
                            <div class="dynamic-actions" id="dynamic-actions">
                                <!-- 見積処理関連のボタンは編集モーダルに統合 -->
                                <div class="dropdown">
                                    <button class="icon-btn-csv" id="export-dropdown-btn" title="CSV出力" style="margin-top: 22px;"disabled>
                                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                    </button>
                                    <div class="dropdown-menu" id="export-dropdown-menu" style="left: auto; right: 0;">
                                    </div>
                                </div>
                                <button class="icon-btn-fax" id="fax-modal-btn" title="書類出力" disabled>
                                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Additional Filters -->
                        <div class="additional-filters" id="quotation-additional-filters">
                            <div class="additional-filters-grid">
                                <div class="filter-field">
                                    <label for="quotation-product-name-filter">商品名</label>
                                    <input type="text" id="quotation-product-name-filter" placeholder="商品名を入力">
                                </div>
                                <div class="date-range-field">
                                    <label>受注日</label>
                                    <div class="date-range-inputs">
                                        <input type="date" id="quotation-order-date-from" placeholder="開始日">
                                        <span class="date-range-separator">〜</span>
                                        <input type="date" id="quotation-order-date-to" placeholder="終了日">
                                    </div>
                                </div>
                                <div class="date-range-field ship-date-field">
                                    <label>出荷日</label>
                                    <div class="date-range-inputs">
                                        <input type="date" id="quotation-ship-date-from" placeholder="開始日">
                                        <span class="date-range-separator">〜</span>
                                        <input type="date" id="quotation-ship-date-to" placeholder="終了日">
                                    </div>
                                </div>
                            </div>

                            <!-- 自社管理番号と担当備考フィールド -->
                            <div class="management-fields">
                                <div class="management-field">
                                    <label for="quotation-management-number">自社管理番号</label>
                                    <input type="text" id="quotation-management-number" placeholder="自社管理番号を入力">
                                </div>
                                <div class="management-field">
                                    <label for="quotation-staff-memo">担当備考</label>
                                    <input type="text" id="quotation-staff-memo" placeholder="担当備考を入力">
                                </div>
                            </div>
                        </div>

                        <div class="table-scroll">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th width="45px"><input type="checkbox" class="checkbox"></th>
                                        <th width="80px">明細情報</th><!-- for toggle button -->
                                        <th class="sortable" data-column="request-date">Webike依頼日<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="scm-code">SCMコード<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="maker">商品メーカー<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-name">商品名<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-number">商品番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="jan">JAN<span class="sort-indicator"></span>
                                        </th>
                                        <th class="sortable" data-column="price">定価(税込)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="cost-price">仕切価格(税抜)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="quantity">注文数<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="management-number">自社管理番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="staff-memo">担当者備考<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="rc-memo">RC担当備考<span
                                                class="sort-indicator"></span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/05/30</td>
                                        <td>160530R02654</td>
                                        <td>田中商会</td>
                                        <td>チェーンカッター＆カシメルセット</td>
                                        <td>ca1047</td>
                                        <td></td>
                                        <td>¥4,428</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td></td>
                                        <td class="rc-memo-important">【自動OFF】フロント：18Ｔ　リア：42Ｔ無ければ41Ｔ　オフセット量：不明　減速比2.333
                                        </td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=ca1047" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/05/30</td>
                                        <td>160530R02890</td>
                                        <td>XAMザム</td>
                                        <td>CLASSICシリーズ リアスプロケット</td>
                                        <td>A3208-50T</td>
                                        <td></td>
                                        <td>¥11,880</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td></td>
                                        <td class="rc-memo-important">【自動OFF】フロント：18Ｔ　リア：42Ｔ無ければ41Ｔ　オフセット量：不明　減速比2.333
                                        </td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=A3208-50T"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/05/30</td>
                                        <td>160530R02896</td>
                                        <td>XAMザム</td>
                                        <td>フロントスプロケット</td>
                                        <td>C3201-14T</td>
                                        <td></td>
                                        <td>¥2,700</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=C3201-14T"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/02</td>
                                        <td>160602R03001</td>
                                        <td>キジマ</td>
                                        <td>グリップヒーター</td>
                                        <td>K-HEAT-01</td>
                                        <td>4981234567890</td>
                                        <td>¥9,800</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=K-HEAT-01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/02</td>
                                        <td>160602R03002</td>
                                        <td>デイトナ</td>
                                        <td>USB電源</td>
                                        <td>USB-2P</td>
                                        <td></td>
                                        <td>¥2,200</td>
                                        <td>¥0</td>
                                        <td>2</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=USB-2P" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/03</td>
                                        <td>160603R03003</td>
                                        <td>エーモン</td>
                                        <td>リレーキット</td>
                                        <td>AM-RELAY</td>
                                        <td>4905034012345</td>
                                        <td>¥1,480</td>
                                        <td>¥0</td>
                                        <td>3</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=AM-RELAY"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/03</td>
                                        <td>160603R03004</td>
                                        <td>SP武川</td>
                                        <td>マフラーガスケット</td>
                                        <td>SP-GSKT</td>
                                        <td></td>
                                        <td>¥980</td>
                                        <td>¥0</td>
                                        <td>5</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=SP-GSKT" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/04</td>
                                        <td>160604R03005</td>
                                        <td>キタコ</td>
                                        <td>スプロケット</td>
                                        <td>KT-SPR-15T</td>
                                        <td></td>
                                        <td>¥3,200</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="14">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=KT-SPR-15T"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="pagination"></div>
                    </div>
                </div>

                <!-- Order Processing View (Hidden by default) -->
                <div id="order-view" style="display: none;">
                    <div class="tabs">
                        <div class="tab active">未処理 <span class="tab-badge">7</span></div>
                        <div class="tab">手配中</div>
                        <div class="tab">手配済</div>
                        <div class="tab">在庫あり</div>
                        <div class="tab">納期超過</div>
                        <div class="tab">BO</div>
                    </div>

                    <div class="data-table-container">
                        <div class="table-tools">
                            <!-- Search Fields -->
                            <div class="search-fields">
                                <div class="search-field">
                                    <label for="order-maker-search">商品メーカー</label>
                                    <div class="tag-input-container compact" id="order-maker-tag-container">
                                        <input type="text" class="tag-input" id="order-maker-search"
                                            placeholder="商品メーカーを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="order-part-number-search">品番</label>
                                    <div class="tag-input-container compact" id="order-part-number-tag-container">
                                        <input type="text" class="tag-input" id="order-part-number-search"
                                            placeholder="品番を入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="order-jan-search">JAN</label>
                                    <div class="tag-input-container compact" id="order-jan-tag-container">
                                        <input type="text" class="tag-input" id="order-jan-search"
                                            placeholder="JANを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field-with-filter">
                                    <div class="search-field">
                                        <label for="order-scm-code-search">SCMコード</label>
                                        <div class="tag-input-container compact" id="order-scm-code-tag-container">
                                            <input type="text" class="tag-input" id="order-scm-code-search"
                                                placeholder="SCMコードを入力 (Enter/カンマで追加)">
                                        </div>
                                    </div>
                                    <button type="button" class="search-btn" id="order-search-btn" title="検索">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </button>
                                    <button type="button" class="search-filter-btn" title="フィルター">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="dynamic-actions" id="order-dynamic-actions">
                                <button class="icon-btn-csv" id="order-export-csv-btn" title="CSV出力" style="margin-top: 22px;">
                                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </button>
                                <button class="icon-btn-fax" id="order-fax-modal-btn" title="書類出力">
                                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </button>
                                <button class="icon-btn-csv" id="order-delay-export-csv-btn" title="CSV出力"
                                    style="display:none;">
                                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </button>
                                <button class="icon-btn-fax" id="order-delay-fax-modal-btn" title="書類出力"
                                    style="display:none;">
                                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Additional Filters -->
                        <div class="additional-filters" id="order-additional-filters">
                            <div class="additional-filters-grid">
                                <div class="filter-field">
                                    <label for="order-product-name-filter">商品名</label>
                                    <input type="text" id="order-product-name-filter" placeholder="商品名を入力">
                                </div>
                                <div class="date-range-field">
                                    <label>受注日</label>
                                    <div class="date-range-inputs">
                                        <input type="date" id="order-order-date-from" placeholder="開始日">
                                        <span class="date-range-separator">〜</span>
                                        <input type="date" id="order-order-date-to" placeholder="終了日">
                                    </div>
                                </div>
                                <div class="date-range-field ship-date-field">
                                    <label>出荷日</label>
                                    <div class="date-range-inputs">
                                        <input type="date" id="order-ship-date-from" placeholder="開始日">
                                        <span class="date-range-separator">〜</span>
                                        <input type="date" id="order-ship-date-to" placeholder="終了日">
                                    </div>
                                </div>
                            </div>

                            <!-- 自社管理番号と担当備考フィールド -->
                            <div class="management-fields">
                                <div class="management-field">
                                    <label for="order-management-number">自社管理番号</label>
                                    <input type="text" id="order-management-number" placeholder="自社管理番号を入力">
                                </div>
                                <div class="management-field">
                                    <label for="order-staff-memo">担当備考</label>
                                    <input type="text" id="order-staff-memo" placeholder="担当備考を入力">
                                </div>
                            </div>
                        </div>

                        <div class="table-scroll">
                            <!-- 未処理・手配中タブ用のテーブル -->
                            <table class="data-table" id="order-unprocessed-table">
                                <thead>
                                    <tr>
                                        <th width="45px"><input type="checkbox" class="checkbox"
                                                id="order-main-checkbox"></th>
                                        <th width="80px">明細情報</th><!-- for toggle button -->
                                        <th class="sortable" data-column="order-date">webike依頼日<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="scm-code">SCMコード<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="maker">商品メーカー<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-name">商品名<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-number">商品番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="jan">JAN<span class="sort-indicator"></span>
                                        </th>
                                        <th class="sortable" data-column="price">定価(税込)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="cost-price">仕切価格(税抜)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="quantity">注文数<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="management-number">自社管理番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="delivery-date">納期<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="staff-memo">担当者備考<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="rc-memo">RC担当備考<span
                                                class="sort-indicator"></span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/01</td>
                                        <td>160601R01001</td>
                                        <td>DAYTONA</td>
                                        <td>ハイスロキット</td>
                                        <td>12345</td>
                                        <td>4909449411111</td>
                                        <td>¥8,800</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>在庫あり</td>
                                        <td></td>
                                        <td class="rc-memo-important">【自動OFF】フロント：18Ｔ　リア：42Ｔ無ければ41Ｔ　オフセット量：不明　減速比2.333
                                        </td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=12345" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/01</td>
                                        <td>160601R01002</td>
                                        <td>キタコ</td>
                                        <td>ライトカウル</td>
                                        <td>KT-001</td>
                                        <td></td>
                                        <td>¥12,100</td>
                                        <td>¥0</td>
                                        <td>2</td>
                                        <td></td>
                                        <td>1週間</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=KT-001" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/01</td>
                                        <td>160601R01003</td>
                                        <td>SP武川</td>
                                        <td>リアサス</td>
                                        <td>SP-777</td>
                                        <td></td>
                                        <td>¥22,000</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>在庫あり</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=SP-777" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/02</td>
                                        <td>160602R01004</td>
                                        <td>キタコ</td>
                                        <td>ミラー</td>
                                        <td>KT-MIR-01</td>
                                        <td>4901234567890</td>
                                        <td>¥2,200</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>欠品中未定</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=KT-MIR-01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/02</td>
                                        <td>160602R01005</td>
                                        <td>デイトナ</td>
                                        <td>スマホホルダー</td>
                                        <td>DT-HLD-02</td>
                                        <td></td>
                                        <td>¥3,980</td>
                                        <td>¥0</td>
                                        <td>2</td>
                                        <td></td>
                                        <td>在庫あり</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=DT-HLD-02"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/03</td>
                                        <td>160603R01006</td>
                                        <td>キジマ</td>
                                        <td>ウィンカー</td>
                                        <td>KJ-WNK-01</td>
                                        <td>4987654321098</td>
                                        <td>¥4,400</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>3日</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=KJ-WNK-01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/03</td>
                                        <td>160603R01007</td>
                                        <td>SP武川</td>
                                        <td>ハンドルバー</td>
                                        <td>SP-HND-01</td>
                                        <td></td>
                                        <td>¥8,800</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>5日</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=SP-HND-01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/04</td>
                                        <td>160604R01008</td>
                                        <td>エーモン</td>
                                        <td>ヒューズホルダー</td>
                                        <td>AM-FUSE</td>
                                        <td></td>
                                        <td>¥680</td>
                                        <td>¥0</td>
                                        <td>4</td>
                                        <td></td>
                                        <td>1週間</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=AM-FUSE" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value"></span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value"></span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span class="value"></span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/05</td>
                                        <td>160605R01009</td>
                                        <td>YOSHIMURA</td>
                                        <td>エキゾーストパイプ</td>
                                        <td>YS-EX01</td>
                                        <td>4982398765432</td>
                                        <td>¥58,000</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td>YS-001</td>
                                        <td>1か月</td>
                                        <td>取り寄せ商品</td>
                                        <td>【要確認】車種適合要チェック</td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=YS-EX01" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">フルエキゾースト</span></div>
                                                    <div><span class="label">備考:</span><span class="value">車種専用設計</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">ホンダ</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/05</td>
                                        <td>160605R01010</td>
                                        <td>BREMBO</td>
                                        <td>ブレーキパッド</td>
                                        <td>BR-PAD01</td>
                                        <td>8058796543210</td>
                                        <td>¥14,500</td>
                                        <td>¥0</td>
                                        <td>2</td>
                                        <td>BR-001</td>
                                        <td>4日</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=BR-PAD01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">フロント用</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">高性能パッド</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">汎用</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/06</td>
                                        <td>160606R01011</td>
                                        <td>K&N</td>
                                        <td>エアフィルター</td>
                                        <td>KN-AF101</td>
                                        <td>0191749876543</td>
                                        <td>¥7,800</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>2週間</td>
                                        <td>洗浄可能</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=KN-AF101"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">高流量フィルター</span></div>
                                                    <div><span class="label">備考:</span><span
                                                            class="value">繰り返し使用可能</span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">多車種対応</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/06</td>
                                        <td>160606R01012</td>
                                        <td>MOTUL</td>
                                        <td>エンジンオイル</td>
                                        <td>MT-7100</td>
                                        <td>3374650123456</td>
                                        <td>¥3,200</td>
                                        <td>¥0</td>
                                        <td>4</td>
                                        <td></td>
                                        <td>10日</td>
                                        <td>4L缶</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=MT-7100" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">10W-40</span></div>
                                                    <div><span class="label">備考:</span><span
                                                            class="value">高性能エンジンオイル</span></div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">4輪・2輪共用</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/07</td>
                                        <td>160607R01013</td>
                                        <td>NGK</td>
                                        <td>スパークプラグ</td>
                                        <td>NGK-CR8E</td>
                                        <td>0876543211234</td>
                                        <td>¥980</td>
                                        <td>¥0</td>
                                        <td>4</td>
                                        <td></td>
                                        <td>在庫あり</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=NGK-CR8E"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">標準プラグ</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">高品質プラグ</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">多車種対応</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/07</td>
                                        <td>160607R01014</td>
                                        <td>PIRELLI</td>
                                        <td>タイヤ</td>
                                        <td>PI-DIABLO</td>
                                        <td>8019227654321</td>
                                        <td>¥28,000</td>
                                        <td>¥0</td>
                                        <td>2</td>
                                        <td>PI-001</td>
                                        <td>在庫あり</td>
                                        <td>前後セット</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=PI-DIABLO"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">スポーツタイヤ</span></div>
                                                    <div><span class="label">備考:</span><span class="value">前後セット</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">スポーツバイク用</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/08</td>
                                        <td>160608R01015</td>
                                        <td>OHLINS</td>
                                        <td>リアショック</td>
                                        <td>OH-RSU46</td>
                                        <td>7333650987654</td>
                                        <td>¥98,000</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td>OH-001</td>
                                        <td>1週間</td>
                                        <td>受注生産</td>
                                        <td>【納期要確認】受注生産品のため納期長期</td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=OH-RSU46"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">リアサスペンション</span></div>
                                                    <div><span class="label">備考:</span><span class="value">プロ仕様</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">スポーツバイク</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/08</td>
                                        <td>160608R01016</td>
                                        <td>GIVI</td>
                                        <td>トップケース</td>
                                        <td>GV-E55</td>
                                        <td>8020534876543</td>
                                        <td>¥42,000</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>在庫あり</td>
                                        <td>モノロックベース別売</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=GV-E55" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">55L</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">モノロック</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">汎用</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/09</td>
                                        <td>160609R01017</td>
                                        <td>SHOEI</td>
                                        <td>ヘルメット</td>
                                        <td>SH-X14</td>
                                        <td>4960687543210</td>
                                        <td>¥78,000</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td>SH-001</td>
                                        <td>3日</td>
                                        <td>Lサイズ</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=SH-X14" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">フルフェイス</span></div>
                                                    <div><span class="label">備考:</span><span class="value">最新モデル</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">-</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/09</td>
                                        <td>160609R01018</td>
                                        <td>ALPINESTARS</td>
                                        <td>グローブ</td>
                                        <td>AS-GP01</td>
                                        <td>8033637654321</td>
                                        <td>¥18,500</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>2日</td>
                                        <td>Mサイズ</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=AS-GP01" alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">レーシング</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">本革製</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">-</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/10</td>
                                        <td>160610R01019</td>
                                        <td>OXFORD</td>
                                        <td>バイクカバー</td>
                                        <td>OX-CV200</td>
                                        <td>5030009876543</td>
                                        <td>¥8,900</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>1か月</td>
                                        <td>Lサイズ</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=OX-CV200"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">防水カバー</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">UV対応</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">中型バイク</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/10</td>
                                        <td>160610R01020</td>
                                        <td>DAYTONA</td>
                                        <td>LEDウインカー</td>
                                        <td>DT-LED01</td>
                                        <td>4909449876543</td>
                                        <td>¥5,400</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td>2か月</td>
                                        <td>フロント・リアセット</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="15">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=DT-LED01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">LED</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">省電力</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">汎用</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <!-- 手配済・在庫あり・納期超過・BOタブ用のテーブル -->
                            <table class="data-table" id="order-arranged-table" style="display: none;">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" class="checkbox" id="order-arranged-main-checkbox">
                                        </th>
                                        <th>明細情報</th><!-- for toggle button -->
                                        <th>webike依頼日</th>
                                        <th>SCMコード</th>
                                        <th>商品メーカー</th>
                                        <th>商品名</th>
                                        <th>商品番号</th>
                                        <th>JAN</th>
                                        <th>定価(税込)</th>
                                        <th>仕切価格(税抜)</th>
                                        <th>注文数</th>
                                        <th>自社管理番号</th>
                                        <th>入荷予定</th>
                                        <th>遅延回数</th>
                                        <th>担当者備考</th>
                                        <th>RC担当備考</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- 手配済・在庫あり・納期超過・BO用のサンプルデータ -->
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/05/25</td>
                                        <td>160525R00101</td>
                                        <td>デイトナ</td>
                                        <td>ブレーキパッド</td>
                                        <td>DT-BP001</td>
                                        <td>4909449112233</td>
                                        <td>¥6,800</td>
                                        <td>¥0</td>
                                        <td>2</td>
                                        <td>DT-001</td>
                                        <td>2016/08/30</td>
                                        <td>0</td>
                                        <td>フロント用</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="16">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=DT-BP001"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">フロント用</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">高性能パッド</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">汎用</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/05/28</td>
                                        <td>160528R00102</td>
                                        <td>キタコ</td>
                                        <td>エアフィルター</td>
                                        <td>KT-AF002</td>
                                        <td>4901234445566</td>
                                        <td>¥4,200</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td>KT-002</td>
                                        <td>2016/09/05</td>
                                        <td>1</td>
                                        <td>高性能フィルター</td>
                                        <td class="rc-memo-important">【遅延中】メーカー在庫切れのため入荷遅延</td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="16">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=KT-AF002"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">高流量</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">洗浄可能</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">多車種対応</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/01</td>
                                        <td>160601R00103</td>
                                        <td>SP武川</td>
                                        <td>チェーン</td>
                                        <td>SP-CH003</td>
                                        <td>4904123778899</td>
                                        <td>¥8,500</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td>SP-003</td>
                                        <td>2016/08/15</td>
                                        <td>0</td>
                                        <td>520-120L</td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="16">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=SP-CH003"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">ドライブチェーン</span></div>
                                                    <div><span class="label">備考:</span><span class="value">高強度</span>
                                                    </div>
                                                    <div><span class="label">対応車種メーカー:</span><span
                                                            class="value">スポーツバイク</span></div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="order-pagination"></div>
                    </div>
                </div>

                <!-- Delivery Processing View (Hidden by default) -->
                <div id="delivery-view" style="display: none;">
                    <div class="tabs" id="delivery-tabs">
                        <div class="tab active" data-tab="wait">出荷待</div>
                        <div class="tab" data-tab="done">出荷済</div>
                    </div>

                    <!-- 出荷待: アクション付き -->
                    <div class="data-table-container" id="delivery-wait-container">
                        <div class="table-tools">
                            <!-- Search Fields -->
                            <div class="search-fields">
                                <div class="search-field">
                                    <label for="delivery-maker-search">商品メーカー</label>
                                    <div class="tag-input-container compact" id="delivery-maker-tag-container">
                                        <input type="text" class="tag-input" id="delivery-maker-search"
                                            placeholder="商品メーカーを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="delivery-part-number-search">品番</label>
                                    <div class="tag-input-container compact" id="delivery-part-number-tag-container">
                                        <input type="text" class="tag-input" id="delivery-part-number-search"
                                            placeholder="品番を入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="delivery-jan-search">JAN</label>
                                    <div class="tag-input-container compact" id="delivery-jan-tag-container">
                                        <input type="text" class="tag-input" id="delivery-jan-search"
                                            placeholder="JANを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field-with-filter">
                                    <div class="search-field">
                                        <label for="delivery-scm-code-search">SCMコード</label>
                                        <div class="tag-input-container compact" id="delivery-scm-code-tag-container">
                                            <input type="text" class="tag-input" id="delivery-scm-code-search"
                                                placeholder="SCMコードを入力 (Enter/カンマで追加)">
                                        </div>
                                    </div>
                                    <button type="button" class="search-btn" id="delivery-search-btn" title="検索">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </button>
                                    <button type="button" class="search-filter-btn" title="フィルター">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Panel Toggle Button -->
                            <div class="dynamic-actions" id="delivery-actions" style="margin-top: 22px;">
                                <button class="icon-btn-csv" id="delivery-export-csv-btn" title="CSV出力">
                                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <!-- Additional Filters -->
                        <div class="additional-filters" id="delivery-additional-filters">
                            <div class="additional-filters-grid">
                                <div class="filter-field">
                                    <label for="delivery-product-name-filter">商品名</label>
                                    <input type="text" id="delivery-product-name-filter" placeholder="商品名を入力">
                                </div>
                                <div class="date-range-field">
                                    <label>受注日</label>
                                    <div class="date-range-inputs">
                                        <input type="date" id="delivery-order-date-from" placeholder="開始日">
                                        <span class="date-range-separator">〜</span>
                                        <input type="date" id="delivery-order-date-to" placeholder="終了日">
                                    </div>
                                </div>
                                <div class="date-range-field ship-date-field">
                                    <label>出荷日</label>
                                    <div class="date-range-inputs">
                                        <input type="date" id="delivery-ship-date-from" placeholder="開始日">
                                        <span class="date-range-separator">〜</span>
                                        <input type="date" id="delivery-ship-date-to" placeholder="終了日">
                                    </div>
                                </div>
                            </div>

                            <!-- 自社管理番号と担当備考フィールド -->
                            <div class="management-fields">
                                <div class="management-field">
                                    <label for="delivery-management-number">自社管理番号</label>
                                    <input type="text" id="delivery-management-number" placeholder="自社管理番号を入力">
                                </div>
                                <div class="management-field">
                                    <label for="delivery-staff-memo">担当備考</label>
                                    <input type="text" id="delivery-staff-memo" placeholder="担当備考を入力">
                                </div>
                            </div>
                        </div>

                        <div class="table-scroll">
                            <table class="data-table" id="delivery-wait-table">
                                <thead>
                                    <tr>
                                        <th width="45px"><input type="checkbox" class="checkbox"
                                                id="order-main-checkbox"></th>
                                        <th width="80px">明細情報</th><!-- for toggle button -->
                                        <th class="sortable" data-column="order-date">webike依頼日<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="scm-code">SCMコード<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="maker">商品メーカー<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-name">商品名<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-number">商品番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="jan">JAN<span class="sort-indicator"></span>
                                        </th>
                                        <th class="sortable" data-column="price">定価(税込)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="cost-price">仕切価格(税抜)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="quantity">注文数<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="arrival-quantity">入荷数<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="management-number">自社管理番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="arrival-scheduled">入荷予定<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="delay-count">遅延回数<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="staff-memo">担当者備考<span
                                                class="sort-indicator"></span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/05</td>
                                        <td>160605R02001</td>
                                        <td>デイトナ</td>
                                        <td>オイルフィルター</td>
                                        <td>DT-OF-01</td>
                                        <td>4900000000001</td>
                                        <td>¥1,450</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="16">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=DT-OF-01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">フィルター類</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">定期交換部品</span>
                                                    </div>
                                                    <div><span class="label">メーカー対応車種:</span><span
                                                            class="value">汎用</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/06</td>
                                        <td>160606R02002</td>
                                        <td>キタコ</td>
                                        <td>レバーセット</td>
                                        <td>KT-LVR-01</td>
                                        <td></td>
                                        <td>¥3,980</td>
                                        <td>¥0</td>
                                        <td>2</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="13">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=KT-LVR-01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span
                                                            class="value">操作系パーツ</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span
                                                            class="value">レバー調整可能</span></div>
                                                    <div><span class="label">メーカー対応車種:</span><span
                                                            class="value">ホンダ/ヤマハ</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="delivery-pagination"></div>
                    </div>

                    <!-- 出荷済: テーブルのみ（ボタンなし） -->
                    <div class="data-table-container" id="delivery-done-container" style="display:none;">
                        <div class="table-tools">
                            <!-- Search Fields -->
                            <div class="search-fields">
                                <div class="search-field">
                                    <label for="delivery-done-maker-search">商品メーカー</label>
                                    <div class="tag-input-container compact" id="delivery-done-maker-tag-container">
                                        <input type="text" class="tag-input" id="delivery-done-maker-search"
                                            placeholder="商品メーカーを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="delivery-done-part-number-search">品番</label>
                                    <div class="tag-input-container compact"
                                        id="delivery-done-part-number-tag-container">
                                        <input type="text" class="tag-input" id="delivery-done-part-number-search"
                                            placeholder="品番を入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field">
                                    <label for="delivery-done-jan-search">JAN</label>
                                    <div class="tag-input-container compact" id="delivery-done-jan-tag-container">
                                        <input type="text" class="tag-input" id="delivery-done-jan-search"
                                            placeholder="JANを入力 (Enter/カンマで追加)">
                                    </div>
                                </div>
                                <div class="search-field-with-filter">
                                    <div class="search-field">
                                        <label for="delivery-done-scm-code-search">SCMコード</label>
                                        <div class="tag-input-container compact"
                                            id="delivery-done-scm-code-tag-container">
                                            <input type="text" class="tag-input" id="delivery-done-scm-code-search"
                                                placeholder="SCMコードを入力 (Enter/カンマで追加)">
                                        </div>
                                    </div>
                                    <button type="button" class="search-btn" id="delivery-done-search-btn" title="検索">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                        </svg>
                                    </button>
                                    <button type="button" class="search-filter-btn" title="フィルター">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="table-scroll">
                            <table class="data-table" id="delivery-done-table">
                                <thead>
                                    <tr>
                                        <th width="45px"><input type="checkbox" class="checkbox"
                                                id="delivery-done-main-checkbox">
                                        </th>
                                        <th width="80px">明細情報</th><!-- for toggle button -->
                                        <th class="sortable" data-column="ship-date">webike依頼日<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="scm-code">SCMコード<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="maker">商品メーカー<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-name">商品名<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="product-number">商品番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="jan">JAN<span class="sort-indicator"></span>
                                        </th>
                                        <th class="sortable" data-column="price">定価(税込)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="cost-price">仕切価格(税抜)<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="quantity">注文数<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="arrival-quantity">入荷数<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="own-management-number">自社管理番号<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="shipping-date">出荷日<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="staff-note">担当備考<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="rc-staff-note">RC担当備考<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="carrier">運送会社<span
                                                class="sort-indicator"></span></th>
                                        <th class="sortable" data-column="tracking">追跡番号<span
                                                class="sort-indicator"></span></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="data-row">
                                        <td><input type="checkbox" class="checkbox"></td>
                                        <td>
                                            <button class="toggle-details-btn" aria-expanded="false">
                                                <svg fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd"
                                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                                        clip-rule="evenodd"></path>
                                                </svg>
                                            </button>
                                        </td>
                                        <td>2016/06/07</td>
                                        <td>160607R03001</td>
                                        <td>SP武川</td>
                                        <td>ヘッドライト</td>
                                        <td>SP-HL-01</td>
                                        <td>4988888888888</td>
                                        <td>¥15,800</td>
                                        <td>¥0</td>
                                        <td>1</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td>ヤマト運輸</td>
                                        <td>ABC123456789</td>
                                    </tr>
                                    <tr class="details-row">
                                        <td colspan="18">
                                            <div class="details-card">
                                                <img src="https://via.placeholder.com/100x100?text=SP-HL-01"
                                                    alt="image">
                                                <div class="details-card-info">
                                                    <div><span class="label">タイプ:</span><span class="value">照明パーツ</span>
                                                    </div>
                                                    <div><span class="label">備考:</span><span class="value">LED仕様</span>
                                                    </div>
                                                    <div><span class="label">メーカー対応車種:</span><span
                                                            class="value">モンキー125</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="pagination" id="delivered-pagination"></div>
                    </div>
                </div>

                <!-- Filter Panel -->
                <div class="modal-backdrop" id="delay-modal">
                    <div class="modal">
                        <div class="modal-header">遅延処理</div>
                        <div class="modal-subinfo">選択した受注に対して遅延理由と予定を登録します。</div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="form-label">発送予定</label>
                                <div style="display:flex; align-items:center; gap:12px;">
                                    <label style="display:flex; align-items:center; gap:6px;">
                                        <input type="radio" name="delay-status" id="delay-undecided" value="undecided"
                                            checked>
                                        未定
                                    </label>
                                    <label style="display:flex; align-items:center; gap:6px;">
                                        <input type="radio" name="delay-status" id="delay-scheduled" value="scheduled">
                                        発送予定
                                    </label>
                                    <input type="date" id="delay-date" class="form-input"
                                        style="width:auto; padding:6px 10px;" disabled>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">遅延理由</label>
                                <select class="form-select" id="delay-reason">
                                    <option value="">選択してください</option>
                                    <option value="low-stock">メーカー在庫が残りわずかだったため</option>
                                    <option value="production">生産遅延のため</option>
                                    <option value="logistics">物流遅延のため</option>
                                    <option value="other">その他</option>
                                </select>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-danger" id="delay-apply-btn">遅延処理</button>
                            <button class="btn btn-muted" id="delay-close-btn">閉じる</button>
                        </div>
                    </div>
                </div>
                <!-- Order Edit Modal -->
                <div class="modal-backdrop" id="order-edit-modal">
                    <div class="modal">
                        <div class="modal-header">受注処理操作</div>
                        <div class="modal-subinfo" id="order-edit-selected-count">選択された商品 0件</div>
                        <div class="modal-body">
                            <div class="form-section">
                                <div class="form-group">
                                    <label class="form-label">入力支援</label>
                                    <select class="form-select" id="order-assist-select">
                                        <option value="">選択してください</option>
                                        <option value="至急対応お願いします">至急対応お願いします</option>
                                        <option value="メーカー確認中">メーカー確認中</option>
                                        <option value="入荷予定日未定">入荷予定日未定</option>
                                        <option value="出荷準備中">出荷準備中</option>
                                        <option value="在庫確認中">在庫確認中</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">担当備考</label>
                                    <input type="text" class="form-input" id="order-memo-input" placeholder="担当備考を入力" />
                                </div>
                                <div class="form-group">
                                    <label class="form-label">自社管理番号</label>
                                    <input type="text" class="form-input" id="order-own-input"
                                        placeholder="自社管理番号を入力" />
                                </div>
                                <div class="form-group">
                                    <button class="btn btn-primary" id="order-edit-apply-btn">更新</button>
                                </div>
                            </div>
                            <hr class="section-divider">
                            <div class="form-group">
                                <label class="form-label">出荷予定日選択</label>
                                <input type="date" class="form-input" id="modal-order-date" />
                            </div>
                            <div class="form-group">
                                <label class="form-label">受注処理操作</label>
                                <div style="display: flex; gap: 8px; margin-top: 8px;">
                                    <button class="btn btn-primary" id="modal-btn-to-shipment-wait">出荷待ちにする</button>
                                    <button class="btn btn-primary" id="modal-btn-to-in-progress">手配中にする</button>
                                    <button class="btn btn-success" id="modal-btn-to-done">手配済にする</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-muted" id="order-edit-close-btn">閉じる</button>
                    </div>
                </div>
            </div>
            <div class="modal-backdrop" id="tracking-modal">
                <div class="modal">
                    <div class="modal-header">追跡番号設定</div>
                    <div class="modal-subinfo" id="tracking-selected-count">選択された明細 0件</div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label" for="modal-carrier-select">運送会社</label>
                            <select class="form-select" id="modal-carrier-select">
                                <option value="yamato">ヤマト運輸</option>
                                <option value="sagawa">佐川急便</option>
                                <option value="jppost">日本郵便</option>
                                <option value="seino">西濃運輸</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="modal-tracking-input">追跡番号</label>
                            <input type="text" class="form-input" id="modal-tracking-input" placeholder="追跡番号を入力">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" id="tracking-apply-btn">保存</button>
                        <button class="btn btn-muted" id="tracking-close-btn">閉じる</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Panel for Quotation -->
    <div class="right-panel" id="quotation-right-panel">
        <div class="right-panel-header">
            <button class="icon-btn" id="quotation-panel-toggle" title="パネルを切り替え">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="m18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>
            <h3 class="right-panel-title">見積処理パネル</h3>
        </div>
        <div class="right-panel-body">
            <div class="form-group">
                <label class="form-label">選択件数</label>
                <div class="selection-count" id="quotation-panel-selection-count">0件選択中</div>
            </div>
            <div class="form-group">
                <label class="form-label">入力支援</label>
                <select class="form-select" id="quotation-assist-select">
                    <option value="">選択してください</option>
                    <!-- options -->
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">担当備考</label>
                <textarea class="form-input" id="quotation-memo-input" rows="4" placeholder="担当備考を入力"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">自社管理番号</label>
                <input type="text" class="form-input" id="quotation-own-input" placeholder="自社管理番号を入力">
            </div>
            <button class="btn btn-primary" id="quotation-update-btn">更新</button>
            <hr class="section-divider">
            <h4>見積処理操作</h4>
            <div class="form-group">
                <label class="form-label">納期選択</label>
                <select class="form-select" id="quotation-delivery-select">
                    <option value="">選択してください</option>
                    <!-- options -->
                </select>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" id="quotation-send-btn">見積送信</button>
                <button class="btn btn-secondary" id="quotation-processing-btn">見積中にする</button>
            </div>
        </div>
    </div>

    <!-- Order Right Panel -->
    <div class="right-panel" id="order-right-panel">
        <div class="right-panel-header">
            <button class="icon-btn" id="order-panel-toggle" title="パネルを切り替え">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="m18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>
            <h3 class="right-panel-title">受注処理パネル</h3>
        </div>
        <div class="right-panel-body">
            <div class="form-group">
                <label class="form-label">選択件数</label>
                <div class="selection-count" id="order-panel-selection-count">0件選択中</div>
            </div>
            <div class="form-group">
                <label class="form-label">入力支援</label>
                <select class="form-select" id="order-panel-assist-select">
                    <option value="">選択してください</option>
                    <option value="発注確認中です">発注確認中です</option>
                    <option value="在庫確認中です">在庫確認中です</option>
                    <option value="メーカー確認中です">メーカー確認中です</option>
                    <option value="納期調整中です">納期調整中です</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">担当備考</label>
                <textarea class="form-input" id="order-panel-memo-input" rows="4" placeholder="担当備考を入力"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">自社管理番号</label>
                <input type="text" class="form-input" id="order-panel-own-input" placeholder="自社管理番号を入力">
            </div>
            <button class="btn btn-primary" id="order-panel-update-btn">更新</button>
            <hr class="section-divider">
            <h4>受注処理操作</h4>
            <div class="form-group">
                <label class="form-label">webike依頼日</label>
                <input type="date" class="form-input" id="order-panel-date">
            </div>
            <div class="button-group vertical">
                <button class="btn btn-success" id="order-panel-shipment-wait-btn">出荷待にする</button>
                <button class="btn btn-warning" id="order-panel-in-progress-btn">手配中にする</button>
                <button class="btn btn-primary" id="order-panel-done-btn">手配済にする</button>
            </div>

            <!-- 遅延処理セクション（手配済、在庫あり、納期超過、BOタブでのみ表示） -->
            <div class="delay-processing-section" id="order-panel-delay-section">
                <h4>遅延処理</h4>
                <div class="form-group">
                    <label class="form-label">発送状況</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="delay-status-undecided" name="delay-status" value="undecided"
                                checked>
                            <label for="delay-status-undecided">未定</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="delay-status-scheduled" name="delay-status" value="scheduled">
                            <label for="delay-status-scheduled">発送予定</label>
                        </div>
                    </div>
                    <div class="delay-date-input" id="delay-date-input">
                        <input type="date" class="form-input" id="order-panel-delay-date" placeholder="発送予定日を選択">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">遅延理由</label>
                    <select class="form-select" id="order-panel-delay-reason">
                        <option value="">選択してください</option>
                        <option value="supplier-delay">仕入先の遅延</option>
                        <option value="production-delay">生産遅延</option>
                        <option value="shipping-delay">配送遅延</option>
                        <option value="inventory-shortage">在庫不足</option>
                        <option value="quality-issue">品質問題</option>
                        <option value="other">その他</option>
                    </select>
                </div>
                <button class="btn" id="order-panel-delay-btn" disabled>遅延処理実行</button>
            </div>
        </div>
    </div>

    <!-- Delivery Right Panel -->
    <div class="right-panel" id="delivery-right-panel">
        <div class="right-panel-header">
            <button class="icon-btn" id="delivery-panel-toggle" title="パネルを切り替え">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="m18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            </button>
            <h3 class="right-panel-title">納品処理パネル</h3>
        </div>
        <div class="right-panel-body">
            <div class="form-group">
                <label class="form-label">選択件数</label>
                <div class="selection-count" id="delivery-panel-selection-count">0件選択中</div>
            </div>
            <div class="form-group">
                <label class="form-label">運送会社</label>
                <select class="form-select" id="delivery-panel-carrier-select">
                    <option value="">選択してください</option>
                    <option value="yamato">ヤマト運輸</option>
                    <option value="sagawa">佐川急便</option>
                    <option value="jp-post">日本郵便</option>
                    <option value="fedex">FedEx</option>
                    <option value="dhl">DHL</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">追跡番号</label>
                <input type="text" class="form-input" id="delivery-panel-tracking-input" placeholder="追跡番号を入力">
            </div>
            <button class="btn btn-primary" id="delivery-panel-update-btn">更新</button>
            <hr class="section-divider">
            <h4>納品処理操作</h4>
            <div class="form-group">
                <label class="form-label">出荷日</label>
                <input type="date" class="form-input" id="delivery-panel-shipping-date">
            </div>
            <div class="button-group">
                <button class="btn btn-success" id="delivery-panel-ship-btn">出荷する</button>
            </div>
        </div>
    </div>

    <!-- Mobile overlay -->
    <div class="mobile-overlay" id="mobile-overlay"></div>
    </div>

    <script>
        // Login check - redirect to login page if not authenticated
        (function() {
            // デバッグ用: ローカルストレージの状態をコンソールに出力
            console.log('Login check - isLoggedIn:', localStorage.getItem('isLoggedIn'));
            
            if (localStorage.getItem('isLoggedIn') !== 'true') {
                console.log('Not logged in, redirecting to login page...');
                window.location.href = 'index.html';
                return;
            }
            
            console.log('User is logged in, continuing to main page...');
        })();

        // デバッグ用グローバル関数
        window.debugLogin = {
            // ログイン状態をリセット
            logout: function() {
                localStorage.removeItem('isLoggedIn');
                localStorage.removeItem('username');
                console.log('Logged out, reloading page...');
                window.location.reload();
            },
            // ログイン状態を設定
            login: function(username = 'testuser') {
                localStorage.setItem('isLoggedIn', 'true');
                localStorage.setItem('username', username);
                console.log('Logged in as:', username);
            },
            // 現在の状態を確認
            status: function() {
                console.log('Login status:', {
                    isLoggedIn: localStorage.getItem('isLoggedIn'),
                    username: localStorage.getItem('username')
                });
            }
        };

        // Sidebar show/hide toggle
        (function () {
            const sidebar = document.querySelector('.sidebar');
            const toggleBtn = document.getElementById('sidebar-toggle');
            if (!sidebar || !toggleBtn) return;

            // Restore state from localStorage
            const saved = localStorage.getItem('scm.sidebar.collapsed');
            if (saved === '1') sidebar.classList.add('collapsed');

            toggleBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                sidebar.classList.toggle('collapsed');
                localStorage.setItem('scm.sidebar.collapsed', sidebar.classList.contains('collapsed') ? '1' : '0');
            });
        })();

        // 納期超過明細詳細表示機能（倉庫別）
        function showWarehouseDetail(warehouseCode) {
            // 納期超過アラートを閉じる
            const alertBackdrop = document.querySelector('.delivery-alert-backdrop');
            if (alertBackdrop) {
                alertBackdrop.remove();
            }

            // 受注処理タブに切り替え
            const orderView = document.getElementById('order-view');
            const dashboardView = document.getElementById('dashboard-view');
            const quotationView = document.getElementById('quotation-view');
            const deliveryView = document.getElementById('delivery-view');

            // 全てのビューを非表示
            if (dashboardView) dashboardView.style.display = 'none';
            if (quotationView) quotationView.style.display = 'none';
            if (deliveryView) deliveryView.style.display = 'none';
            if (orderView) orderView.style.display = 'block';

            // ナビゲーションの状態を更新
            document.querySelectorAll('.nav-item').forEach(navItem => {
                navItem.classList.remove('active');
            });
            const orderNavItem = document.querySelector('.nav-item[href="#order"]');
            if (orderNavItem) {
                orderNavItem.classList.add('active');
            }

            // ページタイトルを更新
            const pageTitle = document.querySelector('.page-title');
            if (pageTitle) {
                pageTitle.textContent = '受注処理';
            }

            // 倉庫ドロップダウンを該当倉庫に設定
            const warehouseDropdownBtn = document.getElementById('warehouse-dropdown-btn');
            const warehouseBtnText = document.getElementById('warehouse-btn-text');

            const warehouseNames = {
                'zama': '座間倉庫',
                'yokohama': '横浜倉庫',
                'koshien': '甲子園倉庫'
            };

            if (warehouseBtnText && warehouseNames[warehouseCode]) {
                warehouseBtnText.textContent = warehouseNames[warehouseCode];
            }

            // ヘッダー背景色を更新
            if (typeof updateHeaderBackground === 'function') {
                updateHeaderBackground(warehouseCode);
            }

            // 受注処理の納期超過タブに切り替え（納期超過データのフィルタリング）
            // 実際の実装では、ここで該当倉庫の納期超過データをフィルタリング・表示
            console.log(`${warehouseNames[warehouseCode] || warehouseCode}の納期超過データを表示中...`);
        }

        // 納期超過明細詳細表示機能（個別SCMコード用・下位互換性のため残す）
        function showDeliveryDetail(scmCode) {
            // ここで納期超過詳細画面に遷移
            // 実際の実装では、詳細画面のURLにSCMコードをパラメータとして渡す
            alert(`SCMコード ${scmCode} の納期超過詳細画面に遷移します。\n\n実際の実装では、詳細画面に遷移します。`);

            // 例: 実際の遷移処理（コメントアウト）
            // window.location.href = `/delivery-detail?scm_code=${scmCode}`;
            // または
            // window.open(`/delivery-detail?scm_code=${scmCode}`, '_blank');
        }

        // Simple navigation functionality
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function (e) {
                e.preventDefault();

                // Update active state
                document.querySelectorAll('.nav-item').forEach(navItem => {
                    navItem.classList.remove('active');
                });
                this.classList.add('active');

                // Update page title
                const pageTitle = document.querySelector('.page-title');
                const pageTitles = {
                    '#dashboard': 'ダッシュボード',
                    '#quotation': '見積処理',
                    '#order': '受注処理',
                    '#delivery': '納品処理'
                };
                pageTitle.textContent = pageTitles[this.getAttribute('href')] || 'ダッシュボード';

                // Show/hide views
                document.getElementById('dashboard-view').style.display =
                    this.getAttribute('href') === '#dashboard' ? 'block' : 'none';
                document.getElementById('quotation-view').style.display =
                    this.getAttribute('href') === '#quotation' ? 'block' : 'none';
                document.getElementById('order-view').style.display =
                    this.getAttribute('href') === '#order' ? 'block' : 'none';
                document.getElementById('delivery-view').style.display =
                    this.getAttribute('href') === '#delivery' ? 'block' : 'none';

                // 見積処理ページが表示されたときにボタンの状態を初期化
                if (this.getAttribute('href') === '#quotation') {
                    const csvExportBtn = document.getElementById('export-dropdown-btn');
                    const faxModalBtn = document.getElementById('fax-modal-btn');
                    if (csvExportBtn) csvExportBtn.disabled = true;
                    if (faxModalBtn) faxModalBtn.disabled = true;
                }

                // Show/hide header warehouse dropdown (for quotation, order, and delivery views)
                const headerWarehouseDropdown = document.getElementById('header-warehouse-dropdown');
                if (headerWarehouseDropdown) {
                    const showDropdown = ['#quotation', '#order', '#delivery'].includes(this.getAttribute('href'));
                    headerWarehouseDropdown.style.display = showDropdown ? 'block' : 'none';

                    // Apply warehouse background color when switching to warehouse views
                    if (showDropdown && typeof updateHeaderBackground === 'function') {
                        updateHeaderBackground(selectedWarehouse);
                    }
                }

                // Reset header background color when switching to dashboard
                const topBar = document.querySelector('.top-bar');
                if (topBar && this.getAttribute('href') === '#dashboard') {
                    topBar.style.background = '#fff'; // Reset to default when switching to dashboard
                }

                // Re-bind toggle buttons after view switch
                bindToggleButtons();

                // Toggle quotation panel
                if (this.getAttribute('href') === '#quotation') {
                    toggleQuotationPanel(true);
                } else {
                    toggleQuotationPanel(false);
                }

                // Toggle order panel
                if (this.getAttribute('href') === '#order') {
                    toggleOrderPanel(true);
                    // Update selection count when switching to order view
                    updateOrderPanelSelectionCount();
                } else {
                    toggleOrderPanel(false);
                }

                // Toggle delivery panel - only show in delivery view
                if (this.getAttribute('href') === '#delivery') {
                    toggleDeliveryPanel(true);
                    // Update selection count when switching to delivery view
                    updateDeliveryPanelSelectionCount();
                } else {
                    toggleDeliveryPanel(false);
                }
            });
        });

        // Dashboard status link functionality
        document.querySelectorAll('.status-link').forEach(link => {
            link.addEventListener('click', function (e) {
                e.preventDefault();

                const warehouse = this.getAttribute('data-warehouse');
                const action = this.getAttribute('data-action');

                if (action === 'quotation-unprocessed') {
                    // Set selected warehouse
                    selectedWarehouse = warehouse;

                    // Switch to quotation view
                    document.querySelectorAll('.nav-item').forEach(navItem => {
                        navItem.classList.remove('active');
                    });
                    document.querySelector('.nav-item[href="#quotation"]').classList.add('active');

                    // Update page title
                    const pageTitle = document.querySelector('.page-title');
                    pageTitle.textContent = '見積処理';

                    // Show quotation view
                    document.getElementById('dashboard-view').style.display = 'none';
                    document.getElementById('quotation-view').style.display = 'block';
                    document.getElementById('order-view').style.display = 'none';
                    document.getElementById('delivery-view').style.display = 'none';

                    // Show edit panel for quotation view
                    const editPanel = document.getElementById('edit-panel');
                    if (editPanel) {
                        editPanel.classList.add('show');
                    }

                    // Hide order edit panel
                    const orderEditPanel = document.getElementById('order-edit-panel');
                    if (orderEditPanel) {
                        orderEditPanel.classList.remove('show');
                    }

                    // Initialize quotation pagination
                    if (quotationTbody && quotationAllRows.length > 0) {
                        const quotationTotalPages = Math.ceil(quotationAllRows.length / perPage) || 1;
                        if (quotationTotalPages > 1) {
                            renderQuotationPage(1);
                        } else {
                            buildQuotationPagination(quotationTotalPages);
                        }
                    }

                    // Show warehouse dropdown
                    const headerWarehouseDropdown = document.getElementById('header-warehouse-dropdown');
                    if (headerWarehouseDropdown) {
                        headerWarehouseDropdown.style.display = 'block';
                    }

                    // Update warehouse dropdown button text and background
                    const warehouseDropdownBtn = document.getElementById('warehouse-dropdown-btn');
                    const warehouseBtnText = document.getElementById('warehouse-btn-text');
                    const warehouseName = warehouse === 'zama' ? '座間フルフィルメントセンター' :
                        warehouse === 'yokohama' ? '横浜フルフィルメントセンター' :
                            warehouse === 'koshien' ? '甲子園フルフィルメントセンター' : '全倉庫';
                    if (warehouseBtnText) {
                        warehouseBtnText.textContent = warehouseName;
                    }

                    // Update header background color
                    if (typeof updateHeaderBackground === 'function') {
                        updateHeaderBackground(warehouse);
                    }

                    // Set active tab to 未処理
                    const quotationTabs = document.querySelectorAll('#quotation-view .tab');
                    quotationTabs.forEach(tab => tab.classList.remove('active'));
                    const unprocessedTab = document.querySelector('#quotation-view .tab[data-status="unprocessed"]');
                    if (unprocessedTab) {
                        unprocessedTab.classList.add('active');
                    }

                    // Re-bind toggle buttons after view switch
                    bindToggleButtons();
                } else if (action === 'order-unprocessed') {
                    // Set selected warehouse
                    selectedWarehouse = warehouse;

                    // Switch to order view
                    document.querySelectorAll('.nav-item').forEach(navItem => {
                        navItem.classList.remove('active');
                    });
                    document.querySelector('.nav-item[href="#order"]').classList.add('active');

                    // Update page title
                    const pageTitle = document.querySelector('.page-title');
                    pageTitle.textContent = '受注処理';

                    // Show order view
                    document.getElementById('dashboard-view').style.display = 'none';
                    document.getElementById('quotation-view').style.display = 'none';
                    document.getElementById('order-view').style.display = 'block';
                    document.getElementById('delivery-view').style.display = 'none';

                    // Hide edit panel for quotation view
                    const editPanel = document.getElementById('edit-panel');
                    if (editPanel) {
                        editPanel.classList.remove('show');
                    }

                    // Hide order edit panel
                    const orderEditPanel = document.getElementById('order-edit-panel');
                    if (orderEditPanel) {
                        orderEditPanel.classList.remove('show');
                    }

                    // Show warehouse dropdown
                    const headerWarehouseDropdown = document.getElementById('header-warehouse-dropdown');
                    if (headerWarehouseDropdown) {
                        headerWarehouseDropdown.style.display = 'block';
                    }

                    // Update warehouse dropdown button text and background
                    const warehouseDropdownBtn = document.getElementById('warehouse-dropdown-btn');
                    const warehouseBtnText = document.getElementById('warehouse-btn-text');
                    const warehouseName = warehouse === 'zama' ? '座間フルフィルメントセンター' :
                        warehouse === 'yokohama' ? '横浜フルフィルメントセンター' :
                            warehouse === 'koshien' ? '甲子園フルフィルメントセンター' : '全倉庫';
                    if (warehouseBtnText) {
                        warehouseBtnText.textContent = warehouseName;
                    }

                    // Update header background color
                    if (typeof updateHeaderBackground === 'function') {
                        updateHeaderBackground(warehouse);
                    }

                    // Set active tab to 未処理
                    const orderTabs = document.querySelectorAll('#order-view .tab');
                    orderTabs.forEach(tab => tab.classList.remove('active'));
                    const unprocessedOrderTab = document.querySelector('#order-view .tab:first-child'); // 最初のタブが未処理
                    if (unprocessedOrderTab) {
                        unprocessedOrderTab.classList.add('active');
                    }
                } else if (action === 'delivery-wait') {
                    // Set selected warehouse
                    selectedWarehouse = warehouse;

                    // Switch to delivery view
                    document.querySelectorAll('.nav-item').forEach(navItem => {
                        navItem.classList.remove('active');
                    });
                    document.querySelector('.nav-item[href="#delivery"]').classList.add('active');

                    // Update page title
                    const pageTitle = document.querySelector('.page-title');
                    pageTitle.textContent = '納品処理';

                    // Show delivery view
                    document.getElementById('dashboard-view').style.display = 'none';
                    document.getElementById('quotation-view').style.display = 'none';
                    document.getElementById('order-view').style.display = 'none';
                    document.getElementById('delivery-view').style.display = 'block';

                    // Show warehouse dropdown
                    const headerWarehouseDropdown = document.getElementById('header-warehouse-dropdown');
                    if (headerWarehouseDropdown) {
                        headerWarehouseDropdown.style.display = 'block';
                    }

                    // Update warehouse dropdown button text and background
                    const warehouseDropdownBtn = document.getElementById('warehouse-dropdown-btn');
                    const warehouseBtnText = document.getElementById('warehouse-btn-text');
                    const warehouseName = warehouse === 'zama' ? '座間フルフィルメントセンター' :
                        warehouse === 'yokohama' ? '横浜フルフィルメントセンター' :
                            warehouse === 'koshien' ? '甲子園フルフィルメントセンター' : '全倉庫';
                    if (warehouseBtnText) {
                        warehouseBtnText.textContent = warehouseName;
                    }

                    // Update header background color
                    if (typeof updateHeaderBackground === 'function') {
                        updateHeaderBackground(warehouse);
                    }

                    // Set active tab to 出荷待
                    const deliveryTabs = document.querySelectorAll('#delivery-view .tab');
                    deliveryTabs.forEach(tab => tab.classList.remove('active'));
                    const waitTab = document.querySelector('#delivery-view .tab[data-tab="wait"]');
                    if (waitTab) {
                        waitTab.classList.add('active');
                    }

                    // Show delivery wait container and hide delivered container
                    const deliveryWaitContainer = document.getElementById('delivery-wait-container');
                    const deliveredContainer = document.getElementById('delivered-container');
                    if (deliveryWaitContainer) deliveryWaitContainer.style.display = 'block';
                    if (deliveredContainer) deliveredContainer.style.display = 'none';
                }
            });
        });

        // (disabled) Filter panel toggle – kept for future use
        const filterOpenBtn = document.querySelector('.filter-btn.open-panel');
        if (filterOpenBtn) {
            filterOpenBtn.addEventListener('click', function () {
                document.querySelector('.filter-panel').classList.add('active');
            });
        }
        document.querySelector('.close-btn')?.addEventListener('click', function () {
            document.querySelector('.filter-panel').classList.remove('active');
        });

        // Sidebar user popup menu
        const userNameBtn = document.getElementById('user-name-btn');
        const userMenu = document.getElementById('user-menu');
        if (userNameBtn && userMenu) {
            userNameBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                userMenu.classList.toggle('show');
            });
            document.addEventListener('click', function () {
                userMenu.classList.remove('show');
            });
            userMenu.addEventListener('click', function (e) {
                if (!e.target.classList.contains('menu-item')) return;
                const action = e.target.getAttribute('data-action');
                if (action === 'settings') {
                    alert('設定を開きます。（ダミー）');
                } else if (action === 'help') {
                    alert('ヘルプを開きます。（ダミー）');
                } else if (action === 'logout') {
                }
                userMenu.classList.remove('show');
            });
        }

        // Tab switching (and show/hide "見積中にする" button for quotation-view, "手配中にする" for order-view)
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function () {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                // If in quotation-view, toggle "見積中にする" button
                const quotationView = document.getElementById('quotation-view');
                if (quotationView && quotationView.style.display !== 'none') {
                    const processingBtn = document.getElementById('quotation-processing-btn');
                    if (processingBtn) {
                        if (this.textContent.includes('未処理')) {
                            processingBtn.style.display = '';
                        } else if (this.textContent.includes('見積中')) {
                            processingBtn.style.display = 'none';
                        }
                    }

                    // タブ切り替え時にボタンの状態をリセット
                    const csvExportBtn = document.getElementById('export-dropdown-btn');
                    const faxModalBtn = document.getElementById('fax-modal-btn');
                    if (csvExportBtn) csvExportBtn.disabled = true;
                    if (faxModalBtn) faxModalBtn.disabled = true;
                }
                // If in order-view, toggle buttons based on active tab
                const orderView = document.getElementById('order-view');
                if (orderView && orderView.style.display !== 'none') {
                    const orderExportBtn = document.getElementById('order-export-csv-btn');
                    const orderFaxBtn = document.getElementById('order-fax-modal-btn');
                    const orderDelayExportBtn = document.getElementById('order-delay-export-csv-btn');
                    const orderDelayFaxBtn = document.getElementById('order-delay-fax-modal-btn');
                    const inProgressBtn = document.getElementById('order-panel-in-progress-btn');
                    const orderPanelDoneBtn = document.getElementById('order-panel-done-btn');

                    // テーブルの切り替え
                    const unprocessedTable = document.getElementById('order-unprocessed-table');
                    const arrangedTable = document.getElementById('order-arranged-table');

                    if (unprocessedTable && arrangedTable) {
                        const label = this.textContent;
                        const showDelayTabs = ['手配済', '在庫あり', '納期超過', 'BO'];
                        const delaySection = document.getElementById('order-panel-delay-section');

                        if (showDelayTabs.some(t => label.includes(t))) {
                            // 手配済／在庫あり／納期超過／BO では遅延用のテーブルとボタンを表示
                            // また、手配済用テーブルを表示
                            unprocessedTable.style.display = 'none';
                            arrangedTable.style.display = 'table';
                            if (orderExportBtn) orderExportBtn.style.display = 'none';
                            if (orderFaxBtn) orderFaxBtn.style.display = 'none';
                            if (orderDelayExportBtn) orderDelayExportBtn.style.display = '';
                            if (orderDelayFaxBtn) orderDelayFaxBtn.style.display = '';
                            // 遅延処理セクションを表示
                            if (delaySection) delaySection.classList.add('show');
                            // 手配済タブの場合、手配済にするボタンを非表示
                            if (label.includes('手配済')) {
                                if (orderPanelDoneBtn) orderPanelDoneBtn.style.display = 'none';
                            }
                        } else {
                            // 未処理・手配中などその他タブでは通常のボタンを表示
                            // また、未処理用テーブルを表示
                            unprocessedTable.style.display = 'table';
                            arrangedTable.style.display = 'none';
                            if (orderExportBtn) orderExportBtn.style.display = '';
                            if (orderFaxBtn) orderFaxBtn.style.display = '';
                            if (orderDelayExportBtn) orderDelayExportBtn.style.display = 'none';
                            if (orderDelayFaxBtn) orderDelayFaxBtn.style.display = 'none';
                            // 遅延処理セクションを非表示
                            if (delaySection) delaySection.classList.remove('show');

                            // 手配中タブの場合、手配中にするボタンを非表示
                            if (label.includes('手配中')) {
                                if (inProgressBtn) inProgressBtn.style.display = 'none';
                            } else {
                                if (inProgressBtn) inProgressBtn.style.display = '';
                            }
                            // 手配済にするボタンを表示（未処理・手配中タブ）
                            if (orderPanelDoneBtn) orderPanelDoneBtn.style.display = '';
                        }
                        // Reset pagination when switching tabs
                        // Update orderTbody based on active table
                        const activeTable = unprocessedTable.style.display !== 'none' ? unprocessedTable : arrangedTable;
                        if (activeTable) {
                            const newTbody = activeTable.querySelector('tbody');
                            if (newTbody) {
                                orderTbody = newTbody;
                                allRows = Array.from(orderTbody.querySelectorAll('tr'));
                                filteredRows = allRows.slice();
                                renderPage(1);
                            }
                        }
                        // Re-bind delay button event listener after tab switch
                        if (delayBtn && delayBtn.style.display !== 'none') {
                            delayBtn.addEventListener('click', function () {
                                const count = document.querySelectorAll('#order-view tbody td .checkbox:checked').length;
                                if (count === 0) { alert('対象の受注を選択してください。'); return; }
                                openDelayModal();
                            });
                        }
                    }
                }
                // Re-bind toggle buttons after tab switch to ensure they work for new content
                bindToggleButtons();
            });
        });

        // Checkbox functionality
        const mainCheckbox = document.querySelector('th .checkbox');
        const dynamicActions = document.getElementById('dynamic-actions');

        // --- Pagination setup ---
        const orderTbody = document.querySelector('.data-table tbody');
        const allRows = Array.from(orderTbody.querySelectorAll('tr'));
        let filteredRows = allRows.slice();
        const perPage = 100; // 1ページあたり表示件数
        let currentPage = 1;

        // Quotation view pagination setup
        const quotationTbody = document.querySelector('#quotation-view .data-table tbody');
        const quotationAllRows = quotationTbody ? Array.from(quotationTbody.querySelectorAll('tr')) : [];
        let quotationFilteredRows = quotationAllRows.slice();
        let quotationCurrentPage = 1;

        // Helper function to format currency
        function formatCurrency(amount) {
            return '¥' + amount.toLocaleString('ja-JP');
        }

        // Helper function to parse currency from text
        function parseCurrency(text) {
            if (!text) return 0;
            // Remove currency symbols, commas, and non-numeric characters except decimal point
            const numericText = text.replace(/[¥,円]/g, '').replace(/[^\d.]/g, '');
            const value = parseFloat(numericText) || 0;
            return value;
        }

        // Helper function to calculate summary data
        function calculateSummaryData(viewType) {
            let tbody, visibleRows, checkedRows;

            if (viewType === 'quotation') {
                tbody = quotationTbody;
                // Get currently visible rows in quotation view
                const start = (quotationCurrentPage - 1) * perPage;
                const end = start + perPage;
                visibleRows = quotationFilteredRows.slice(start, end);
                checkedRows = Array.from(tbody.querySelectorAll('tr .checkbox:checked')).map(cb => cb.closest('tr'));
            } else if (viewType === 'order') {
                tbody = orderTbody;
                // Get currently visible rows in order view
                const start = (currentPage - 1) * perPage;
                const end = start + perPage;
                visibleRows = filteredRows.slice(start, end);
                checkedRows = Array.from(tbody.querySelectorAll('tr .checkbox:checked')).map(cb => cb.closest('tr'));
            } else if (viewType === 'delivery') {
                // For delivery view, we need to check which tab is active
                const deliveryWaitContainer = document.getElementById('delivery-wait-container');
                const deliveryDoneContainer = document.getElementById('delivery-done-container');

                if (deliveryWaitContainer && deliveryWaitContainer.style.display !== 'none') {
                    tbody = document.querySelector('#delivery-wait-table tbody');
                    if (tbody && typeof waitCurrentPage !== 'undefined' && typeof waitFiltered !== 'undefined') {
                        const waitPerPage = 20;
                        const start = (waitCurrentPage - 1) * waitPerPage;
                        const end = start + waitPerPage;
                        visibleRows = waitFiltered.slice(start, end);
                    } else {
                        visibleRows = tbody ? Array.from(tbody.querySelectorAll('tr.data-row')) : [];
                    }
                } else if (deliveryDoneContainer && deliveryDoneContainer.style.display !== 'none') {
                    tbody = document.querySelector('#delivery-done-table tbody');
                    if (tbody && typeof doneCurrentPage !== 'undefined' && typeof doneFiltered !== 'undefined') {
                        const donePerPage = 20;
                        const start = (doneCurrentPage - 1) * donePerPage;
                        const end = start + donePerPage;
                        visibleRows = doneFiltered.slice(start, end);
                    } else {
                        visibleRows = tbody ? Array.from(tbody.querySelectorAll('tr.data-row')) : [];
                    }
                } else {
                    return { checkedCount: 0, visibleTotal: 0, checkedTotal: 0 };
                }

                checkedRows = tbody ? Array.from(tbody.querySelectorAll('tr .checkbox:checked')).map(cb => cb.closest('tr')) : [];
            } else {
                return { checkedCount: 0, visibleTotal: 0, checkedTotal: 0 };
            }

            const checkedCount = checkedRows.length;

            // Helper function to get price from a row
            function getPriceFromRow(row) {
                const cells = row.querySelectorAll('td');
                // Look for price column - typically contains ¥ symbol or large numbers
                for (let i = 0; i < cells.length; i++) {
                    const cellText = cells[i].textContent.trim();
                    // Check if this looks like a price (contains ¥ or is a large number with commas)
                    if (cellText.includes('¥') || (cellText.match(/^\d{1,3}(,\d{3})*$/) && parseInt(cellText.replace(/,/g, '')) > 100)) {
                        const price = parseCurrency(cellText);
                        if (price > 0) {
                            return price;
                        }
                    }
                }
                return 0;
            }

            // Calculate visible total (currently displayed rows)
            let visibleTotal = 0;
            visibleRows.forEach(row => {
                visibleTotal += getPriceFromRow(row);
            });

            // Calculate checked total
            let checkedTotal = 0;
            checkedRows.forEach(row => {
                checkedTotal += getPriceFromRow(row);
            });

            return { checkedCount, visibleTotal, checkedTotal };
        }

        // Helper function to update pagination summary
        function updatePaginationSummary(pagerId, viewType) {
            const pager = document.getElementById(pagerId);
            if (!pager) return;

            const summary = calculateSummaryData(viewType);
            let summaryElement = pager.querySelector('.pagination-summary');

            if (!summaryElement) {
                summaryElement = document.createElement('div');
                summaryElement.className = 'pagination-summary';
                pager.insertBefore(summaryElement, pager.firstChild);
            }

            // Calculate visible count (current page)
            let visibleCount;
            if (viewType === 'quotation') {
                const start = (quotationCurrentPage - 1) * perPage;
                const end = Math.min(start + perPage, quotationFilteredRows.length);
                visibleCount = end - start;
            } else if (viewType === 'order') {
                const start = (currentPage - 1) * perPage;
                const end = Math.min(start + perPage, filteredRows.length);
                visibleCount = end - start;
            } else if (viewType === 'delivery') {
                // For delivery view, check which tab is active
                const deliveryWaitContainer = document.getElementById('delivery-wait-container');
                const deliveryDoneContainer = document.getElementById('delivery-done-container');

                if (deliveryWaitContainer && deliveryWaitContainer.style.display !== 'none') {
                    if (typeof waitCurrentPage !== 'undefined' && typeof waitFiltered !== 'undefined') {
                        const waitPerPage = 20;
                        const start = (waitCurrentPage - 1) * waitPerPage;
                        const end = Math.min(start + waitPerPage, waitFiltered.length);
                        visibleCount = end - start;
                    } else {
                        visibleCount = 0;
                    }
                } else if (deliveryDoneContainer && deliveryDoneContainer.style.display !== 'none') {
                    if (typeof doneCurrentPage !== 'undefined' && typeof doneFiltered !== 'undefined') {
                        const donePerPage = 20;
                        const start = (doneCurrentPage - 1) * donePerPage;
                        const end = Math.min(start + donePerPage, doneFiltered.length);
                        visibleCount = end - start;
                    } else {
                        visibleCount = 0;
                    }
                } else {
                    visibleCount = 0;
                }
            } else {
                visibleCount = 0;
            }

            summaryElement.innerHTML = `
                <div>チェック件数 ${summary.checkedCount} 件　表示件数 ${visibleCount} 件</div>
                <div>チェック定価合計 ${formatCurrency(summary.checkedTotal)}　表示中定価合計 ${formatCurrency(summary.visibleTotal)}</div>
            `;
        }

        function updateMainCheckboxState() {
            const visibleBoxes = document.querySelectorAll('tbody td .checkbox');
            const checkedCount = Array.from(visibleBoxes).filter(cb => cb.checked).length;
            if (mainCheckbox) {
                mainCheckbox.checked = checkedCount > 0 && checkedCount === visibleBoxes.length;
                mainCheckbox.indeterminate = checkedCount > 0 && checkedCount < visibleBoxes.length;
            }
        }

        function attachRowCheckboxListeners() {
            document.querySelectorAll('td .checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function () {
                    updateActionButtons();
                    updateMainCheckboxState();

                    // Update pagination summaries
                    const activeView = document.querySelector('.view:not([style*="display: none"])');
                    if (activeView) {
                        if (activeView.id === 'quotation-view') {
                            updatePaginationSummary('pagination', 'quotation');
                        } else if (activeView.id === 'order-view') {
                            updatePaginationSummary('order-pagination', 'order');
                        }
                    }
                });
            });
        }

        function buildPagination(totalPages) {
            let pager;
            const activeView = document.querySelector('.view:not([style*="display: none"])');
            if (activeView) {
                if (activeView.id === 'order-view') {
                    pager = document.getElementById('order-pagination');
                } else if (activeView.id === 'delivery-view') {
                    pager = document.getElementById('delivery-pagination');
                } else if (activeView.id === 'quotation-view') {
                    pager = document.getElementById('pagination');
                }
            }
            if (!pager) return;
            const shown = Math.min(totalPages, 3); // 1〜3ページ分を表示
            pager.innerHTML = '';
            const prev = document.createElement('button');
            prev.textContent = '前へ';
            prev.className = 'page-btn';
            prev.disabled = currentPage === 1;
            prev.addEventListener('click', () => renderPage(currentPage - 1));
            pager.appendChild(prev);
            for (let i = 1; i <= shown; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                btn.addEventListener('click', () => renderPage(i));
                pager.appendChild(btn);
            }
            const next = document.createElement('button');
            next.textContent = '次へ';
            next.className = 'page-btn';
            const totalPagesAll = Math.ceil(filteredRows.length / perPage) || 1;
            next.disabled = currentPage >= totalPagesAll;
            next.addEventListener('click', () => renderPage(currentPage + 1));
            pager.appendChild(next);
        }

        // Quotation view pagination functions
        function buildQuotationPagination(totalPages) {
            const pager = document.getElementById('pagination');
            if (!pager) return;
            const shown = Math.min(totalPages, 3); // 1〜3ページ分を表示

            // Clear and create new structure
            pager.innerHTML = '';

            // Create summary element
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'pagination-summary';
            pager.appendChild(summaryDiv);

            // Create controls container
            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'pagination-controls';

            const prev = document.createElement('button');
            prev.textContent = '前へ';
            prev.className = 'page-btn';
            prev.disabled = quotationCurrentPage === 1;
            prev.addEventListener('click', () => renderQuotationPage(quotationCurrentPage - 1));
            controlsDiv.appendChild(prev);

            for (let i = 1; i <= shown; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = 'page-btn' + (i === quotationCurrentPage ? ' active' : '');
                btn.addEventListener('click', () => renderQuotationPage(i));
                controlsDiv.appendChild(btn);
            }

            const next = document.createElement('button');
            next.textContent = '次へ';
            next.className = 'page-btn';
            const totalPagesAll = Math.ceil(quotationFilteredRows.length / perPage) || 1;
            next.disabled = quotationCurrentPage >= totalPagesAll;
            next.addEventListener('click', () => renderQuotationPage(quotationCurrentPage + 1));
            controlsDiv.appendChild(next);

            pager.appendChild(controlsDiv);

            // Update summary
            updatePaginationSummary('pagination', 'quotation');
        }

        // Order view pagination functions
        function buildOrderPagination(totalPages) {
            const pager = document.getElementById('order-pagination');
            if (!pager) return;
            const shown = Math.min(totalPages, 3); // 1〜3ページ分を表示

            // Clear and create new structure
            pager.innerHTML = '';

            // Create summary element
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'pagination-summary';
            pager.appendChild(summaryDiv);

            // Create controls container
            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'pagination-controls';

            const prev = document.createElement('button');
            prev.textContent = '前へ';
            prev.className = 'page-btn';
            prev.disabled = currentPage === 1;
            prev.addEventListener('click', () => renderPage(currentPage - 1));
            controlsDiv.appendChild(prev);

            for (let i = 1; i <= shown; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = 'page-btn' + (i === currentPage ? ' active' : '');
                btn.addEventListener('click', () => renderPage(i));
                controlsDiv.appendChild(btn);
            }

            const next = document.createElement('button');
            next.textContent = '次へ';
            next.className = 'page-btn';
            const totalPagesAll = Math.ceil(filteredRows.length / perPage) || 1;
            next.disabled = currentPage >= totalPagesAll;
            next.addEventListener('click', () => renderPage(currentPage + 1));
            controlsDiv.appendChild(next);

            pager.appendChild(controlsDiv);

            // Update summary
            updatePaginationSummary('order-pagination', 'order');
        }

        // Delivery view pagination functions
        function buildDeliveryPagination(totalPages, currentPageVar, pagerId) {
            const pager = document.getElementById(pagerId);
            if (!pager) return;
            const shown = Math.min(totalPages, 3); // 1〜3ページ分を表示

            // Clear and create new structure
            pager.innerHTML = '';

            // Create summary element
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'pagination-summary';
            pager.appendChild(summaryDiv);

            // Create controls container
            const controlsDiv = document.createElement('div');
            controlsDiv.className = 'pagination-controls';

            const prev = document.createElement('button');
            prev.textContent = '前へ';
            prev.className = 'page-btn';
            prev.disabled = currentPageVar === 1;

            // Determine which render function to use
            if (pagerId === 'delivery-pagination') {
                prev.addEventListener('click', () => renderWaitPage(currentPageVar - 1));
            } else if (pagerId === 'delivery-done-pagination') {
                prev.addEventListener('click', () => renderDonePage(currentPageVar - 1));
            }
            controlsDiv.appendChild(prev);

            for (let i = 1; i <= shown; i++) {
                const btn = document.createElement('button');
                btn.textContent = i;
                btn.className = 'page-btn' + (i === currentPageVar ? ' active' : '');

                if (pagerId === 'delivery-pagination') {
                    btn.addEventListener('click', () => renderWaitPage(i));
                } else if (pagerId === 'delivery-done-pagination') {
                    btn.addEventListener('click', () => renderDonePage(i));
                }
                controlsDiv.appendChild(btn);
            }

            const next = document.createElement('button');
            next.textContent = '次へ';
            next.className = 'page-btn';
            next.disabled = currentPageVar >= totalPages;

            if (pagerId === 'delivery-pagination') {
                next.addEventListener('click', () => renderWaitPage(currentPageVar + 1));
            } else if (pagerId === 'delivery-done-pagination') {
                next.addEventListener('click', () => renderDonePage(currentPageVar + 1));
            }
            controlsDiv.appendChild(next);

            pager.appendChild(controlsDiv);

            // Update summary
            updatePaginationSummary(pagerId, 'delivery');
        }

        function renderQuotationPage(page) {
            if (!quotationTbody) return;
            const totalPages = Math.ceil(quotationFilteredRows.length / perPage) || 1;
            quotationCurrentPage = Math.max(1, Math.min(page, totalPages));
            quotationTbody.innerHTML = '';
            const start = (quotationCurrentPage - 1) * perPage;
            const end = start + perPage;
            quotationFilteredRows.slice(start, end).forEach(r => quotationTbody.appendChild(r));
            // 再バインド
            attachRowCheckboxListeners();
            updateMainCheckboxState();
            updateActionButtons();
            buildQuotationPagination(totalPages);
            bindToggleButtons(); // 詳細表示ボタンのイベントリスナーを再バインド
        }

        function renderPage(page) {
            const totalPages = Math.ceil(filteredRows.length / perPage) || 1;
            currentPage = Math.max(1, Math.min(page, totalPages));
            orderTbody.innerHTML = '';
            const start = (currentPage - 1) * perPage;
            const end = start + perPage;
            filteredRows.slice(start, end).forEach(r => orderTbody.appendChild(r));
            // 再バインド
            attachRowCheckboxListeners();
            updateMainCheckboxState();
            updateActionButtons();
            buildOrderPagination(totalPages);
            bindToggleButtons(); // 詳細表示ボタンのイベントリスナーを再バインド
        }

        function updateActionButtons() {
            // 見積処理のボタン制御
            const quotationCheckedBoxes = document.querySelectorAll('#quotation-view tbody td .checkbox:checked');
            const quotationHasSelection = quotationCheckedBoxes.length > 0;

            const csvExportBtn = document.getElementById('export-dropdown-btn');
            const faxModalBtn = document.getElementById('fax-modal-btn');

            // チェックボックスが選択されていない場合は全て無効化
            if (!quotationHasSelection) {
                if (csvExportBtn) csvExportBtn.disabled = true;
                if (faxModalBtn) faxModalBtn.disabled = true;
            } else {
                // チェックボックスが選択されている場合は有効化
                if (csvExportBtn) csvExportBtn.disabled = false;
                if (faxModalBtn) faxModalBtn.disabled = false;
            }

            // 受注処理のボタン制御
            const orderCheckedBoxes = document.querySelectorAll('#order-view tbody td .checkbox:checked');
            const orderHasSelection = orderCheckedBoxes.length > 0;

            const orderCsvExportBtn = document.getElementById('order-export-csv-btn');
            const orderDelayCsvExportBtn = document.getElementById('order-delay-export-csv-btn');
            const orderFaxModalBtn = document.getElementById('order-fax-modal-btn');
            const orderDelayFaxModalBtn = document.getElementById('order-delay-fax-modal-btn');
            const delayProcessingBtn = document.getElementById('delay-processing-btn');

            if (!orderHasSelection) {
                if (orderCsvExportBtn) orderCsvExportBtn.disabled = true;
                if (orderDelayCsvExportBtn) orderDelayCsvExportBtn.disabled = true;
                if (orderFaxModalBtn) orderFaxModalBtn.disabled = true;
                if (orderDelayFaxModalBtn) orderDelayFaxModalBtn.disabled = true;
                if (delayProcessingBtn) delayProcessingBtn.disabled = true;
            } else {
                if (orderCsvExportBtn) orderCsvExportBtn.disabled = false;
                if (orderDelayCsvExportBtn) orderDelayCsvExportBtn.disabled = false;
                if (orderFaxModalBtn) orderFaxModalBtn.disabled = false;
                if (orderDelayFaxModalBtn) orderDelayFaxModalBtn.disabled = false;
                if (delayProcessingBtn) delayProcessingBtn.disabled = false;
            }

            // 納品処理のボタン制御
            const deliveryCheckedBoxes = document.querySelectorAll('#delivery-view tbody td .checkbox:checked');
            const deliveryHasSelection = deliveryCheckedBoxes.length > 0;

            const deliveryCsvExportBtn = document.getElementById('delivery-export-csv-btn');
            const deliveryFaxModalBtn = document.getElementById('delivery-fax-modal-btn');

            if (!deliveryHasSelection) {
                if (deliveryCsvExportBtn) deliveryCsvExportBtn.disabled = true;
                if (deliveryFaxModalBtn) deliveryFaxModalBtn.disabled = true;
            } else {
                if (deliveryCsvExportBtn) deliveryCsvExportBtn.disabled = false;
                if (deliveryFaxModalBtn) deliveryFaxModalBtn.disabled = false;
            }
        }

        if (mainCheckbox) {
            mainCheckbox.addEventListener('change', function () {
                document.querySelectorAll('tbody td .checkbox').forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
                updateActionButtons();
                updateMainCheckboxState();

                // Update pagination summaries
                const activeView = document.querySelector('.view:not([style*="display: none"])');
                if (activeView) {
                    if (activeView.id === 'quotation-view') {
                        updatePaginationSummary('pagination', 'quotation');
                    } else if (activeView.id === 'order-view') {
                        updatePaginationSummary('order-pagination', 'order');
                    }
                }
            });
        }

        // Individual checkbox listeners (re-attach after pagination render)
        function initCheckboxListeners() {
            attachRowCheckboxListeners();
        }
        initCheckboxListeners();

        renderPage(1);

        // 初期状態でボタンの状態を確実に設定
        updateActionButtons();

        // Initialize quotation pagination if quotation view is active
        if (quotationTbody && quotationAllRows.length > 0) {
            const quotationTotalPages = Math.ceil(quotationAllRows.length / perPage) || 1;
            if (quotationTotalPages > 1) {
                renderQuotationPage(1);
            } else {
                buildQuotationPagination(quotationTotalPages);
            }
        }

        // Initialize order pagination - always show pagination buttons
        if (orderTbody && allRows.length >= 0) {
            const totalPages = Math.ceil(allRows.length / perPage) || 1;
            buildOrderPagination(totalPages);
        }

        // Initialize order/delivery pagination if order or delivery view is active
        const activeView = document.querySelector('.view:not([style*="display: none"])');
        if (activeView && (activeView.id === 'order-view' || activeView.id === 'delivery-view')) {
            if (orderTbody && allRows.length > 0) {
                const totalPages = Math.ceil(allRows.length / perPage) || 1;
                if (totalPages > 1) {
                    renderPage(1);
                }
            }
        }

        // Dropdown functionality
        const dropdownBtn = null; // 元のドロップダウンは削除済み
        const dropdownMenu = null; // 元のドロップダウンは削除済み
        const quotationSendBtn = null; // 元のボタンは削除済み
        const quotationProcessingBtn = null; // 元のボタンは削除済み
        // Modal edit button & modal elements - 削除済み

        // モーダル内の新しいボタンと要素 - 削除済み

        // 初期状態: チェックボックス未選択時は全ての操作ボタンを無効化
        // その他の操作ボタンも初期状態で無効化
        const csvExportBtn = document.getElementById('export-dropdown-btn');
        const faxModalBtn = document.getElementById('fax-modal-btn');
        if (csvExportBtn) {
            csvExportBtn.disabled = true;
        }
        if (faxModalBtn) {
            faxModalBtn.disabled = true;
        }

        // 受注処理ページのボタンも初期状態で無効化
        const orderCsvExportBtn = document.getElementById('order-export-csv-btn');
        const orderDelayCsvExportBtn = document.getElementById('order-delay-export-csv-btn');
        const orderFaxModalBtn = document.getElementById('order-fax-modal-btn');
        const orderDelayFaxModalBtn = document.getElementById('order-delay-fax-modal-btn');
        const delayProcessingBtn = document.getElementById('delay-processing-btn');

        if (orderCsvExportBtn) orderCsvExportBtn.disabled = true;
        if (orderDelayCsvExportBtn) orderDelayCsvExportBtn.disabled = true;
        if (orderFaxModalBtn) orderFaxModalBtn.disabled = true;
        if (orderDelayFaxModalBtn) orderDelayFaxModalBtn.disabled = true;
        if (delayProcessingBtn) delayProcessingBtn.disabled = true;

        // 納品処理ページのボタンも初期状態で無効化
        const deliveryCsvExportBtn = document.getElementById('delivery-export-csv-btn');
        const deliveryFaxModalBtn = document.getElementById('delivery-fax-modal-btn');

        if (deliveryCsvExportBtn) deliveryCsvExportBtn.disabled = true;
        if (deliveryFaxModalBtn) deliveryFaxModalBtn.disabled = true;

        // Warehouse dropdown functionality
        const warehouseDropdownBtn = document.getElementById('warehouse-dropdown-btn');
        const warehouseDropdownMenu = document.getElementById('warehouse-dropdown-menu');
        let selectedWarehouse = 'all';

        // Function to update header background color
        function updateHeaderBackground(warehouse) {
            const topBar = document.querySelector('.top-bar');
            const warehouseBtn = document.getElementById('warehouse-dropdown-btn');
            const warehouseBtnText = document.getElementById('warehouse-btn-text');

            if (topBar) {
                // Reset to default background
                topBar.style.background = '#fff';

                // Apply warehouse-specific background color and text color
                switch (warehouse) {
                    case 'zama':
                        topBar.style.background = '#d1fae5'; // 座間倉庫の緑系
                        if (warehouseBtn) warehouseBtn.style.color = '#059669'; // 緑系テキスト
                        if (warehouseBtnText) warehouseBtnText.style.color = '#059669';
                        break;
                    case 'yokohama':
                        topBar.style.background = '#fef9c3'; // 横浜倉庫の黄系
                        if (warehouseBtn) warehouseBtn.style.color = '#d97706'; // 黄系テキスト
                        if (warehouseBtnText) warehouseBtnText.style.color = '#d97706';
                        break;
                    case 'koshien':
                        topBar.style.background = '#fee2e2'; // 甲子園倉庫の赤系
                        if (warehouseBtn) warehouseBtn.style.color = '#dc2626'; // 赤系テキスト
                        if (warehouseBtnText) warehouseBtnText.style.color = '#dc2626';
                        break;
                    default:
                        topBar.style.background = '#fff'; // 全倉庫はデフォルト
                        if (warehouseBtn) warehouseBtn.style.color = '#374151'; // デフォルトテキスト色
                        if (warehouseBtnText) warehouseBtnText.style.color = '#374151';
                        break;
                }
            }
        }

        // Function to check if current view supports warehouse selection
        function isWarehouseViewActive() {
            const quotationView = document.getElementById('quotation-view');
            const orderView = document.getElementById('order-view');
            const deliveryView = document.getElementById('delivery-view');

            return (quotationView && quotationView.style.display !== 'none') ||
                (orderView && orderView.style.display !== 'none') ||
                (deliveryView && deliveryView.style.display !== 'none');
        }

        if (warehouseDropdownBtn && warehouseDropdownMenu) {
            warehouseDropdownBtn.addEventListener('click', function (e) {
                e.stopPropagation();
                warehouseDropdownMenu.classList.toggle('show');
            });

            warehouseDropdownMenu.addEventListener('click', function (e) {
                if (e.target.classList.contains('dropdown-item')) {
                    const warehouse = e.target.getAttribute('data-warehouse');
                    const warehouseName = e.target.textContent;
                    selectedWarehouse = warehouse;

                    // Update button text
                    const warehouseBtnText = document.getElementById('warehouse-btn-text');
                    if (warehouseBtnText) {
                        warehouseBtnText.textContent = warehouseName;
                    }

                    // Update header background color if warehouse view is active
                    if (isWarehouseViewActive()) {
                        updateHeaderBackground(warehouse);
                    }

                    // Close dropdown
                    warehouseDropdownMenu.classList.remove('show');

                    // Filter table based on selected warehouse (実装例)
                    console.log(`Selected warehouse: ${warehouse} (${warehouseName})`);
                    // ここで実際のフィルタリング処理を実装できます
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function () {
                warehouseDropdownMenu.classList.remove('show');
            });
        }

        // 見積処理関連の機能は編集モーダル内に統合済み

        // New function to handle details toggle
        function bindToggleButtons() {
            const toggleButtons = document.querySelectorAll('.toggle-details-btn');
            toggleButtons.forEach(button => {
                // Avoid attaching multiple listeners
                if (button.dataset.listenerAttached) return;
                button.dataset.listenerAttached = 'true';

                button.addEventListener('click', function () {
                    const dataRow = this.closest('.data-row');
                    const detailsRow = dataRow.nextElementSibling;

                    if (detailsRow && detailsRow.classList.contains('details-row')) {
                        const isExpanded = this.getAttribute('aria-expanded') === 'true';
                        this.setAttribute('aria-expanded', !isExpanded);
                        dataRow.classList.toggle('open');
                        detailsRow.style.display = isExpanded ? 'none' : 'table-row';
                    }
                });
            });
        }

        // Initial call to bind toggle buttons
        bindToggleButtons();
    </script>
    <script>
        // ====== Delivery View: behaviors (tabs, selection, actions) ======
        (function () {
            const root = document.getElementById('delivery-view');
            if (!root) return;

            const tabs = root.querySelectorAll('#delivery-tabs .tab');
            const waitContainer = document.getElementById('delivery-wait-container');
            const doneContainer = document.getElementById('delivery-done-container');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    const isWait = tab.getAttribute('data-tab') === 'wait';
                    waitContainer.style.display = isWait ? 'block' : 'none';
                    doneContainer.style.display = isWait ? 'none' : 'block';
                    // Reset pagination when switching tabs
                    if (isWait) {
                        renderWaitPage(1);
                    } else {
                        renderDonePage(1);
                    }
                });
            });

            // ===== 出荷待タブのページネーション =====
            const waitTbody = document.querySelector('#delivery-wait-table tbody');
            const waitRows = Array.from(waitTbody.querySelectorAll('tr.data-row'));
            let waitFiltered = waitRows.slice();
            const waitPerPage = 20;
            let waitCurrentPage = 1;
            const waitPager = document.getElementById('delivery-pagination');

            function renderWaitPage(page) {
                const totalPages = Math.ceil(waitFiltered.length / waitPerPage) || 1;
                waitCurrentPage = Math.max(1, Math.min(page, totalPages));

                // テーブルをクリア
                waitTbody.innerHTML = '';

                // 現在のページのデータを表示
                const start = (waitCurrentPage - 1) * waitPerPage;
                const end = start + waitPerPage;
                const pageRows = waitFiltered.slice(start, end);

                pageRows.forEach(row => {
                    waitTbody.appendChild(row);
                    // 詳細行も追加
                    const nextSibling = row.nextElementSibling;
                    if (nextSibling && nextSibling.classList.contains('details-row')) {
                        waitTbody.appendChild(nextSibling);
                    }
                });

                // チェックボックスのイベントリスナーを再バインド
                bindRowCbs();
                // ページネーションボタンを更新
                buildWaitPagination(totalPages);
                updateActions();
            }

            function buildWaitPagination(totalPages) {
                buildDeliveryPagination(totalPages, waitCurrentPage, 'delivery-pagination');
            }

            // ===== 出荷済タブのページネーション =====
            const doneTbody = document.querySelector('#delivery-done-table tbody');
            const doneRows = Array.from(doneTbody.querySelectorAll('tr.data-row'));
            let doneFiltered = doneRows.slice();
            const donePerPage = 20;
            let doneCurrentPage = 1;
            const donePager = document.getElementById('delivered-pagination');

            function renderDonePage(page) {
                const totalPages = Math.ceil(doneFiltered.length / donePerPage) || 1;
                doneCurrentPage = Math.max(1, Math.min(page, totalPages));

                // テーブルをクリア
                doneTbody.innerHTML = '';

                // 現在のページのデータを表示
                const start = (doneCurrentPage - 1) * donePerPage;
                const end = start + donePerPage;
                const pageRows = doneFiltered.slice(start, end);

                pageRows.forEach(row => {
                    doneTbody.appendChild(row);
                    // 詳細行も追加
                    const nextSibling = row.nextElementSibling;
                    if (nextSibling && nextSibling.classList.contains('details-row')) {
                        doneTbody.appendChild(nextSibling);
                    }
                });

                // チェックボックスのイベントリスナーを再バインド
                bindRowCbs();
                // ページネーションボタンを更新
                buildDonePagination(totalPages);
            }

            function buildDonePagination(totalPages) {
                buildDeliveryPagination(totalPages, doneCurrentPage, 'delivered-pagination');
            }

            // 出荷待テーブルのチェックボックスとアクション
            const mainCb = document.getElementById('delivery-main-checkbox');
            const actions = document.getElementById('delivery-actions');
            const tbody = document.querySelector('#delivery-wait-table tbody');
            const dateInput = document.getElementById('delivery-date');
            const shipBtn = document.getElementById('btn-ship');
            const backBtn = document.getElementById('btn-back-to-arranged');
            const carrierSel = document.getElementById('carrier-select');
            const trackingInp = document.getElementById('tracking-input');
            const setTrackingBtn = document.getElementById('btn-set-tracking');

            // date初期値は今日
            if (dateInput && !dateInput.value) {
                const t = new Date();
                const y = t.getFullYear();
                const m = String(t.getMonth() + 1).padStart(2, '0');
                const d = String(t.getDate()).padStart(2, '0');
                dateInput.value = `${y}-${m}-${d}`;
            }

            // 初期状態でボタンを無効化
            if (backBtn) backBtn.disabled = true;
            if (shipBtn) shipBtn.disabled = true;

            // 出荷処理ページの編集・エクスポート・FAXボタンも初期状態で無効化
            const deliveryEditBtn = document.getElementById('delivery-edit-btn');
            const deliveryCsvBtn = document.getElementById('delivery-export-dropdown-btn');
            const deliveryFaxModalBtn = document.getElementById('delivery-fax-modal-btn');

            // 納品編集ボタンにツールチップを追加
            if (deliveryEditBtn) {
                deliveryEditBtn.title = '選択した納品の情報を編集します';
            }
            if (deliveryEditBtn) deliveryEditBtn.disabled = true;
            if (deliveryCsvBtn) deliveryCsvBtn.disabled = true;
            if (deliveryFaxModalBtn) deliveryFaxModalBtn.disabled = true;

            function selectedCount() {
                return root.querySelectorAll('#delivery-wait-table tbody td .checkbox:checked').length;
            }
            function updateActions() {
                const hasSel = selectedCount() > 0;
                // actions.classList.toggle('show', hasSel); // この行をコメントアウト（常に表示するため）
                backBtn.disabled = !hasSel;
                shipBtn.disabled = !(hasSel && !!dateInput.value);

                // Update delivery panel selection count
                updateDeliveryPanelSelectionCount();

                // 編集ボタンとエクスポート/FAXボタンの表示制御を有効/無効制御に変更
                const editBtn = document.getElementById('delivery-edit-btn');
                const csvBtn = document.getElementById('delivery-export-dropdown-btn');
                const faxBtn = document.getElementById('delivery-fax-modal-btn');

                // 常に表示し、有効/無効のみ制御
                if (editBtn) {
                    editBtn.style.display = '';
                    editBtn.disabled = !hasSel;
                }
                if (csvBtn) {
                    csvBtn.style.display = '';
                    csvBtn.disabled = !hasSel;
                }
                if (faxBtn) {
                    faxBtn.style.display = '';
                    faxBtn.disabled = !hasSel;
                }
            }

            function bindRowCbs() {
                root.querySelectorAll('#delivery-wait-table tbody td .checkbox').forEach(cb => {
                    cb.addEventListener('change', () => {
                        updateActions();
                        // ページネーションサマリーを更新
                        updatePaginationSummary('#delivery-pagination');
                    });
                });

                // 出荷済タブのチェックボックスイベントリスナーも追加
                root.querySelectorAll('#delivery-done-table tbody td .checkbox').forEach(cb => {
                    cb.addEventListener('change', () => {
                        // ページネーションサマリーを更新
                        updatePaginationSummary('#delivered-pagination');
                    });
                });
            }

            mainCb?.addEventListener('change', function () {
                root.querySelectorAll('#delivery-wait-table tbody td .checkbox').forEach(cb => { cb.checked = mainCb.checked; });
                updateActions();
                // ページネーションサマリーを更新
                updatePaginationSummary('#delivery-pagination');
            });
            dateInput?.addEventListener('change', updateActions);

            // ボタン動作（ダミー）
            backBtn?.addEventListener('click', () => {
                alert(`${selectedCount()}件を手配済に戻しました。`);
            });
            shipBtn?.addEventListener('click', () => {
                if (shipBtn.disabled) return;
                alert(`${selectedCount()}件を ${dateInput.value} に出荷しました。`);
            });

            // 初期化
            renderWaitPage(1);
            renderDonePage(1);
            updateActions();
        })();
    </script>
    <script>
        // ====== Order View: scoped behaviors (pagination, checkboxes, dropdown) ======
        (function () {
            const container = document.getElementById('order-view');
            if (!container) return;

            const tbody = container.querySelector('#order-data-table tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            let filtered = rows.slice();
            const perPage = 20;
            let current = 1;

            const mainCb = container.querySelector('#order-main-checkbox');
            const actions = container.querySelector('#order-dynamic-actions');
            const selectedPanel = container.querySelector('#order-selected-info');
            const selectedCount = container.querySelector('#order-selected-count');
            const selectedBody = container.querySelector('#order-selected-info-tbody');
            const pager = container.querySelector('#order-pagination');
            const delayBtn = container.querySelector('#btn-delay');
            const delayModal = document.getElementById('delay-modal');
            const delayUndecided = document.getElementById('delay-undecided');
            const delayScheduled = document.getElementById('delay-scheduled');
            const delayDate = document.getElementById('delay-date');
            const delayReason = document.getElementById('delay-reason');
            const delayApplyBtn = document.getElementById('delay-apply-btn');
            const delayCloseBtn = document.getElementById('delay-close-btn');

            function updateMainCheckbox() {
                const boxes = Array.from(container.querySelectorAll('tbody td .checkbox'));
                const checked = boxes.filter(b => b.checked).length;
                if (mainCb) {
                    mainCb.checked = checked > 0 && checked === boxes.length;
                    mainCb.indeterminate = checked > 0 && checked < boxes.length;
                }
            }
            function updateActions() {
                const checked = container.querySelectorAll('tbody td .checkbox:checked').length;
                // アクションコンテナは常に表示し、ボタンの無効化のみで制御
                updateButtonStates();
            }
            // Add a state updater for buttons
            function updateButtonStates() {
                const count = container.querySelectorAll('tbody td .checkbox:checked').length;

                // 全てのボタンの状態を更新（見積処理と同様の実装）
                const editBtn = container.querySelector('#order-edit-btn');
                const editBtnDelay = container.querySelector('#order-edit-btn-delay');
                const csvBtn = document.getElementById('order-export-csv-btn');
                const csvDelayBtn = document.getElementById('order-delay-export-csv-btn');
                const faxBtn = container.querySelector('#order-fax-modal-btn');
                const faxDelayBtn = container.querySelector('#order-delay-fax-modal-btn');
                const delayBtn = container.querySelector('#btn-delay');

                const hasSelection = count > 0;

                // チェックボックス選択状態に応じてボタンの有効/無効を制御
                if (editBtn) editBtn.disabled = !hasSelection;
                if (editBtnDelay) editBtnDelay.disabled = !hasSelection;
                if (csvBtn) csvBtn.disabled = !hasSelection;
                if (csvDelayBtn) csvDelayBtn.disabled = !hasSelection;
                if (faxBtn) faxBtn.disabled = !hasSelection;
                if (faxDelayBtn) faxDelayBtn.disabled = !hasSelection;
                if (delayBtn) delayBtn.disabled = !hasSelection;
            }
            function renderSelected() {
                const checked = Array.from(container.querySelectorAll('tbody td .checkbox:checked'));
                if (checked.length === 0) {
                    if (selectedPanel) selectedPanel.style.display = 'none';
                    if (selectedBody) selectedBody.innerHTML = '';
                    if (selectedCount) selectedCount.textContent = '0件選択中';
                    return;
                }
                const html = checked.map(cb => {
                    const tr = cb.closest('tr');
                    const cells = Array.from(tr.querySelectorAll('td')).map(td => td.textContent.trim());
                    const [date, scm, maker, name, code, jan, price, cost, qty, own, memo] = cells.slice(1);
                    return `<tr><td>${maker || ''}</td><td>${name || ''}</td><td>${code || ''}</td><td>${jan || ''}</td><td style="text-align:right;">${qty || ''}</td></tr>`;
                }).join('');
                if (selectedBody) selectedBody.innerHTML = html;
                if (selectedCount) selectedCount.textContent = `${checked.length}件選択中`;
                if (selectedPanel) selectedPanel.style.display = 'block';
            }
            function bindRowCheckboxes() {
                container.querySelectorAll('tbody td .checkbox').forEach(cb => {
                    cb.addEventListener('change', () => {
                        updateActions();
                        renderSelected();
                        updateMainCheckbox();
                        updateButtonStates();
                        // Update order pagination summary
                        updatePaginationSummary('order-pagination', 'order');
                    });
                });
            }
            function buildPager(total) {
                if (!pager) return;
                const shown = Math.min(total, 3); // 1〜3ページ分を表示
                pager.innerHTML = '';
                const prev = document.createElement('button');
                prev.textContent = '前へ';
                prev.className = 'page-btn';
                prev.disabled = current === 1;
                prev.addEventListener('click', () => renderPage(current - 1));
                pager.appendChild(prev);
                for (let i = 1; i <= shown; i++) {
                    const b = document.createElement('button');
                    b.textContent = String(i);
                    b.className = 'page-btn' + (i === current ? ' active' : '');
                    b.addEventListener('click', () => renderPage(i));
                    pager.appendChild(b);
                }
                const next = document.createElement('button');
                next.textContent = '次へ';
                next.className = 'page-btn';
                const totalPages = Math.ceil(filtered.length / perPage) || 1;
                next.disabled = current >= totalPages;
                next.addEventListener('click', () => renderPage(current + 1));
                pager.appendChild(next);
            }
            function renderPage(p) {
                const total = Math.ceil(filtered.length / perPage) || 1;
                current = Math.max(1, Math.min(p, total));
                tbody.innerHTML = '';
                const s = (current - 1) * perPage, e = s + perPage;
                filtered.slice(s, e).forEach(r => tbody.appendChild(r));
                bindRowCheckboxes();
                updateMainCheckbox();
                updateActions();
                buildPager(total);
                updateButtonStates();
            }
            mainCb?.addEventListener('change', function () {
                container.querySelectorAll('tbody td .checkbox').forEach(cb => cb.checked = this.checked);
                updateActions();
                renderSelected();
                updateMainCheckbox();
                updateButtonStates();
                // Update order pagination summary
                updatePaginationSummary('order-pagination', 'order');
            });

            // 編集ボタン：見積処理と同じモーダルを開く
            const editBtn = container.querySelector('#order-edit-btn');
            editBtn?.addEventListener('click', () => {
                const count = container.querySelectorAll('tbody td .checkbox:checked').length;
                if (count === 0) return;
                // open the shared modal
                if (typeof openEditModal === 'function') {
                    openEditModal();
                }
            });

            // 遅延処理用編集ボタン：見積処理と同じモーダルを開く
            const editBtnDelay = container.querySelector('#order-edit-btn-delay');
            editBtnDelay?.addEventListener('click', () => {
                const count = container.querySelectorAll('tbody td .checkbox:checked').length;
                if (count === 0) return;
                // open the shared modal
                if (typeof openEditModal === 'function') {
                    openEditModal();
                }
            });

            // Delay modal handlers
            function openDelayModal() {
                if (!delayModal) return;
                // default radio/date state
                if (delayUndecided) delayUndecided.checked = true;
                if (delayScheduled) delayScheduled.checked = false;
                if (delayDate) { delayDate.value = ''; delayDate.disabled = true; }
                if (delayReason) delayReason.value = '';
                delayModal.classList.add('show');
            }
            function closeDelayModal() { if (delayModal) delayModal.classList.remove('show'); }

            delayUndecided?.addEventListener('change', () => { if (delayUndecided.checked && delayDate) delayDate.disabled = true; });
            delayScheduled?.addEventListener('change', () => { if (delayScheduled.checked && delayDate) delayDate.disabled = false; });

            delayBtn?.addEventListener('click', () => {
                const count = container.querySelectorAll('tbody td .checkbox:checked').length;
                if (count === 0) { alert('対象の受注を選択してください。'); return; }
                openDelayModal();
            });

            delayCloseBtn?.addEventListener('click', closeDelayModal);

            delayApplyBtn?.addEventListener('click', () => {
                const count = container.querySelectorAll('tbody td .checkbox:checked').length;
                if (count === 0) { alert('対象の受注を選択してください。'); return; }
                const status = delayScheduled && delayScheduled.checked ? '発送予定' : '未定';
                const dateText = (status === '発送予定' && delayDate && delayDate.value) ? delayDate.value : (status === '発送予定' ? '日付未選択' : '—');
                const reasonText = delayReason && delayReason.options[delayReason.selectedIndex] ? delayReason.options[delayReason.selectedIndex].text : '—';
                if (status === '発送予定' && (!delayDate || !delayDate.value)) { alert('発送予定日を選択してください。'); return; }
                if (!delayReason || !delayReason.value) { alert('遅延理由を選択してください。'); return; }
                alert(`${count}件の受注に「遅延処理」を適用しました\n状態: ${status}${status === '発送予定' ? '（' + dateText + '）' : ''}\n理由: ${reasonText}`);
                closeDelayModal();
            });

            // 初期化
            renderPage(1);
            renderSelected();

            // Initialize pagination - always show pagination buttons
            const initialTotalPages = Math.ceil(filtered.length / perPage) || 1;
            buildPager(initialTotalPages);

            // Initialize disabled state on load
            updateButtonStates();

            // 削除されたボタンのイベントリスナーはここに存在していましたが、モーダル内に統合されました
        })();
    </script>
    <script>
        // --- Modal helpers ---
        // Edit Modal関連は削除済み

        // --- Order Edit Modal helpers ---
        function openOrderEditModal() {
            const count = document.querySelectorAll('#order-view tbody td .checkbox:checked').length;
            const orderEditSelectedCount = document.getElementById('order-edit-selected-count');
            if (orderEditSelectedCount) orderEditSelectedCount.textContent = `選択された商品 ${count}件`;

            const orderEditModal = document.getElementById('order-edit-modal');
            if (orderEditModal) {
                // モーダルを中央に配置
                const modal = orderEditModal.querySelector('.modal');
                if (modal) {
                    modal.style.left = '50%';
                    modal.style.top = '50%';
                    modal.style.transform = 'translate(-50%, -50%)';
                }
                orderEditModal.classList.add('show');
            }
        }
        function closeOrderEditModal() {
            const orderEditModal = document.getElementById('order-edit-modal');
            if (orderEditModal) orderEditModal.classList.remove('show');
        }

        // --- Edit button open modal - 削除済み ---

        // --- Modal close actions - 削除済み ---

        // --- 入力支援: テンプレ反映 - 削除済み ---

        // --- 更新ボタン: 選択行へ反映 - 削除済み ---

        // --- Order Edit Modal functionality ---
        // const orderEditBtn = document.getElementById('order-edit-btn'); // 上で既に宣言済み
        // const orderEditBtnDelay = document.getElementById('order-edit-btn-delay'); // 上で既に宣言済み
        const orderEditModal = document.getElementById('order-edit-modal');
        const orderEditCloseBtn = document.getElementById('order-edit-close-btn');
        const orderAssistSelect = document.getElementById('order-assist-select');
        const orderMemoInput = document.getElementById('order-memo-input');
        const orderOwnInput = document.getElementById('order-own-input');
        const orderEditApplyBtn = document.getElementById('order-edit-apply-btn');
        const modalOrderDate = document.getElementById('modal-order-date');

        // デフォルトで今日の日付を設定
        if (modalOrderDate) {
            const today = new Date().toISOString().split('T')[0];
            modalOrderDate.value = today;
        }

        // モーダル内のアクションボタン
        const modalBtnToShipmentWait = document.getElementById('modal-btn-to-shipment-wait');
        const modalBtnToInProgress = document.getElementById('modal-btn-to-in-progress');
        const modalBtnToDone = document.getElementById('modal-btn-to-done');

        // 受注処理ボタンにツールチップを追加
        if (modalBtnToShipmentWait) {
            modalBtnToShipmentWait.title = '受注を出荷待状態にします';
        }
        if (modalBtnToInProgress) {
            modalBtnToInProgress.title = '受注を手配中状態にします';
        }
        if (modalBtnToDone) {
            modalBtnToDone.title = '受注を完了状態にします';
        }

        // --- Order Edit button open modal ---
        if (orderEditBtn) {
            orderEditBtn.addEventListener('click', openOrderEditModal);
        }
        if (orderEditBtnDelay) {
            orderEditBtnDelay.addEventListener('click', openOrderEditModal);
        }

        // --- Order Modal close actions ---
        orderEditCloseBtn?.addEventListener('click', closeOrderEditModal);
        orderEditModal?.addEventListener('click', function (e) {
            if (e.target === orderEditModal) closeOrderEditModal();
        });

        // --- Order 入力支援: テンプレ反映 ---
        if (orderAssistSelect) {
            orderAssistSelect.addEventListener('change', function () {
                if (this.value) orderMemoInput.value = this.value;
            });
        }

        // --- Order 更新ボタン: 選択行へ反映 ---
        if (orderEditApplyBtn) {
            orderEditApplyBtn.addEventListener('click', function () {
                const memo = orderMemoInput?.value ?? '';
                const own = orderOwnInput?.value ?? '';
                const checked = Array.from(document.querySelectorAll('#order-view tbody td .checkbox:checked'));
                checked.forEach(cb => {
                    const tr = cb.closest('tr');
                    if (!tr) return;
                    const tds = tr.querySelectorAll('td');
                    if (tds[10]) tds[10].textContent = own;   // 自社管理番号
                    if (tds[11]) tds[11].textContent = memo;  // 担当者備考
                });
                closeOrderEditModal();
            });
        }

        // --- Modal内のアクションボタン機能 ---
        function getOrderSelectionInfo() {
            const checked = Array.from(document.querySelectorAll('#order-view tbody td .checkbox:checked'));
            const dateValue = modalOrderDate?.value;
            return { checked, dateValue, count: checked.length };
        }

        if (modalBtnToShipmentWait) {
            modalBtnToShipmentWait.addEventListener('click', function () {
                const { checked, dateValue, count } = getOrderSelectionInfo();
                if (count === 0) {
                    alert('対象の受注を選択してください。');
                    return;
                }
                if (!dateValue) {
                    alert('日付を選択してください。');
                    return;
                }
                alert(`${count}件を「出荷待ち」に変更しました（基準日: ${dateValue}）。`);
                closeOrderEditModal();
            });
        }

        if (modalBtnToInProgress) {
            modalBtnToInProgress.addEventListener('click', function () {
                const { checked, dateValue, count } = getOrderSelectionInfo();
                if (count === 0) {
                    alert('対象の受注を選択してください。');
                    return;
                }
                alert(`${count}件を「手配中」に変更しました（基準日: ${dateValue || '未設定'}）。`);
                closeOrderEditModal();
            });
        }

        if (modalBtnToDone) {
            modalBtnToDone.addEventListener('click', function () {
                const { checked, dateValue, count } = getOrderSelectionInfo();
                if (count === 0) {
                    alert('対象の受注を選択してください。');
                    return;
                }
                alert(`${count}件を「手配済」に変更しました（基準日: ${dateValue || '未設定'}）。`);
                closeOrderEditModal();
            });
        }
    </script>
    <script>
        (function () {
            // --- 追跡番号設定モーダル ---
            const setTrackingModalBtn = document.getElementById('btn-set-tracking-modal');
            const trackingModal = document.getElementById('tracking-modal');
            const trackingCloseBtn = document.getElementById('tracking-close-btn');
            const trackingApplyBtn = document.getElementById('tracking-apply-btn');
            const modalCarrierSelect = document.getElementById('modal-carrier-select');
            const modalTrackingInput = document.getElementById('modal-tracking-input');
            const trackingSelectedCount = document.getElementById('tracking-selected-count');
            const deliveryTable = document.getElementById('delivery-wait-table');

            function getSelectedRows() {
                return Array.from(deliveryTable.querySelectorAll('tbody td .checkbox:checked'));
            }
            function updateTrackingBtnState() {
                setTrackingModalBtn.disabled = getSelectedRows().length === 0;
            }
            // チェックボックス変更時にボタン状態更新
            deliveryTable.querySelectorAll('tbody td .checkbox').forEach(cb => {
                cb.addEventListener('change', updateTrackingBtnState);
            });
            document.getElementById('delivery-main-checkbox')?.addEventListener('change', updateTrackingBtnState);
            // 初期状態
            updateTrackingBtnState();

            // ボタン押下でモーダル表示
            setTrackingModalBtn.addEventListener('click', function () {
                const selected = getSelectedRows();
                trackingSelectedCount.textContent = `選択された明細 ${selected.length}件`;
                modalCarrierSelect.value = 'yamato';
                modalTrackingInput.value = '';
                trackingModal.classList.add('show');
            });
            // モーダル閉じる
            trackingCloseBtn.addEventListener('click', function () {
                trackingModal.classList.remove('show');
            });
            trackingModal.addEventListener('click', function (e) {
                if (e.target === trackingModal) trackingModal.classList.remove('show');
            });
            // 保存ボタンで選択行に反映
            trackingApplyBtn.addEventListener('click', function () {
                const carrierText = modalCarrierSelect.options[modalCarrierSelect.selectedIndex]?.text || '';
                const trackingNo = modalTrackingInput.value.trim();
                if (!trackingNo) {
                    alert('追跡番号を入力してください。');
                    return;
                }
                const selected = getSelectedRows();
                selected.forEach(cb => {
                    const tr = cb.closest('tr');
                    if (!tr) return;
                    const tds = tr.querySelectorAll('td');
                    if (tds[10]) tds[10].textContent = carrierText; // 運送会社
                    if (tds[11]) tds[11].textContent = trackingNo;  // 追跡番号
                });
                trackingModal.classList.remove('show');
            });
        })();
    </script>
    <script>
        // アップデート情報モーダル機能
        (function () {
            const updateTitle = document.getElementById('update-title');
            const updateModal = document.getElementById('update-modal');
            const updateModalClose = document.getElementById('update-modal-close');
            const updateNotification = document.getElementById('update-notification');
            const newBadge = document.getElementById('new-badge');

            // ローカルストレージから既読状態を取得
            const isRead = localStorage.getItem('update-2025-08-18-read') === 'true';

            // 初期状態の設定
            if (isRead) {
                updateNotification.classList.remove('unread');
                updateNotification.classList.add('read');
                if (newBadge) {
                    newBadge.style.display = 'none';
                }
            }

            // タイトルクリックでモーダル表示
            updateTitle.addEventListener('click', function (e) {
                e.preventDefault();
                updateModal.classList.add('show');

                // 既読状態に変更
                if (!isRead) {
                    updateNotification.classList.remove('unread');
                    updateNotification.classList.add('read');
                    if (newBadge) {
                        newBadge.style.display = 'none';
                    }
                    localStorage.setItem('update-2025-08-18-read', 'true');
                }
            });

            // モーダル閉じる
            updateModalClose.addEventListener('click', function () {
                updateModal.classList.remove('show');
            });

            // モーダル背景クリックで閉じる
            updateModal.addEventListener('click', function (e) {
                if (e.target === updateModal) {
                    updateModal.classList.remove('show');
                }
            });

            // ESCキーでモーダル閉じる
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && updateModal.classList.contains('show')) {
                    updateModal.classList.remove('show');
                }
            });
        })();
    </script>
    <script>
        // All Notifications Modal Functionality
        (function () {
            const viewAllBtn = document.getElementById('view-all-notifications-btn');
            const allNotificationsModal = document.getElementById('all-notifications-modal-backdrop');
            const allNotificationsModalClose = document.getElementById('all-notifications-modal-close');
            const notificationDetailPanel = document.getElementById('notification-detail-panel');
            const notificationDetailTitle = document.getElementById('notification-detail-title');
            const notificationDetailDate = document.getElementById('notification-detail-date');
            const notificationDetailContent = document.getElementById('notification-detail-content');

            // 過去のお知らせデータ
            const pastNotifications = [
                {
                    title: "Webike-SCM お知らせ",
                    date: "2025年08月18日（月）",
                    content: `
                        <h4>システムバグ修正のお知らせ</h4>
                        <p>平素より弊社サービスをご利用いただき、ありがとうございます。</p>
                        <p>2025年08月18日（月）夜間にWebike-SCMのバグ修正を行いました。今回のアップデートは、一部仕入先様の処理中に下記のエラーメッセージが表示される事象への対応となり、現在は解消しております。</p>
                        <h4>修正内容</h4>
                        <ul>
                            <li>見積処理中のタイムアウトエラーを修正</li>
                            <li>一部ブラウザでの表示崩れを修正</li>
                            <li>CSV出力時のエラーハンドリングを改善</li>
                        </ul>
                        <p>何かご不明な点がございましたら、サポートまでお問い合わせください。</p>
                    `
                },
                {
                    title: "システムメンテナンスのお知らせ",
                    date: "2025年08月20日（火）",
                    content: `
                        <h4>定期メンテナンス実施のご案内</h4>
                        <p>下記の日程でシステムメンテナンスを実施いたします。</p>
                        <h4>メンテナンス日時</h4>
                        <p><strong>2025年08月20日（火）午前2時～午前4時</strong></p>
                        <h4>メンテナンス内容</h4>
                        <ul>
                            <li>サーバー機器の定期メンテナンス</li>
                            <li>データベースの最適化</li>
                            <li>セキュリティパッチの適用</li>
                        </ul>
                        <p>メンテナンス中はサービスをご利用いただけません。ご不便をおかけいたしますが、ご理解のほどよろしくお願いいたします。</p>
                    `
                },
                {
                    title: "新機能リリースのご案内",
                    date: "2025年08月15日（木）",
                    content: `
                        <h4>高度な検索フィルター機能追加</h4>
                        <p>新機能「高度な検索フィルター」をリリースしました。</p>
                        <h4>新機能の特徴</h4>
                        <ul>
                            <li>複数条件での絞り込み検索</li>
                            <li>日付範囲指定での検索</li>
                            <li>カスタムフィルターの保存機能</li>
                            <li>検索結果の並び替え機能</li>
                        </ul>
                        <p>この機能により、より詳細な条件でデータを検索できるようになります。使い方はヘルプページをご参照ください。</p>
                    `
                },
                {
                    title: "セキュリティアップデートのお知らせ",
                    date: "2025年08月10日（月）",
                    content: `
                        <h4>セキュリティ強化実施のお知らせ</h4>
                        <p>セキュリティ強化のため、システムのアップデートを実施しました。</p>
                        <h4>変更内容</h4>
                        <ul>
                            <li>パスワードの強度要件変更</li>
                            <li>ログイン認証の強化</li>
                            <li>データ暗号化レベルの向上</li>
                        </ul>
                        <h4>新しいパスワード要件</h4>
                        <ul>
                            <li>8文字以上</li>
                            <li>大文字・小文字・数字・記号を含む</li>
                            <li>過去3回と異なるパスワード</li>
                        </ul>
                        <p>新しい要件をご確認の上、パスワードの変更をお願いいたします。</p>
                    `
                },
                {
                    title: "新機能追加のお知らせ",
                    date: "2025年08月05日（水）",
                    content: `
                        <h4>一括処理機能の追加</h4>
                        <p>新機能「一括処理」を追加しました。</p>
                        <h4>機能詳細</h4>
                        <ul>
                            <li>複数データの同時処理</li>
                            <li>バッチ処理のスケジュール設定</li>
                            <li>処理結果の自動通知</li>
                            <li>エラー発生時の自動ロールバック</li>
                        </ul>
                        <p>これにより、大量のデータを効率的に処理できるようになります。操作方法はマニュアルをご参照ください。</p>
                    `
                },
                {
                    title: "システム改善のお知らせ",
                    date: "2025年07月30日（火）",
                    content: `
                        <h4>パフォーマンス改善実施</h4>
                        <p>システムのパフォーマンスを大幅に改善しました。</p>
                        <h4>改善内容</h4>
                        <ul>
                            <li>ページ読み込み速度を平均30%向上</li>
                            <li>データベースクエリの最適化</li>
                            <li>キャッシュ機能の強化</li>
                            <li>レスポンシブデザインの改善</li>
                        </ul>
                        <p>これらの改善により、より快適にシステムをご利用いただけるようになりました。今後も継続的に改善を行ってまいります。</p>
                    `
                }
            ];

            // ボタンクリックでモーダル表示
            if (viewAllBtn) {
                viewAllBtn.addEventListener('click', function () {
                    allNotificationsModal.classList.add('show');
                    // モーダル表示時にサイドパネルを非表示にする
                    resetDetailPanel();
                });
            }

            // モーダル閉じる
            if (allNotificationsModalClose) {
                allNotificationsModalClose.addEventListener('click', function () {
                    allNotificationsModal.classList.remove('show');
                    resetDetailPanel();
                });
            }

            // モーダル背景クリックで閉じる
            if (allNotificationsModal) {
                allNotificationsModal.addEventListener('click', function (e) {
                    if (e.target === allNotificationsModal) {
                        allNotificationsModal.classList.remove('show');
                        resetDetailPanel();
                    }
                });
            }

            // ESCキーでモーダル閉じる
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && allNotificationsModal && allNotificationsModal.classList.contains('show')) {
                    allNotificationsModal.classList.remove('show');
                    resetDetailPanel();
                }
            });

            // サイドパネルをリセット
            function resetDetailPanel() {
                if (notificationDetailPanel) {
                    notificationDetailPanel.classList.remove('show');
                }
                // 選択状態をリセット
                document.querySelectorAll('.notification-title-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
            }

            // タイトルボタンのクリックイベント
            document.addEventListener('click', function (e) {
                if (e.target.classList.contains('notification-title-btn')) {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    const notification = pastNotifications[index];
                    
                    if (notification) {
                        // 他のボタンの選択状態を解除
                        document.querySelectorAll('.notification-title-btn').forEach(btn => {
                            btn.classList.remove('selected');
                        });
                        
                        // クリックされたボタンを選択状態にする
                        e.target.classList.add('selected');
                        
                        // サイドパネルに内容を表示
                        if (notificationDetailTitle) {
                            notificationDetailTitle.textContent = notification.title;
                        }
                        if (notificationDetailDate) {
                            notificationDetailDate.textContent = notification.date;
                        }
                        if (notificationDetailContent) {
                            notificationDetailContent.innerHTML = notification.content;
                        }
                        
                        // サイドパネルを表示
                        if (notificationDetailPanel) {
                            notificationDetailPanel.classList.add('show');
                        }
                    }
                }
            });
        })();
    </script>
    <script>
        // Mobile responsive functionality
        (function () {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const desktopToggleBtn = document.getElementById('sidebar-toggle');
            const sidebar = document.querySelector('.sidebar');
            const mobileOverlay = document.getElementById('mobile-overlay');

            // Show/hide buttons based on screen size
            function updateButtonVisibility() {
                const isMobile = window.innerWidth <= 768;
                if (mobileMenuBtn && desktopToggleBtn) {
                    mobileMenuBtn.style.display = isMobile ? 'flex' : 'none';
                    desktopToggleBtn.style.display = isMobile ? 'none' : 'flex';
                }
            }

            // Mobile menu toggle
            function toggleMobileMenu() {
                if (sidebar && mobileOverlay) {
                    const isOpen = sidebar.classList.contains('mobile-open');
                    if (isOpen) {
                        sidebar.classList.remove('mobile-open');
                        mobileOverlay.classList.remove('show');
                    } else {
                        sidebar.classList.add('mobile-open');
                        mobileOverlay.classList.add('show');
                    }
                }
            }

            // Close mobile menu
            function closeMobileMenu() {
                if (sidebar && mobileOverlay) {
                    sidebar.classList.remove('mobile-open');
                    mobileOverlay.classList.remove('show');
                }
            }

            // Event listeners
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            }

            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', closeMobileMenu);
            }

            // Close mobile menu when clicking nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (window.innerWidth <= 768) {
                        closeMobileMenu();
                    }
                });
            });

            // Handle window resize
            window.addEventListener('resize', () => {
                updateButtonVisibility();
                // Close mobile menu on resize to desktop
                if (window.innerWidth > 768) {
                    closeMobileMenu();
                }
            });

            // Initial setup
            updateButtonVisibility();
        })();

        // ====== Event Listeners for CSV Export and FAX Output Buttons ======
        (function () {
            // 見積処理 - CSVエクスポート
            const quotationExportBtn = document.getElementById('export-csv-btn');
            if (quotationExportBtn) {
                quotationExportBtn.addEventListener('click', function () {
                    if (this.disabled) {
                        alert('商品を選択してください。');
                        return;
                    }
                    alert('見積処理のCSVエクスポートを実行しました。');
                });
            }

            // 見積処理 - FAX出力
            const quotationFaxBtn = document.getElementById('fax-modal-btn');
            if (quotationFaxBtn) {
                quotationFaxBtn.addEventListener('click', function () {
                });
            }

            // 受注処理 - CSVエクスポート（通常）
            const orderExportBtn = document.getElementById('order-export-csv-btn');
            if (orderExportBtn) {
                orderExportBtn.addEventListener('click', function () {
                    if (this.disabled) {
                        alert('商品を選択してください。');
                        return;
                    }
                    alert('受注処理のCSVエクスポートを実行しました。');
                });
            }

            // 受注処理 - FAX出力（通常）
            const orderFaxBtn = document.getElementById('order-fax-modal-btn');
            if (orderFaxBtn) {
                orderFaxBtn.addEventListener('click', function () {
                    if (this.disabled) {
                        alert('商品を選択してください。');
                        return;
                    }
                    alert('受注処理のFAX出力モーダルを開きます。');
                });
            }

            // 受注処理 - CSVエクスポート（遅延処理用）
            const orderDelayExportBtn = document.getElementById('order-delay-export-csv-btn');
            if (orderDelayExportBtn) {
                orderDelayExportBtn.addEventListener('click', function () {
                    if (this.disabled) {
                        alert('商品を選択してください。');
                        return;
                    }
                    alert('受注処理（遅延処理）のCSVエクスポートを実行しました。');
                });
            }

            // 受注処理 - FAX出力（遅延処理用）
            const orderDelayFaxBtn = document.getElementById('order-delay-fax-modal-btn');
            if (orderDelayFaxBtn) {
                orderDelayFaxBtn.addEventListener('click', function () {
                    if (this.disabled) {
                        alert('商品を選択してください。');
                        return;
                    }
                    alert('受注処理（遅延処理）のFAX出力モーダルを開きます。');
                });
            }

            // 納期調整 - CSVエクスポート
            const deliveryExportBtn = document.getElementById('delivery-export-csv-btn');
            if (deliveryExportBtn) {
                deliveryExportBtn.addEventListener('click', function () {
                    alert('納期調整のCSVエクスポートを実行しました。');
                });
            }

            // 納期調整 - FAX出力
            const deliveryFaxBtn = document.getElementById('delivery-fax-modal-btn');
            if (deliveryFaxBtn) {
                deliveryFaxBtn.addEventListener('click', function () {
                    alert('納期調整のFAX出力モーダルを開きます。');
                });
            }

            // ドロップダウンメニューの動作（見積処理）
            const quotationExportDropdownBtn = document.getElementById('export-dropdown-btn');
            const quotationExportDropdownMenu = document.getElementById('export-dropdown-menu');
            if (quotationExportDropdownBtn && quotationExportDropdownMenu) {
                quotationExportDropdownBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    quotationExportDropdownMenu.style.display = quotationExportDropdownMenu.style.display === 'block' ? 'none' : 'block';
                });
            }

            // ドロップダウンメニューの動作（納期調整）
            const deliveryExportDropdownBtn = document.getElementById('delivery-export-dropdown-btn');
            const deliveryExportDropdownMenu = document.getElementById('delivery-export-dropdown-menu');
            if (deliveryExportDropdownBtn && deliveryExportDropdownMenu) {
                deliveryExportDropdownBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    deliveryExportDropdownMenu.style.display = deliveryExportDropdownMenu.style.display === 'block' ? 'none' : 'block';
                });
            }

            // ドロップダウンメニューを閉じる処理
            document.addEventListener('click', function () {
                if (quotationExportDropdownMenu) quotationExportDropdownMenu.style.display = 'none';
                if (deliveryExportDropdownMenu) deliveryExportDropdownMenu.style.display = 'none';
            });

            // 納期超過アラートの制御
            const deliveryAlertModal = document.getElementById('delivery-alert-modal');
            const deliveryAlertClose = document.getElementById('delivery-alert-close');

            // ページ読み込み時に納期超過アラートを表示
            window.addEventListener('load', function () {
                // 少し遅延させてからアラートを表示
                setTimeout(function () {
                    deliveryAlertModal.style.display = 'flex';
                }, 500);
            });

            // 閉じるボタンのクリックイベント
            deliveryAlertClose.addEventListener('click', function () {
                deliveryAlertModal.style.display = 'none';
            });

            // 背景クリックで閉じる
            deliveryAlertModal.addEventListener('click', function (e) {
                if (e.target === deliveryAlertModal) {
                    deliveryAlertModal.style.display = 'none';
                }
            });

            // ESCキーで閉じる
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape' && deliveryAlertModal.style.display === 'flex') {
                    deliveryAlertModal.style.display = 'none';
                }
            });
        })();
    </script>
    <script>
        // Header resize functionality
        (function () {
            let isResizing = false;
            let currentHeader = null;
            let startX = 0;
            let startWidth = 0;

            function initHeaderResize() {
                const tables = document.querySelectorAll('.data-table');

                tables.forEach(table => {
                    const headers = table.querySelectorAll('th');

                    headers.forEach((header, index) => {
                        // Skip the last header to prevent table overflow, except for RC担当備考 column
                        const isLastHeader = index === headers.length - 1;
                        const isRcMemoColumn = header.textContent.trim() === 'RC担当備考';

                        if (isLastHeader && !isRcMemoColumn) return;

                        header.addEventListener('mousedown', function (e) {
                            const rect = header.getBoundingClientRect();
                            const isRightEdge = e.clientX > rect.right - 10;

                            if (isRightEdge) {
                                e.preventDefault();
                                e.stopPropagation(); // Prevent sort from triggering
                                isResizing = true;
                                currentHeader = header;
                                startX = e.clientX;
                                startWidth = header.offsetWidth;

                                document.body.style.cursor = 'col-resize';
                                document.body.style.userSelect = 'none';
                            }
                        });

                        header.addEventListener('mousemove', function (e) {
                            if (!isResizing) {
                                const rect = header.getBoundingClientRect();
                                const isRightEdge = e.clientX > rect.right - 10;
                                header.style.cursor = isRightEdge ? 'col-resize' : (header.classList.contains('sortable') ? 'pointer' : 'default');
                            }
                        });

                        // ダブルクリックで自動幅調整機能を追加
                        header.addEventListener('dblclick', function (e) {
                            e.preventDefault();
                            
                            // 視覚的フィードバックを表示
                            const originalBg = header.style.backgroundColor;
                            header.style.backgroundColor = '#e0f2fe';
                            header.style.transition = 'background-color 0.2s ease';
                            
                            // 自動調整を実行
                            autoResizeColumn(header, index, table);
                            
                            // フィードバックをリセット
                            setTimeout(() => {
                                header.style.backgroundColor = originalBg;
                                setTimeout(() => {
                                    header.style.transition = '';
                                }, 200);
                            }, 300);
                        });
                    });
                });

                document.addEventListener('mousemove', function (e) {
                    if (!isResizing || !currentHeader) return;

                    const diff = e.clientX - startX;
                    const newWidth = Math.max(50, startWidth + diff); // Minimum width of 50px

                    currentHeader.style.width = newWidth + 'px';
                });

                document.addEventListener('mouseup', function () {
                    if (isResizing) {
                        isResizing = false;
                        currentHeader = null;
                        document.body.style.cursor = '';
                        document.body.style.userSelect = '';
                    }
                });
            }

            // カラム自動幅調整関数
            function autoResizeColumn(header, columnIndex, table) {
                const tbody = table.querySelector('tbody');
                if (!tbody) return;

                // RC担当備考カラムの場合、最後のカラムでも処理を許可
                const isRcMemoColumn = header.textContent.trim() === 'RC担当備考';
                const headers = table.querySelectorAll('th');
                const isLastColumn = columnIndex === headers.length - 1;

                // 一時的な測定用要素を作成
                const measureElement = document.createElement('div');
                measureElement.style.cssText = `
                    position: absolute;
                    visibility: hidden;
                    white-space: nowrap;
                    top: -9999px;
                    left: -9999px;
                `;
                document.body.appendChild(measureElement);

                // ヘッダーのテキスト幅を測定
                const headerText = header.textContent.trim();
                const headerComputedStyle = window.getComputedStyle(header);
                measureElement.style.font = headerComputedStyle.font;
                measureElement.style.fontWeight = headerComputedStyle.fontWeight;
                measureElement.style.fontSize = headerComputedStyle.fontSize;
                measureElement.textContent = headerText;
                let maxContentWidth = measureElement.offsetWidth;

                // 同じカラムの全セルの幅を測定
                const cells = tbody.querySelectorAll(`tr.data-row td:nth-child(${columnIndex + 1})`);
                
                cells.forEach(cell => {
                    const cellText = cell.textContent.trim();
                    if (cellText) {
                        const cellComputedStyle = window.getComputedStyle(cell);
                        measureElement.style.font = cellComputedStyle.font;
                        measureElement.style.fontWeight = cellComputedStyle.fontWeight;
                        measureElement.style.fontSize = cellComputedStyle.fontSize;
                        
                        // 1行表示用：テキスト全体を1行として測定
                        measureElement.textContent = cellText;
                        maxContentWidth = Math.max(maxContentWidth, measureElement.offsetWidth);
                    }
                });

                // 測定用要素を削除
                document.body.removeChild(measureElement);

                // パディングとボーダーを考慮した最終幅を計算
                const padding = 24; // 左右のパディング合計
                const minWidth = 60; // 最小幅
                const maxWidth = isRcMemoColumn ? 600 : 800; // RC担当備考は600px、その他は800px
                let optimalWidth = Math.max(minWidth, Math.ceil(maxContentWidth + padding));

                // 最大幅を制限（ただし、見積処理画面では制限を緩く）
                const isQuotationView = table.closest('#quotation-view') !== null;
                const isOrderView = table.closest('#order-view') !== null;
                const isDeliveryView = table.closest('#delivery-view') !== null;
                if (isQuotationView || isOrderView || isDeliveryView) {
                    // 見積処理画面、受注処理画面、納品処理画面では1行表示なのでより大きな最大幅を設定
                    const quotationMaxWidth = isRcMemoColumn ? 800 : 1200;
                    optimalWidth = Math.min(optimalWidth, quotationMaxWidth);
                } else {
                    optimalWidth = Math.min(optimalWidth, maxWidth);
                }

                // 計算した幅を適用
                header.style.width = optimalWidth + 'px';

                // 対応するすべての列のセルにも幅を適用
                const allCells = table.querySelectorAll(`td:nth-child(${columnIndex + 1})`);
                allCells.forEach(cell => {
                    cell.style.maxWidth = optimalWidth + 'px';
                    cell.style.minWidth = optimalWidth + 'px';
                });

                // 最後のカラムの場合、テーブル全体の幅も調整
                if (isLastColumn && (isRcMemoColumn || isQuotationView || isOrderView || isDeliveryView)) {
                    const currentTableWidth = table.offsetWidth;
                    const originalWidth = header.dataset.originalWidth || header.offsetWidth;
                    const widthDiff = optimalWidth - parseInt(originalWidth);
                    const newTableWidth = currentTableWidth + widthDiff;
                    table.style.width = Math.max(newTableWidth, 1200) + 'px'; // 最小幅1200pxを維持
                }

                // 元の幅を記録
                header.dataset.originalWidth = optimalWidth;

                // 幅が変更されたことをログ出力（デバッグ用）
                console.log(`Column ${columnIndex + 1} (${headerText}) auto-resized to ${optimalWidth}px`);
            }

            // Initialize on page load and when tables are dynamically updated
            document.addEventListener('DOMContentLoaded', initHeaderResize);

            // Re-initialize when pagination changes or tables are updated
            const observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    if (mutation.type === 'childList') {
                        const addedNodes = Array.from(mutation.addedNodes);
                        const hasTable = addedNodes.some(node =>
                            node.nodeType === 1 &&
                            (node.classList && node.classList.contains('data-table') ||
                                node.querySelector && node.querySelector('.data-table'))
                        );

                        if (hasTable) {
                            setTimeout(() => {
                                initHeaderResize();
                                setupTableSort(); // Re-initialize sort functionality
                            }, 100);
                        }
                    }
                });
            });

            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        })();

        // モーダルドラッグ機能
        function makeModalDraggable() {
            const modals = document.querySelectorAll('.modal');

            modals.forEach(modal => {
                const header = modal.querySelector('.modal-header');
                if (!header) return;

                let isDragging = false;
                let startX, startY, startLeft, startTop;

                header.style.cursor = 'move';

                header.addEventListener('mousedown', function (e) {
                    isDragging = true;
                    modal.classList.add('dragging');

                    startX = e.clientX;
                    startY = e.clientY;

                    const rect = modal.getBoundingClientRect();
                    startLeft = rect.left;
                    startTop = rect.top;

                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);

                    e.preventDefault();
                });

                function onMouseMove(e) {
                    if (!isDragging) return;

                    const deltaX = e.clientX - startX;
                    const deltaY = e.clientY - startY;

                    const newLeft = startLeft + deltaX;
                    const newTop = startTop + deltaY;

                    // 画面外に出ないように制限
                    const maxLeft = window.innerWidth - modal.offsetWidth;
                    const maxTop = window.innerHeight - modal.offsetHeight;

                    modal.style.left = Math.max(0, Math.min(newLeft, maxLeft)) + 'px';
                    modal.style.top = Math.max(0, Math.min(newTop, maxTop)) + 'px';
                    modal.style.transform = 'none';
                }

                function onMouseUp() {
                    isDragging = false;
                    modal.classList.remove('dragging');

                    document.removeEventListener('mousemove', onMouseMove);
                    document.removeEventListener('mouseup', onMouseUp);
                }
            });
        }

        // ページ読み込み時にドラッグ機能を初期化
        document.addEventListener('DOMContentLoaded', makeModalDraggable);

        // 動的に追加されるモーダルにもドラッグ機能を適用
        const modalObserver = new MutationObserver(function (mutations) {
            mutations.forEach(function (mutation) {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach(function (node) {
                        if (node.nodeType === Node.ELEMENT_NODE && node.classList.contains('modal')) {
                            makeModalDraggable();
                        }
                    });
                }
            });
        });

        modalObserver.observe(document.body, {
            childList: true,
            subtree: true
        });

        // Quotation right panel functionality
        const quotationPanel = document.getElementById('quotation-right-panel');
        const mainContent = document.querySelector('.main-content');
        const quotationPanelToggle = document.getElementById('quotation-panel-toggle');

        // Function to show/hide quotation panel
        function toggleQuotationPanel(show, collapsed = false) {
            if (!quotationPanel || !mainContent) return;

            if (show) {
                quotationPanel.classList.add('show');

                if (collapsed) {
                    quotationPanel.classList.add('collapsed');
                    mainContent.classList.add('quotation-panel-collapsed');
                    mainContent.classList.remove('quotation-panel-active');
                } else {
                    quotationPanel.classList.remove('collapsed');
                    mainContent.classList.add('quotation-panel-active');
                    mainContent.classList.remove('quotation-panel-collapsed');
                }
            } else {
                quotationPanel.classList.remove('show', 'collapsed');
                mainContent.classList.remove('quotation-panel-active', 'quotation-panel-collapsed');
            }

            // Save state to localStorage
            if (show) {
                localStorage.setItem('scm.quotationPanel.show', '1');
                localStorage.setItem('scm.quotationPanel.collapsed', collapsed ? '1' : '0');
            } else {
                localStorage.setItem('scm.quotationPanel.show', '0');
            }
        }

        // Restore panel state from localStorage
        function restoreQuotationPanelState() {
            const saved = localStorage.getItem('scm.quotationPanel.show');
            const collapsedSaved = localStorage.getItem('scm.quotationPanel.collapsed');

            if (saved === '1') {
                const isCollapsed = collapsedSaved === '1';
                toggleQuotationPanel(true, isCollapsed);
            } else {
                // デフォルトでパネルを非表示にする
                toggleQuotationPanel(false, false);
            }
        }

        // Toggle button functionality
        if (quotationPanelToggle) {
            quotationPanelToggle.addEventListener('click', function (e) {
                e.stopPropagation();

                if (!quotationPanel.classList.contains('show')) {
                    // If panel is not shown, show it expanded
                    toggleQuotationPanel(true, false);
                } else if (quotationPanel.classList.contains('collapsed')) {
                    // If panel is collapsed, expand it
                    toggleQuotationPanel(true, false);
                } else {
                    // If panel is expanded, collapse it
                    toggleQuotationPanel(true, true);
                }
            });
        }

        // Restore panel state on page load
        restoreQuotationPanelState();

        // Order right panel functionality
        const orderPanel = document.getElementById('order-right-panel');
        const orderPanelToggle = document.getElementById('order-panel-toggle');

        // Function to show/hide order panel
        function toggleOrderPanel(show, collapsed = false) {
            if (!orderPanel || !mainContent) return;

            if (show) {
                orderPanel.classList.add('show');

                if (collapsed) {
                    orderPanel.classList.add('collapsed');
                    mainContent.classList.add('order-panel-collapsed');
                    mainContent.classList.remove('order-panel-active');
                } else {
                    orderPanel.classList.remove('collapsed');
                    mainContent.classList.add('order-panel-active');
                    mainContent.classList.remove('order-panel-collapsed');
                }
            } else {
                orderPanel.classList.remove('show', 'collapsed');
                mainContent.classList.remove('order-panel-active', 'order-panel-collapsed');
            }

            // Save state to localStorage
            if (show) {
                localStorage.setItem('scm.orderPanel.show', '1');
                localStorage.setItem('scm.orderPanel.collapsed', collapsed ? '1' : '0');
            } else {
                localStorage.setItem('scm.orderPanel.show', '0');
            }
        }

        // Restore order panel state from localStorage
        function restoreOrderPanelState() {
            const saved = localStorage.getItem('scm.orderPanel.show');
            const collapsedSaved = localStorage.getItem('scm.orderPanel.collapsed');

            if (saved === '1') {
                const isCollapsed = collapsedSaved === '1';
                toggleOrderPanel(true, isCollapsed);
            }
        }

        // Order panel toggle button functionality
        if (orderPanelToggle) {
            orderPanelToggle.addEventListener('click', function (e) {
                e.stopPropagation();

                if (!orderPanel.classList.contains('show')) {
                    // If panel is not shown, show it expanded
                    toggleOrderPanel(true, false);
                } else if (orderPanel.classList.contains('collapsed')) {
                    // If panel is collapsed, expand it
                    toggleOrderPanel(true, false);
                } else {
                    // If panel is expanded, collapse it
                    toggleOrderPanel(true, true);
                }
            });
        }

        // Order panel functionality
        function updateOrderPanelSelectionCount() {
            const checkedBoxes = document.querySelectorAll('#order-view tbody td .checkbox:checked');
            const count = checkedBoxes.length;
            const selectionCountElement = document.getElementById('order-panel-selection-count');
            if (selectionCountElement) {
                selectionCountElement.textContent = `${count}件選択中`;
            }
        }

        // Order panel input support
        const orderPanelAssistSelect = document.getElementById('order-panel-assist-select');
        const orderPanelMemoInput = document.getElementById('order-panel-memo-input');
        const orderPanelOwnInput = document.getElementById('order-panel-own-input');
        const orderPanelDateInput = document.getElementById('order-panel-date');
        const orderPanelUpdateBtn = document.getElementById('order-panel-update-btn');

        // Set default date to today
        if (orderPanelDateInput) {
            const today = new Date().toISOString().split('T')[0];
            orderPanelDateInput.value = today;
        }

        // Assistant select functionality
        if (orderPanelAssistSelect && orderPanelMemoInput) {
            orderPanelAssistSelect.addEventListener('change', function () {
                if (this.value) {
                    orderPanelMemoInput.value = this.value;
                }
            });
        }

        // Update button functionality
        if (orderPanelUpdateBtn) {
            orderPanelUpdateBtn.addEventListener('click', function () {
                const checkedBoxes = document.querySelectorAll('#order-view tbody td .checkbox:checked');
                if (checkedBoxes.length === 0) {
                    alert('更新する受注を選択してください。');
                    return;
                }
                alert(`${checkedBoxes.length}件の受注を更新しました。`);
            });
        }

        // Order panel action buttons
        const orderPanelShipmentWaitBtn = document.getElementById('order-panel-shipment-wait-btn');
        const orderPanelInProgressBtn = document.getElementById('order-panel-in-progress-btn');
        const orderPanelDoneBtn = document.getElementById('order-panel-done-btn');

        if (orderPanelShipmentWaitBtn) {
            orderPanelShipmentWaitBtn.addEventListener('click', function () {
                const checkedBoxes = document.querySelectorAll('#order-view tbody td .checkbox:checked');
                if (checkedBoxes.length === 0) {
                    alert('処理する受注を選択してください。');
                    return;
                }
                alert(`${checkedBoxes.length}件の受注を出荷待状態にしました。`);
            });
        }

        if (orderPanelInProgressBtn) {
            orderPanelInProgressBtn.addEventListener('click', function () {
                const checkedBoxes = document.querySelectorAll('#order-view tbody td .checkbox:checked');
                if (checkedBoxes.length === 0) {
                    alert('処理する受注を選択してください。');
                    return;
                }
                alert(`${checkedBoxes.length}件の受注を手配中状態にしました。`);
            });
        }

        if (orderPanelDoneBtn) {
            orderPanelDoneBtn.addEventListener('click', function () {
                const checkedBoxes = document.querySelectorAll('#order-view tbody td .checkbox:checked');
                if (checkedBoxes.length === 0) {
                    alert('処理する受注を選択してください。');
                    return;
                }
                alert(`${checkedBoxes.length}件の受注を完了状態にしました。`);
            });
        }

        // Restore order panel state on page load
        restoreOrderPanelState();

        // Delivery right panel functionality
        const deliveryPanel = document.getElementById('delivery-right-panel');
        const deliveryPanelToggle = document.getElementById('delivery-panel-toggle');

        // Function to show/hide delivery panel
        function toggleDeliveryPanel(show, collapsed = false) {
            if (!deliveryPanel || !mainContent) return;

            if (show) {
                deliveryPanel.classList.add('show');

                if (collapsed) {
                    deliveryPanel.classList.add('collapsed');
                    mainContent.classList.add('delivery-panel-collapsed');
                    mainContent.classList.remove('delivery-panel-active');
                } else {
                    deliveryPanel.classList.remove('collapsed');
                    mainContent.classList.add('delivery-panel-active');
                    mainContent.classList.remove('delivery-panel-collapsed');
                }
            } else {
                deliveryPanel.classList.remove('show', 'collapsed');
                mainContent.classList.remove('delivery-panel-active', 'delivery-panel-collapsed');
            }

            // Save state to localStorage
            if (show) {
                localStorage.setItem('scm.deliveryPanel.show', '1');
                localStorage.setItem('scm.deliveryPanel.collapsed', collapsed ? '1' : '0');
            } else {
                localStorage.setItem('scm.deliveryPanel.show', '0');
            }
        }

        // Restore delivery panel state from localStorage
        function restoreDeliveryPanelState() {
            const saved = localStorage.getItem('scm.deliveryPanel.show');
            const collapsedSaved = localStorage.getItem('scm.deliveryPanel.collapsed');

            // Only restore panel state if currently in delivery view
            const deliveryView = document.getElementById('delivery-view');
            if (saved === '1' && deliveryView && deliveryView.style.display !== 'none') {
                const isCollapsed = collapsedSaved === '1';
                toggleDeliveryPanel(true, isCollapsed);
            }
        }

        // Delivery panel toggle button functionality
        if (deliveryPanelToggle) {
            deliveryPanelToggle.addEventListener('click', function (e) {
                e.stopPropagation();

                if (!deliveryPanel.classList.contains('show')) {
                    // If panel is not shown, show it expanded
                    toggleDeliveryPanel(true, false);
                } else if (deliveryPanel.classList.contains('collapsed')) {
                    // If panel is collapsed, expand it
                    toggleDeliveryPanel(true, false);
                } else {
                    // If panel is expanded, collapse it
                    toggleDeliveryPanel(true, true);
                }
            });
        }

        // Delivery panel functionality
        function updateDeliveryPanelSelectionCount() {
            const checkedBoxes = document.querySelectorAll('#delivery-view tbody td .checkbox:checked');
            const count = checkedBoxes.length;
            const selectionCountElement = document.getElementById('delivery-panel-selection-count');
            if (selectionCountElement) {
                selectionCountElement.textContent = `${count}件選択中`;
            }
        }

        // Delivery panel input support
        const deliveryPanelCarrierSelect = document.getElementById('delivery-panel-carrier-select');
        const deliveryPanelTrackingInput = document.getElementById('delivery-panel-tracking-input');
        const deliveryPanelShippingDateInput = document.getElementById('delivery-panel-shipping-date');
        const deliveryPanelUpdateBtn = document.getElementById('delivery-panel-update-btn');
        const deliveryPanelShipBtn = document.getElementById('delivery-panel-ship-btn');

        // Set default date to today
        if (deliveryPanelShippingDateInput) {
            const today = new Date().toISOString().split('T')[0];
            deliveryPanelShippingDateInput.value = today;
        }

        // Update button functionality
        if (deliveryPanelUpdateBtn) {
            deliveryPanelUpdateBtn.addEventListener('click', function () {
                const checkedBoxes = document.querySelectorAll('#delivery-view tbody td .checkbox:checked');
                if (checkedBoxes.length === 0) {
                    alert('更新する納品を選択してください。');
                    return;
                }
                const carrier = deliveryPanelCarrierSelect ? deliveryPanelCarrierSelect.value : '';
                const tracking = deliveryPanelTrackingInput ? deliveryPanelTrackingInput.value : '';
                alert(`${checkedBoxes.length}件の納品を更新しました。\nキャリア: ${carrier}\n追跡番号: ${tracking}`);
            });
        }

        // Ship button functionality
        if (deliveryPanelShipBtn) {
            deliveryPanelShipBtn.addEventListener('click', function () {
                const checkedBoxes = document.querySelectorAll('#delivery-view tbody td .checkbox:checked');
                if (checkedBoxes.length === 0) {
                    alert('発送する納品を選択してください。');
                    return;
                }
                const shippingDate = deliveryPanelShippingDateInput ? deliveryPanelShippingDateInput.value : '';
                alert(`${checkedBoxes.length}件の納品を発送しました。\n出荷日: ${shippingDate}`);
            });
        }

        // Restore delivery panel state on page load
        restoreDeliveryPanelState();

        // Delivery panel toggle button in table-tools
        const deliveryPanelToggleBtn = document.getElementById('delivery-panel-toggle-btn');
        if (deliveryPanelToggleBtn) {
            deliveryPanelToggleBtn.addEventListener('click', function (e) {
                e.stopPropagation();

                if (!deliveryPanel.classList.contains('show')) {
                    // If panel is not shown, show it expanded
                    toggleDeliveryPanel(true, false);
                } else if (deliveryPanel.classList.contains('collapsed')) {
                    // If panel is collapsed, expand it
                    toggleDeliveryPanel(true, false);
                } else {
                    // If panel is expanded, collapse it
                    toggleDeliveryPanel(true, true);
                }
            });
        }

        // Tag-based input functionality
        function setupTagInput(containerId, inputId) {
            const container = document.getElementById(containerId);
            const input = document.getElementById(inputId);

            if (!container || !input) return;

            let tags = [];

            function createTag(text) {
                const tag = document.createElement('div');
                tag.className = 'tag';
                tag.innerHTML = `
                    <span class="tag-text" title="${text}">${text}</span>
                    <button type="button" class="tag-remove" aria-label="削除">×</button>
                `;

                const removeBtn = tag.querySelector('.tag-remove');
                removeBtn.addEventListener('click', () => {
                    const tagText = tag.querySelector('.tag-text').textContent;
                    tags = tags.filter(t => t !== tagText);
                    tag.remove();
                    updateContainerClass();
                });

                return tag;
            }

            function addTag(text) {
                text = text.trim();
                if (text && !tags.includes(text)) {
                    tags.push(text);
                    const tag = createTag(text);
                    container.insertBefore(tag, input);
                    updateContainerClass();
                }
            }

            function updateContainerClass() {
                if (tags.length > 0) {
                    container.classList.add('has-tags');
                } else {
                    container.classList.remove('has-tags');
                }
            }

            function parseInput(value) {
                // Split by comma, semicolon, or newline
                return value.split(/[,;\n]+/).map(s => s.trim()).filter(s => s);
            }

            // Backspace handling on keydown (keep immediate behavior)
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && input.value === '' && tags.length > 0) {
                    // Remove last tag when backspace is pressed on empty input
                    const lastTag = container.querySelector('.tag:last-of-type');
                    if (lastTag) {
                        const tagText = lastTag.querySelector('.tag-text').textContent;
                        tags = tags.filter(t => t !== tagText);
                        lastTag.remove();
                        updateContainerClass();
                    }
                }
            });

            // Use keyup for Enter and comma so IME composition is committed before reading input.value
            input.addEventListener('keyup', (e) => {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    const values = parseInput(input.value);
                    values.forEach(addTag);
                    input.value = '';
                }
            });

            input.addEventListener('blur', () => {
                if (input.value.trim()) {
                    const values = parseInput(input.value);
                    values.forEach(addTag);
                    input.value = '';
                }
            });

            input.addEventListener('paste', (e) => {
                e.preventDefault();
                const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                const values = parseInput(pastedText);
                values.forEach(addTag);
            });

            container.addEventListener('click', () => {
                input.focus();
            });

            // Public method to get all tags
            container.getTags = () => tags.slice();

            // Public method to clear all tags
            container.clearTags = () => {
                tags = [];
                container.querySelectorAll('.tag').forEach(tag => tag.remove());
            };

            // Public method to set tags
            container.setTags = (newTags) => {
                container.clearTags();
                newTags.forEach(addTag);
            };
        }

        // Search functionality for data tables
        function setupSearchFunctionality() {
            // Quotation view search
            const quotationSearchFields = {
                maker: document.getElementById('maker-search'),
                partNumber: document.getElementById('part-number-search'),
                jan: document.getElementById('jan-search'),
                scmCode: document.getElementById('scm-code-search')
            };

            // Order view search
            const orderSearchFields = {
                maker: document.getElementById('order-maker-search'),
                partNumber: document.getElementById('order-part-number-search'),
                jan: document.getElementById('order-jan-search'),
                scmCode: document.getElementById('order-scm-code-search')
            };

            // Delivery view search
            const deliverySearchFields = {
                maker: document.getElementById('delivery-maker-search'),
                partNumber: document.getElementById('delivery-part-number-search'),
                jan: document.getElementById('delivery-jan-search'),
                scmCode: document.getElementById('delivery-scm-code-search')
            };

            // Delivery done view search
            const deliveryDoneSearchFields = {
                maker: document.getElementById('delivery-done-maker-search'),
                partNumber: document.getElementById('delivery-done-part-number-search'),
                jan: document.getElementById('delivery-done-jan-search'),
                scmCode: document.getElementById('delivery-done-scm-code-search')
            };

            function filterTableRows(searchFields, tableSelector) {
                const table = document.querySelector(tableSelector);
                if (!table) return;

                const tbody = table.querySelector('tbody');
                if (!tbody) return;

                const rows = Array.from(tbody.querySelectorAll('tr.data-row'));

                rows.forEach(row => {
                    const cells = Array.from(row.querySelectorAll('td'));
                    const maker = cells[4]?.textContent.trim().toLowerCase() || '';
                    const partNumber = cells[6]?.textContent.trim().toLowerCase() || '';
                    const jan = cells[7]?.textContent.trim().toLowerCase() || '';
                    const scmCode = cells[3]?.textContent.trim().toLowerCase() || '';

                    // Handle maker tag-based search
                    let makerMatch = true;
                    if (searchFields.maker) {
                        const makerContainer = searchFields.maker.closest('.tag-input-container');
                        if (makerContainer && makerContainer.getTags) {
                            const makerTags = makerContainer.getTags();
                            if (makerTags.length > 0) {
                                makerMatch = makerTags.some(tag => maker.includes(tag.toLowerCase()));
                            }
                        } else if (searchFields.maker.value) {
                            // Fallback for non-tag inputs
                            makerMatch = maker.includes(searchFields.maker.value.toLowerCase());
                        }
                    }

                    // Handle part number tag-based search
                    let partNumberMatch = true;
                    if (searchFields.partNumber) {
                        const partNumberContainer = searchFields.partNumber.closest('.tag-input-container');
                        if (partNumberContainer && partNumberContainer.getTags) {
                            const partNumberTags = partNumberContainer.getTags();
                            if (partNumberTags.length > 0) {
                                partNumberMatch = partNumberTags.some(tag => partNumber.includes(tag.toLowerCase()));
                            }
                        } else if (searchFields.partNumber.value) {
                            // Fallback for non-tag inputs
                            partNumberMatch = partNumber.includes(searchFields.partNumber.value.toLowerCase());
                        }
                    }

                    // Handle JAN tag-based search
                    let janMatch = true;
                    if (searchFields.jan) {
                        const janContainer = searchFields.jan.closest('.tag-input-container');
                        if (janContainer && janContainer.getTags) {
                            const janTags = janContainer.getTags();
                            if (janTags.length > 0) {
                                janMatch = janTags.some(tag => jan.includes(tag.toLowerCase()));
                            }
                        } else if (searchFields.jan.value) {
                            // Fallback for non-tag inputs
                            janMatch = jan.includes(searchFields.jan.value.toLowerCase());
                        }
                    }

                    // Handle SCM code tag-based search
                    let scmCodeMatch = true;
                    if (searchFields.scmCode) {
                        const scmContainer = searchFields.scmCode.closest('.tag-input-container');
                        if (scmContainer && scmContainer.getTags) {
                            const scmTags = scmContainer.getTags();
                            if (scmTags.length > 0) {
                                scmCodeMatch = scmTags.some(tag => scmCode.includes(tag.toLowerCase()));
                            }
                        } else if (searchFields.scmCode.value) {
                            // Fallback for non-tag inputs
                            scmCodeMatch = scmCode.includes(searchFields.scmCode.value.toLowerCase());
                        }
                    }

                    if (makerMatch && partNumberMatch && janMatch && scmCodeMatch) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }

            // Add event listeners for quotation view search button
            const quotationSearchBtn = document.getElementById('quotation-search-btn');
            if (quotationSearchBtn) {
                quotationSearchBtn.addEventListener('click', () => {
                    filterTableRows(quotationSearchFields, '#quotation-view .data-table');
                    // Update pagination summary after search
                    setTimeout(() => updatePaginationSummary('pagination', 'quotation'), 100);
                });
            }

            // Add event listeners for order view search button
            const orderSearchBtn = document.getElementById('order-search-btn');
            if (orderSearchBtn) {
                orderSearchBtn.addEventListener('click', () => {
                    filterTableRows(orderSearchFields, '#order-view .data-table');
                    // Update pagination summary after search
                    setTimeout(() => updatePaginationSummary('order-pagination', 'order'), 100);
                });
            }

            // Add event listeners for delivery view search button
            const deliverySearchBtn = document.getElementById('delivery-search-btn');
            if (deliverySearchBtn) {
                deliverySearchBtn.addEventListener('click', () => {
                    filterTableRows(deliverySearchFields, '#delivery-wait-container .data-table');
                });
            }

            // Add event listeners for delivery done view search button
            const deliveryDoneSearchBtn = document.getElementById('delivery-done-search-btn');
            if (deliveryDoneSearchBtn) {
                deliveryDoneSearchBtn.addEventListener('click', () => {
                    filterTableRows(deliveryDoneSearchFields, '#delivery-done-container .data-table');
                });
            }

            // Initialize tag-based inputs for SCM code fields
            setupTagInput('scm-code-tag-container', 'scm-code-search');
            setupTagInput('order-scm-code-tag-container', 'order-scm-code-search');
            setupTagInput('delivery-scm-code-tag-container', 'delivery-scm-code-search');
            setupTagInput('delivery-done-scm-code-tag-container', 'delivery-done-scm-code-search');

            // Initialize tag-based inputs for maker fields
            setupTagInput('maker-tag-container', 'maker-search');
            setupTagInput('order-maker-tag-container', 'order-maker-search');
            setupTagInput('delivery-maker-tag-container', 'delivery-maker-search');
            setupTagInput('delivery-done-maker-tag-container', 'delivery-done-maker-search');

            // Initialize tag-based inputs for part number fields
            setupTagInput('part-number-tag-container', 'part-number-search');
            setupTagInput('order-part-number-tag-container', 'order-part-number-search');
            setupTagInput('delivery-part-number-tag-container', 'delivery-part-number-search');
            setupTagInput('delivery-done-part-number-tag-container', 'delivery-done-part-number-search');

            // Initialize tag-based inputs for JAN fields
            setupTagInput('jan-tag-container', 'jan-search');
            setupTagInput('order-jan-tag-container', 'order-jan-search');
            setupTagInput('delivery-jan-tag-container', 'delivery-jan-search');
            setupTagInput('delivery-done-jan-tag-container', 'delivery-done-jan-search');
        }

        // Initialize search functionality on page load
        document.addEventListener('DOMContentLoaded', setupSearchFunctionality);

        // Table sorting functionality
        function setupTableSort() {
            const tables = document.querySelectorAll('.data-table');

            tables.forEach(table => {
                const headers = table.querySelectorAll('th.sortable');

                headers.forEach(header => {
                    header.addEventListener('click', (e) => {
                        // Prevent sorting during resize
                        if (e.target.closest('.data-table th')?.style.cursor === 'col-resize') {
                            return;
                        }

                        const column = header.dataset.column;
                        if (!column) return;

                        const tbody = table.querySelector('tbody');
                        if (!tbody) return;

                        // Get current sort direction
                        const currentSort = header.classList.contains('sort-asc') ? 'asc' :
                            header.classList.contains('sort-desc') ? 'desc' : 'none';

                        // Clear all sort indicators in this table
                        table.querySelectorAll('th.sortable').forEach(th => {
                            th.classList.remove('sort-asc', 'sort-desc');
                        });

                        // Set new sort direction
                        let newSort;
                        if (currentSort === 'none' || currentSort === 'desc') {
                            newSort = 'asc';
                            header.classList.add('sort-asc');
                        } else {
                            newSort = 'desc';
                            header.classList.add('sort-desc');
                        }

                        // Get column index (accounting for checkbox and detail columns)
                        const headerIndex = Array.from(header.parentNode.children).indexOf(header);

                        // Get all rows (excluding details rows)
                        const rows = Array.from(tbody.querySelectorAll('tr.data-row')).map(row => {
                            // Also collect any following details row
                            const detailsRow = row.nextElementSibling;
                            const hasDetails = detailsRow && detailsRow.classList.contains('details-row');
                            return {
                                dataRow: row,
                                detailsRow: hasDetails ? detailsRow : null
                            };
                        });

                        // Sort rows based on column content
                        rows.sort((a, b) => {
                            const cellA = a.dataRow.children[headerIndex];
                            const cellB = b.dataRow.children[headerIndex];

                            if (!cellA || !cellB) return 0;

                            let valueA = cellA.textContent.trim();
                            let valueB = cellB.textContent.trim();

                            // Handle different data types
                            if (column.includes('date') && column !== 'delivery-date') {
                                // Date sorting (except delivery-date which contains status text)
                                valueA = new Date(valueA.replace(/\//g, '-'));
                                valueB = new Date(valueB.replace(/\//g, '-'));
                                if (isNaN(valueA)) valueA = new Date(0);
                                if (isNaN(valueB)) valueB = new Date(0);
                            } else if (column === 'delivery-date') {
                                // Delivery status sorting with priority order
                                const statusPriority = {
                                    '納期超過': 1,
                                    '手配中': 2,
                                    '手配済': 3,
                                    '在庫あり': 4,
                                    'BO': 5,
                                    '出荷待': 6,
                                    '出荷済': 7,
                                    '': 999 // Empty values last
                                };
                                valueA = statusPriority[valueA] || 999;
                                valueB = statusPriority[valueB] || 999;
                            } else if (column.includes('price') || column.includes('quantity')) {
                                // Numeric sorting
                                valueA = parseFloat(valueA.replace(/[¥,円]/g, '')) || 0;
                                valueB = parseFloat(valueB.replace(/[¥,円]/g, '')) || 0;
                            } else {
                                // String sorting (case insensitive)
                                valueA = valueA.toLowerCase();
                                valueB = valueB.toLowerCase();
                            }

                            let result = 0;
                            if (valueA < valueB) result = -1;
                            else if (valueA > valueB) result = 1;

                            return newSort === 'desc' ? -result : result;
                        });

                        // Clear tbody and re-append sorted rows
                        tbody.innerHTML = '';
                        rows.forEach(rowData => {
                            tbody.appendChild(rowData.dataRow);
                            if (rowData.detailsRow) {
                                tbody.appendChild(rowData.detailsRow);
                            }
                        });

                        // Re-attach event listeners
                        bindToggleButtons();

                        // Re-attach checkbox listeners if they exist
                        if (typeof initCheckboxListeners === 'function') {
                            initCheckboxListeners();
                        }
                    });
                });
            });
        }

        // Initialize table sorting on page load
        document.addEventListener('DOMContentLoaded', setupTableSort);

        // フィルターボタンのイベントリスナー
        document.querySelectorAll('.search-filter-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                // どのビューのフィルターボタンかを特定
                let additionalFiltersId = '';

                // 親要素をたどって、どのビューにあるボタンかを判定
                const quotationView = this.closest('#quotation-view');
                const orderView = this.closest('#order-view');
                const deliveryView = this.closest('#delivery-view');

                if (quotationView) {
                    additionalFiltersId = 'quotation-additional-filters';
                } else if (orderView) {
                    additionalFiltersId = 'order-additional-filters';
                } else if (deliveryView) {
                    additionalFiltersId = 'delivery-additional-filters';
                }

                if (additionalFiltersId) {
                    const additionalFilters = document.getElementById(additionalFiltersId);
                    if (additionalFilters) {
                        // 表示/非表示を切り替え
                        additionalFilters.classList.toggle('show');
                    }
                }
            });
        });

        // Enhanced Tag input functionality
        function setupEnhancedTagInput(containerId, statsId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const tagsDiv = container.querySelector('.enhanced-tags');
            const input = container.querySelector('.enhanced-tag-input');
            const clearAllBtn = container.querySelector('.clear-all-btn');
            const statsElement = document.getElementById(statsId);
            let tags = [];

            // Update statistics display
            function updateStats() {
                const statNumber = statsElement.querySelector('.stat-number');
                const statItem = statsElement.querySelector('.stat-item');

                statNumber.textContent = tags.length;
                statItem.classList.add('updated');
                setTimeout(() => statItem.classList.remove('updated'), 400);
                updateContainerClass();
            }

            // Update container class based on tag count
            function updateContainerClass() {
                if (tags.length > 0) {
                    container.classList.add('has-tags');
                } else {
                    container.classList.remove('has-tags');
                }
            }

            // Add tag function with validation
            function addTag(value) {
                const cleanValue = value.trim();
                if (cleanValue && !tags.includes(cleanValue)) {
                    tags.push(cleanValue);

                    const tag = document.createElement('span');
                    tag.className = 'enhanced-tag';
                    tag.innerHTML = `<span>${cleanValue}</span> <span class="remove" data-value="${cleanValue}">×</span>`;

                    const removeBtn = tag.querySelector('.remove');
                    removeBtn.addEventListener('click', function () {
                        const valueToRemove = this.getAttribute('data-value');
                        removeTag(valueToRemove);
                    });

                    tagsDiv.appendChild(tag);
                    updateStats();
                }
            }

            // Remove tag function
            function removeTag(value) {
                tags = tags.filter(tag => tag !== value);
                const tagElements = tagsDiv.querySelectorAll('.enhanced-tag');
                tagElements.forEach(tagElement => {
                    const removeBtn = tagElement.querySelector('.remove');
                    if (removeBtn && removeBtn.getAttribute('data-value') === value) {
                        tagElement.style.animation = 'tagSlideIn 0.3s ease reverse';
                        setTimeout(() => tagElement.remove(), 300);
                    }
                });
                updateStats();
            }

            // Clear all tags
            function clearAllTags() {
                tags = [];
                tagsDiv.innerHTML = '';
                updateStats();
            }

            // Process input value (split by various delimiters)
            function processInputValue(value) {
                const delimiters = /[,\s\n\t]+/;
                return value.split(delimiters)
                    .map(v => v.trim())
                    .filter(v => v.length > 0);
            }

            // Handle input events
            // Keep Backspace handling on keydown for immediate UX
            input.addEventListener('keydown', function (e) {
                const value = input.value.trim();
                if (e.key === 'Backspace' && !value && tags.length > 0) {
                    removeTag(tags[tags.length - 1]);
                }
            });

            // Use keyup for Enter so IME composition is committed before reading input.value
            input.addEventListener('keyup', function (e) {
                const value = input.value.trim();
                if ((e.key === 'Enter' || e.key === ',') && value) {
                    e.preventDefault();
                    const values = processInputValue(value);
                    values.forEach(v => addTag(v));
                    input.value = '';
                }
            });

            // Handle paste events
            input.addEventListener('paste', function (e) {
                e.preventDefault();
                const pastedText = (e.clipboardData || window.clipboardData).getData('text');
                const values = processInputValue(pastedText);
                values.forEach(v => addTag(v));
                input.value = '';
            });

            // Handle input blur (add remaining value)
            input.addEventListener('blur', function () {
                const value = input.value.trim();
                if (value) {
                    const values = processInputValue(value);
                    values.forEach(v => addTag(v));
                    input.value = '';
                }
            });

            // Clear all button
            if (clearAllBtn) {
                clearAllBtn.addEventListener('click', function (e) {
                    e.stopPropagation();
                    clearAllTags();
                });
            }

            // Return object with public methods
            return {
                getTags: () => tags.slice(),
                addTag: addTag,
                removeTag: removeTag,
                clearAll: clearAllTags,
                setTags: (newTags) => {
                    clearAllTags();
                    newTags.forEach(tag => addTag(tag));
                }
            };
        }

        // Initialize enhanced tag inputs for quotation view
        document.addEventListener('DOMContentLoaded', function () {
            // Setup enhanced tag inputs
            const partNumberTags = setupEnhancedTagInput('part-number-enhanced-tags', 'part-number-stats');
            const janTags = setupEnhancedTagInput('jan-enhanced-tags', 'jan-stats');
            const scmCodeTags = setupEnhancedTagInput('scm-code-enhanced-tags', 'scm-code-stats');

            // Make tag managers globally accessible for search functionality
            window.quotationTagManagers = {
                partNumber: partNumberTags,
                jan: janTags,
                scmCode: scmCodeTags
            };
        });

        // 遅延処理機能のJavaScript
        document.addEventListener('DOMContentLoaded', function () {
            const delayStatusRadios = document.querySelectorAll('input[name="delay-status"]');
            const delayDateInput = document.getElementById('delay-date-input');
            const delayReasonSelect = document.getElementById('order-panel-delay-reason');
            const delayProcessBtn = document.getElementById('order-panel-delay-btn');

            // ラジオボタンの変更で日付入力の表示/非表示を切り替え
            delayStatusRadios.forEach(radio => {
                radio.addEventListener('change', function () {
                    if (this.value === 'scheduled') {
                        delayDateInput.classList.add('show');
                    } else {
                        delayDateInput.classList.remove('show');
                    }
                    updateDelayButtonState();
                });
            });

            // 遅延理由選択時にボタンの状態を更新
            if (delayReasonSelect) {
                delayReasonSelect.addEventListener('change', updateDelayButtonState);
            }

            // 遅延処理ボタンの有効/無効を制御
            function updateDelayButtonState() {
                if (delayProcessBtn && delayReasonSelect) {
                    const reasonSelected = delayReasonSelect.value !== '';
                    delayProcessBtn.disabled = !reasonSelected;
                }
            }

            // 遅延処理ボタンのクリックイベント
            if (delayProcessBtn) {
                delayProcessBtn.addEventListener('click', function () {
                    const selectedRows = document.querySelectorAll('.data-table tbody tr input[type="checkbox"]:checked');
                    if (selectedRows.length === 0) {
                        alert('処理する行を選択してください。');
                        return;
                    }

                    const selectedStatus = document.querySelector('input[name="delay-status"]:checked').value;
                    const delayDate = document.getElementById('order-panel-delay-date').value;
                    const delayReason = delayReasonSelect.value;

                    let confirmMessage = `${selectedRows.length}件の遅延処理を実行しますか？\n\n`;
                    confirmMessage += `発送状況: ${selectedStatus === 'undecided' ? '未定' : '発送予定'}\n`;
                    if (selectedStatus === 'scheduled' && delayDate) {
                        confirmMessage += `発送予定日: ${delayDate}\n`;
                    }
                    confirmMessage += `遅延理由: ${delayReasonSelect.options[delayReasonSelect.selectedIndex].text}`;

                    if (confirm(confirmMessage)) {
                        // 実際の処理はここに実装
                        alert(`遅延処理が完了しました。\n処理件数: ${selectedRows.length}件`);

                        // フォームをリセット
                        document.getElementById('delay-status-undecided').checked = true;
                        delayDateInput.classList.remove('show');
                        document.getElementById('order-panel-delay-date').value = '';
                        delayReasonSelect.value = '';
                        updateDelayButtonState();
                    }
                });
            }

            // 初期状態でボタンを無効化
            updateDelayButtonState();
        });

        // クイックアクションのイベントリスナー
        document.addEventListener('DOMContentLoaded', function () {
            // 操作マニュアルボタン
            const helpBtn = document.querySelector('.quick-item[data-action="help"]');
            if (helpBtn) {
                helpBtn.addEventListener('click', function () {
                    window.open('http://163.43.233.167:8081/manual.pdf?releasedate=20231108', '_blank');
                });
            }

            // 設定ボタン
            const settingsBtn = document.querySelector('.quick-item[data-action="settings"]');
            if (settingsBtn) {
                settingsBtn.addEventListener('click', function () {
                    openSettingsModal();
                });
            }

            // ご意見・ご要望フォームボタン
            const feedbackBtn = document.querySelector('.quick-item[data-action="feedback"]');
            if (feedbackBtn) {
                feedbackBtn.addEventListener('click', function () {
                    window.open('https://docs.google.com/forms/d/e/1FAIpQLSe4CItoRdr4Frr5hhmJIAAjfEYHC7GIb-POOwKhAX1P-_wtSA/viewform', '_blank');
                });
            }
        });

        // ====== Settings Modal Functions ======
        // 納期項目のリスト
        const deliveryOptions = [
            '１日', '２日', '３日', '４日', '５日', '６日', '1週間',
            '８日', '９日', '10日', '11日', '12日', '13日', '2週間',
            '3週間', '1ヶ月', '1ヶ月半', '2ヶ月', '2ヶ月半', '3ヶ月',
            '3ヶ月半', '4ヶ月', '4ヶ月半', '5ヶ月', '5ヶ月半', '6ヶ月',
            '6ヶ月半', '7ヶ月', '7ヶ月半', '8ヶ月', '8ヶ月半', '9ヶ月',
            '9ヶ月半', '10ヶ月', '10ヶ月半', '11ヶ月', '11ヶ月半', '12ヶ月',
            '欠品中未定', '廃盤', '不明'
        ];

        // 配送会社のリスト
        const shippingCompanies = [
            'ヤマト運輸', '佐川急便', '福山通運', '西濃運輸', '日本郵便',
            '名鉄運輸', '日本通運', 'トナミ運輸', 'エスライン', '西濃シェンカー',
            '近物レックス', 'セイノースーパーエクスプレス', 'NXトランスポート', '和光運輸',
            'JPロジスティクス', 'DHL', 'FedEx', 'UPS', 'EMS', 'その他'
        ];

        // 入力支援項目のデフォルトリスト
        const defaultAssistanceItems = [
            '在庫確認中',
            '発注手配中',
            'メーカー確認中',
            '代替品提案',
            '納期調整中',
            '価格調整中',
            '仕様確認中',
            '廃盤商品',
            '特注対応',
            '見積作成中'
        ];

        // FAX送付先のデフォルトリスト
        const defaultFaxDestinations = [
            { company: '株式会社ABC商事', contact: '営業部　田中様' },
            { company: '△△物産株式会社', contact: '調達部　佐藤様' },
            { company: '○○製作所', contact: '資材部　鈴木様' },
            { company: '◇◇商工株式会社', contact: '購買部　山田様' },
            { company: '◆◆工業', contact: '仕入部　高橋様' }
        ];

        // CSV出力項目のデフォルトリスト
        const defaultCsvExportItems = [
            { name: 'Webike依頼日', enabled: true, order: 1 },
            { name: '商品名', enabled: true, order: 2 },
            { name: '商品番号', enabled: true, order: 3 },
            { name: '注文数', enabled: true, order: 4 },
            { name: '入荷数', enabled: false, order: 5 },
            { name: 'SCMコード', enabled: true, order: 6 },
            { name: '定価(税抜)', enabled: false, order: 7 },
            { name: '仕切価格(税抜)', enabled: false, order: 8 },
            { name: 'webike依頼日', enabled: true, order: 9 },
            { name: '出荷日', enabled: false, order: 10 },
            { name: '商品メーカー', enabled: false, order: 11 },
            { name: 'JAN', enabled: false, order: 12 },
            { name: '自社管理番号', enabled: false, order: 13 },
            { name: '見積担当', enabled: false, order: 14 },
            { name: '担当備考', enabled: false, order: 15 },
            { name: 'RC担当備考', enabled: false, order: 16 },
            { name: '商品タイプ', enabled: false, order: 17 },
            { name: '商品備考', enabled: false, order: 18 },
            { name: '定価(税込)', enabled: false, order: 19 },
            { name: '発送期限', enabled: false, order: 20 },
            { name: '見積期限', enabled: false, order: 21 },
            { name: '発注回答期限', enabled: false, order: 22 },
            { name: '納品倉庫', enabled: false, order: 23 },
            { name: '入荷予定', enabled: false, order: 24 }
        ];

        // FAX印刷設定のデフォルト値
        const defaultFaxPrintSettings = {
            enabled: false,
            senderInfo: {
                companyName: '',
                department: '',
                postalCode: '',
                address: '',
                tel: '',
                fax: ''
            }
        };

        // FAX送付先設定の取得
        function getFaxDestinations() {
            try {
                const saved = localStorage.getItem(FAX_DESTINATIONS_KEY);
                return saved ? JSON.parse(saved) : defaultFaxDestinations;
            } catch (e) {
                console.error('FAX送付先設定の読み込みエラー:', e);
                return defaultFaxDestinations;
            }
        }

        // FAX送付先設定の保存
        function saveFaxDestinations(destinations) {
            try {
                localStorage.setItem(FAX_DESTINATIONS_KEY, JSON.stringify(destinations));
            } catch (e) {
                console.error('FAX送付先設定の保存エラー:', e);
            }
        }

        // FAX送付先をレンダリング
        function renderFaxDestinations() {
            const container = document.getElementById('fax-destinations-list');
            if (!container) return;

            const destinations = getFaxDestinations();
            container.innerHTML = '';

            destinations.forEach((destination, index) => {
                const destinationItem = document.createElement('div');
                destinationItem.className = 'fax-destination-item';
                destinationItem.innerHTML = `
                    <div class="fax-destination-info">
                        <div class="company-name">${destination.company}</div>
                        <div class="contact-name">${destination.contact}</div>
                    </div>
                    <div class="fax-destination-actions">
                        <button type="button" onclick="editFaxDestination(${index})" class="btn-edit">編集</button>
                        <button type="button" onclick="deleteFaxDestination(${index})" class="btn-delete">削除</button>
                    </div>
                `;
                container.appendChild(destinationItem);
            });

            // FAX送付先プルダウンを更新
            updateFaxDestinationSelect();
        }

        // 新しいFAX送付先を追加
        function addFaxDestination() {
            const companyInput = document.getElementById('new-company-name');
            const contactInput = document.getElementById('new-contact-person');

            if (!companyInput || !contactInput) return;

            const company = companyInput.value.trim();
            const contact = contactInput.value.trim();

            if (!company || !contact) {
                alert('企業名と担当者の両方を入力してください。');
                return;
            }

            const destinations = getFaxDestinations();

            // 重複チェック
            const exists = destinations.some(dest =>
                dest.company === company && dest.contact === contact
            );

            if (exists) {
                alert('同じ企業名と担当者の組み合わせは既に登録されています。');
                return;
            }

            destinations.push({
                company: company,
                contact: contact
            });

            saveFaxDestinations(destinations);
            renderFaxDestinations();

            // フォームをクリア
            companyInput.value = '';
            contactInput.value = '';
        }

        // FAX送付先を編集
        function editFaxDestination(index) {
            const destinations = getFaxDestinations();
            const destination = destinations[index];

            if (!destination) return;

            const newCompany = prompt('企業名を入力してください:', destination.company);
            if (newCompany === null) return; // キャンセル

            const newContact = prompt('担当者を入力してください:', destination.contact);
            if (newContact === null) return; // キャンセル

            const company = newCompany.trim();
            const contact = newContact.trim();

            if (!company || !contact) {
                alert('企業名と担当者の両方を入力してください。');
                return;
            }

            // 重複チェック（自分自身は除外）
            const exists = destinations.some((dest, i) =>
                i !== index && dest.company === company && dest.contact === contact
            );

            if (exists) {
                alert('同じ企業名と担当者の組み合わせは既に登録されています。');
                return;
            }

            destinations[index].company = company;
            destinations[index].contact = contact;

            saveFaxDestinations(destinations);
            renderFaxDestinations();
        }

        // FAX送付先を削除
        function deleteFaxDestination(index) {
            const destinations = getFaxDestinations();
            const destination = destinations[index];

            if (!destination) return;

            if (confirm(`「${destination.company} - ${destination.contact}」を削除しますか？`)) {
                destinations.splice(index, 1);
                saveFaxDestinations(destinations);
                renderFaxDestinations();
            }
        }

        // FAX送付先プルダウンを更新
        function updateFaxDestinationSelect() {
            const select = document.getElementById('fax-destination');
            if (!select) return;

            const destinations = getFaxDestinations();

            // 既存のオプションをクリア（最初のデフォルトオプション以外）
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }

            // すべての送付先をオプションとして追加
            destinations.forEach((destination, index) => {
                const option = document.createElement('option');
                option.value = `dest-${index}`;
                option.textContent = `${destination.company} - ${destination.contact}`;
                select.appendChild(option);
            });
        }

        // ローカルストレージのキー
        const DELIVERY_OPTIONS_KEY = 'delivery-options-settings';
        const SHIPPING_COMPANIES_KEY = 'shipping-companies-settings';
        const INPUT_ASSISTANCE_KEY = 'input-assistance-settings';
        const FAX_DESTINATIONS_KEY = 'fax-destinations-settings';
        const CSV_EXPORT_ITEMS_KEY = 'csv-export-items-settings';
        const FAX_PRINT_KEY = 'fax-print-settings';

        let currentActiveTab = 'delivery-options'; // 現在アクティブなタブ

        // 設定モーダルを開く
        function openSettingsModal() {
            const modal = document.getElementById('settings-modal-backdrop');
            if (modal) {
                renderActiveTabContent();
                updateSettingsFooter();
                
                // FAX送付先設定タブまたはCSV出力項目設定タブまたはFAX印刷設定タブの場合は「すべて選択」ボタンを非表示、その他では表示
                const selectAllBtn = document.getElementById('settings-select-all-btn');
                if (selectAllBtn) {
                    if (currentActiveTab === 'fax-destinations' || currentActiveTab === 'csv-export-items' || currentActiveTab === 'fax-print') {
                        selectAllBtn.style.display = 'none';
                    } else {
                        selectAllBtn.style.display = '';
                    }
                }
                
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        // 設定モーダルを閉じる
        function closeSettingsModal() {
            const modal = document.getElementById('settings-modal-backdrop');
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        // アクティブなタブのコンテンツをレンダリング
        function renderActiveTabContent() {
            if (currentActiveTab === 'delivery-options') {
                renderDeliveryOptions();
            } else if (currentActiveTab === 'shipping-companies') {
                renderShippingCompanies();
            } else if (currentActiveTab === 'input-assistance') {
                renderInputAssistanceItems();
            } else if (currentActiveTab === 'fax-destinations') {
                renderFaxDestinations();
            } else if (currentActiveTab === 'csv-export-items') {
                renderCsvExportItems();
            } else if (currentActiveTab === 'fax-print') {
                renderFaxPrintSettings();
            }
            
            // フッターボタンを更新
            updateSettingsFooter();
        }

        // タブを切り替える
        function switchTab(tabId) {
            // タブボタンの状態を更新
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');

            // タブコンテンツの表示を更新
            document.querySelectorAll('.settings-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabId}-tab`).classList.add('active');

            // FAX送付先設定タブまたはCSV出力項目設定タブまたはFAX印刷設定タブの場合は「すべて選択」ボタンを非表示、その他では表示
            const selectAllBtn = document.getElementById('settings-select-all-btn');
            if (selectAllBtn) {
                if (tabId === 'fax-destinations' || tabId === 'csv-export-items' || tabId === 'fax-print') {
                    selectAllBtn.style.display = 'none';
                } else {
                    selectAllBtn.style.display = '';
                }
            }

            currentActiveTab = tabId;
            renderActiveTabContent();
        }

        // 設定モーダルのフッターを更新
        function updateSettingsFooter() {
            const footerActions = document.querySelector('.settings-footer-actions');
            if (!footerActions) return;

            if (currentActiveTab === 'csv-export-items') {
                // CSV出力項目設定の場合、専用ボタンを表示
                footerActions.innerHTML = `
                    <div class="csv-footer-actions">
                        <button type="button" id="csv-toggle-all-btn" onclick="toggleAllCsvExportItems()">すべて選択</button>
                    </div>
                    <button type="button" class="settings-cancel-btn" onclick="closeSettingsModal()">キャンセル</button>
                    <button type="button" class="settings-save-btn" onclick="saveSettings()">保存</button>
                `;
            } else {
                // その他のタブの場合、標準ボタンのみ表示
                footerActions.innerHTML = `
                    <button type="button" class="settings-cancel-btn" onclick="closeSettingsModal()">キャンセル</button>
                    <button type="button" class="settings-save-btn" onclick="saveSettings()">保存</button>
                `;
            }
        }

        // 納期項目をレンダリング
        function renderDeliveryOptions() {
            const container = document.getElementById('delivery-options-grid');
            if (!container) return;

            const savedSettings = getDeliveryOptionsSettings();
            container.innerHTML = '';

            deliveryOptions.forEach((option, index) => {
                const isChecked = savedSettings[option] !== false; // デフォルトはtrue

                const optionItem = document.createElement('div');
                optionItem.className = `delivery-option-item ${isChecked ? 'selected' : ''}`;
                optionItem.innerHTML = `
                    <input type="checkbox" class="delivery-option-checkbox" 
                           id="option-${index}" value="${option}" ${isChecked ? 'checked' : ''}>
                    <label class="delivery-option-label" for="option-${index}">${option}</label>
                `;

                // チェックボックスの変更イベント
                const checkbox = optionItem.querySelector('.delivery-option-checkbox');
                checkbox.addEventListener('change', function () {
                    if (this.checked) {
                        optionItem.classList.add('selected');
                    } else {
                        optionItem.classList.remove('selected');
                    }
                });

                // ラベルクリックでチェックボックスを切り替え
                const label = optionItem.querySelector('.delivery-option-label');
                label.addEventListener('click', function () {
                    checkbox.click();
                });

                container.appendChild(optionItem);
            });
        }

        // 配送会社項目をレンダリング
        function renderShippingCompanies() {
            const container = document.getElementById('shipping-companies-grid');
            if (!container) return;

            const savedSettings = getShippingCompaniesSettings();
            container.innerHTML = '';

            shippingCompanies.forEach((company, index) => {
                const isChecked = savedSettings[company] !== false; // デフォルトはtrue

                const optionItem = document.createElement('div');
                optionItem.className = `delivery-option-item ${isChecked ? 'selected' : ''}`;
                optionItem.innerHTML = `
                    <input type="checkbox" class="delivery-option-checkbox" 
                           id="company-${index}" value="${company}" ${isChecked ? 'checked' : ''}>
                    <label class="delivery-option-label" for="company-${index}">${company}</label>
                `;

                // チェックボックスの変更イベント
                const checkbox = optionItem.querySelector('.delivery-option-checkbox');
                checkbox.addEventListener('change', function () {
                    if (this.checked) {
                        optionItem.classList.add('selected');
                    } else {
                        optionItem.classList.remove('selected');
                    }
                });

                // ラベルクリックでチェックボックスを切り替え
                const label = optionItem.querySelector('.delivery-option-label');
                label.addEventListener('click', function () {
                    checkbox.click();
                });

                container.appendChild(optionItem);
            });
        }

        // 設定を取得
        function getDeliveryOptionsSettings() {
            try {
                const settings = localStorage.getItem(DELIVERY_OPTIONS_KEY);
                return settings ? JSON.parse(settings) : {};
            } catch (e) {
                console.error('設定の取得に失敗しました:', e);
                return {};
            }
        }

        // 設定を保存
        function saveDeliveryOptionsSettings(settings) {
            try {
                localStorage.setItem(DELIVERY_OPTIONS_KEY, JSON.stringify(settings));
                return true;
            } catch (e) {
                console.error('設定の保存に失敗しました:', e);
                return false;
            }
        }

        // 配送会社設定を取得
        function getShippingCompaniesSettings() {
            try {
                const settings = localStorage.getItem(SHIPPING_COMPANIES_KEY);
                return settings ? JSON.parse(settings) : {};
            } catch (e) {
                console.error('配送会社設定の取得に失敗しました:', e);
                return {};
            }
        }

        // 配送会社設定を保存
        function saveShippingCompaniesSettings(settings) {
            try {
                localStorage.setItem(SHIPPING_COMPANIES_KEY, JSON.stringify(settings));
                return true;
            } catch (e) {
                console.error('配送会社設定の保存に失敗しました:', e);
                return false;
            }
        }

        // 入力支援項目をレンダリング
        function renderInputAssistanceItems() {
            const container = document.getElementById('assistance-items-list');
            if (!container) return;

            const assistanceItems = getInputAssistanceItems();
            container.innerHTML = '';

            if (assistanceItems.length === 0) {
                container.innerHTML = '<div class="empty-assistance-message">入力支援項目がありません。上のフォームから項目を追加してください。</div>';
                return;
            }

            assistanceItems.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = `assistance-item ${!item.enabled ? 'disabled' : ''}`;
                itemElement.innerHTML = `
                    <input type="checkbox" class="assistance-item-checkbox" 
                           ${item.enabled ? 'checked' : ''} 
                           data-index="${index}">
                    <span class="assistance-item-text">${item.text}</span>
                `;

                // チェックボックスの変更イベント
                const checkbox = itemElement.querySelector('.assistance-item-checkbox');
                checkbox.addEventListener('change', function () {
                    const assistanceItems = getInputAssistanceItems();
                    assistanceItems[index].enabled = this.checked;
                    saveInputAssistanceItems(assistanceItems);

                    if (this.checked) {
                        itemElement.classList.remove('disabled');
                    } else {
                        itemElement.classList.add('disabled');
                    }
                    updateInputAssistanceSelects();
                });

                container.appendChild(itemElement);
            });
        }

        // 入力支援項目を取得
        function getInputAssistanceItems() {
            try {
                const items = localStorage.getItem(INPUT_ASSISTANCE_KEY);
                if (items) {
                    return JSON.parse(items);
                } else {
                    // デフォルト項目で初期化
                    const defaultItems = defaultAssistanceItems.map(text => ({
                        text: text,
                        enabled: true
                    }));
                    saveInputAssistanceItems(defaultItems);
                    return defaultItems;
                }
            } catch (e) {
                console.error('入力支援項目の取得に失敗しました:', e);
                return [];
            }
        }

        // 入力支援項目を保存
        function saveInputAssistanceItems(items) {
            try {
                localStorage.setItem(INPUT_ASSISTANCE_KEY, JSON.stringify(items));
                return true;
            } catch (e) {
                console.error('入力支援項目の保存に失敗しました:', e);
                return false;
            }
        }

        // 新しい入力支援項目を追加
        function addInputAssistanceItem(text) {
            if (!text.trim()) {
                alert('項目名を入力してください。');
                return false;
            }

            const assistanceItems = getInputAssistanceItems();

            // 重複チェック
            if (assistanceItems.some(item => item.text === text.trim())) {
                alert('この項目は既に存在します。');
                return false;
            }

            assistanceItems.push({
                text: text.trim(),
                enabled: true
            });

            if (saveInputAssistanceItems(assistanceItems)) {
                renderInputAssistanceItems();
                updateInputAssistanceSelects();
                return true;
            } else {
                alert('項目の追加に失敗しました。');
                return false;
            }
        }

        // 見積処理パネルの納期選択を更新
        function updateQuotationDeliverySelect() {
            const select = document.getElementById('quotation-delivery-select');
            if (!select) return;

            const savedSettings = getDeliveryOptionsSettings();

            // 既存のオプションをクリア（デフォルトオプション以外）
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }

            // 有効な納期項目のみを追加
            deliveryOptions.forEach(option => {
                if (savedSettings[option] !== false) { // デフォルトはtrue
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    select.appendChild(optionElement);
                }
            });
        }

        // 納品処理パネルの配送会社選択を更新
        function updateDeliveryCarrierSelect() {
            const select = document.getElementById('delivery-panel-carrier-select');
            if (!select) return;

            const savedSettings = getShippingCompaniesSettings();

            // 既存のオプションをクリア（デフォルトオプション以外）
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }

            // 有効な配送会社のみを追加
            shippingCompanies.forEach(company => {
                if (savedSettings[company] !== false) { // デフォルトはtrue
                    const optionElement = document.createElement('option');
                    optionElement.value = company;
                    optionElement.textContent = company;
                    select.appendChild(optionElement);
                }
            });
        }

        // 入力支援プルダウンを更新
        function updateInputAssistanceSelects() {
            // 見積処理パネルの入力支援
            const quotationAssistSelect = document.getElementById('quotation-assist-select');
            updateAssistanceSelect(quotationAssistSelect);

            // 受注処理パネルの入力支援
            const orderAssistSelect = document.getElementById('order-assist-select');
            updateAssistanceSelect(orderAssistSelect);

            // 受注処理モーダルの入力支援
            const orderPanelAssistSelect = document.getElementById('order-panel-assist-select');
            updateAssistanceSelect(orderPanelAssistSelect);
        }

        // 個別の入力支援プルダウンを更新
        function updateAssistanceSelect(selectElement) {
            if (!selectElement) return;

            const assistanceItems = getInputAssistanceItems();

            // 既存のオプションをクリア（デフォルトオプション以外）
            while (selectElement.children.length > 1) {
                selectElement.removeChild(selectElement.lastChild);
            }

            // 有効な項目のみを追加
            assistanceItems.forEach(item => {
                if (item.enabled) {
                    const optionElement = document.createElement('option');
                    optionElement.value = item.text;
                    optionElement.textContent = item.text;
                    selectElement.appendChild(optionElement);
                }
            });
        }

        // CSV出力項目を取得
        function getCsvExportItems() {
            try {
                const saved = localStorage.getItem(CSV_EXPORT_ITEMS_KEY);
                return saved ? JSON.parse(saved) : defaultCsvExportItems;
            } catch (error) {
                console.error('CSV出力項目の取得に失敗しました:', error);
                return defaultCsvExportItems;
            }
        }

        // CSV出力項目を保存
        function saveCsvExportItems(items) {
            try {
                localStorage.setItem(CSV_EXPORT_ITEMS_KEY, JSON.stringify(items));
            } catch (error) {
                console.error('CSV出力項目の保存に失敗しました:', error);
                alert('CSV出力項目の保存に失敗しました。');
            }
        }

        // CSV出力項目をレンダリング
        function renderCsvExportItems() {
            const container = document.getElementById('csv-export-items-list');
            if (!container) return;

            const items = getCsvExportItems();
            container.innerHTML = '';

            // 順番でソート
            const sortedItems = [...items].sort((a, b) => a.order - b.order);

            sortedItems.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = `csv-export-item ${item.enabled ? 'selected' : ''}`;
                itemElement.innerHTML = `
                    <input type="checkbox" class="csv-export-item-checkbox" 
                           ${item.enabled ? 'checked' : ''} 
                           data-item-name="${item.name}">
                    <label class="csv-export-item-label" for="csv-${index}">${item.name}</label>
                    <input type="number" class="csv-export-item-order" 
                           value="${item.order}" 
                           min="1" max="100" 
                           data-item-name="${item.name}"
                           ${!item.enabled ? 'disabled' : ''}>
                `;

                // チェックボックスのイベントリスナー
                const checkbox = itemElement.querySelector('.csv-export-item-checkbox');
                const orderInput = itemElement.querySelector('.csv-export-item-order');

                checkbox.addEventListener('change', function() {
                    const isChecked = this.checked;
                    itemElement.classList.toggle('selected', isChecked);
                    orderInput.disabled = !isChecked;

                    // データを更新
                    const currentItems = getCsvExportItems();
                    const itemIndex = currentItems.findIndex(i => i.name === item.name);
                    if (itemIndex !== -1) {
                        currentItems[itemIndex].enabled = isChecked;
                        saveCsvExportItems(currentItems);
                    }
                    
                    // トグルボタンのテキストを更新
                    updateCsvToggleButtonText();
                });

                // 順番入力のイベントリスナー
                orderInput.addEventListener('change', function() {
                    const newOrder = parseInt(this.value);
                    if (newOrder > 0) {
                        const currentItems = getCsvExportItems();
                        const itemIndex = currentItems.findIndex(i => i.name === item.name);
                        if (itemIndex !== -1) {
                            currentItems[itemIndex].order = newOrder;
                            saveCsvExportItems(currentItems);
                            // 再レンダリングして順番を更新
                            renderCsvExportItems();
                        }
                    }
                });

                container.appendChild(itemElement);
            });
            
            // トグルボタンのテキストを更新
            updateCsvToggleButtonText();
        }

        // CSV出力項目をすべて選択/解除をトグル
        function toggleAllCsvExportItems() {
            const items = getCsvExportItems();
            const allSelected = items.every(item => item.enabled);
            
            // 全て選択されていれば解除、そうでなければ選択
            const newState = !allSelected;
            items.forEach(item => {
                item.enabled = newState;
            });
            
            saveCsvExportItems(items);
            renderCsvExportItems();
            updateCsvToggleButtonText();
        }

        // CSV出力項目のトグルボタンのテキストを更新
        function updateCsvToggleButtonText() {
            const toggleBtn = document.getElementById('csv-toggle-all-btn');
            if (!toggleBtn) return;
            
            const items = getCsvExportItems();
            const allSelected = items.every(item => item.enabled);
            toggleBtn.textContent = allSelected ? 'すべて解除' : 'すべて選択';
        }

        // FAX印刷設定を取得
        function getFaxPrintSettings() {
            try {
                const saved = localStorage.getItem(FAX_PRINT_KEY);
                return saved ? JSON.parse(saved) : defaultFaxPrintSettings;
            } catch (e) {
                console.error('FAX印刷設定の読み込みエラー:', e);
                return defaultFaxPrintSettings;
            }
        }

        // FAX印刷設定を保存
        function saveFaxPrintSettings(settings) {
            try {
                localStorage.setItem(FAX_PRINT_KEY, JSON.stringify(settings));
            } catch (e) {
                console.error('FAX印刷設定の保存エラー:', e);
            }
        }

        // FAX印刷設定をレンダリング
        function renderFaxPrintSettings() {
            const settings = getFaxPrintSettings();
            
            // 有効/無効チェックボックスの状態を設定
            const enabledCheckbox = document.getElementById('fax-print-enabled');
            if (enabledCheckbox) {
                enabledCheckbox.checked = settings.enabled;
                
                // チェックボックス変更時の処理
                enabledCheckbox.addEventListener('change', function() {
                    toggleFaxSenderInfoSection(this.checked);
                });
            }

            // 送信元情報フィールドの値を設定
            const companyNameInput = document.getElementById('fax-company-name');
            const departmentInput = document.getElementById('fax-department');
            const postalCodeInput = document.getElementById('fax-postal-code');
            const addressInput = document.getElementById('fax-address');
            const telInput = document.getElementById('fax-tel');
            const faxInput = document.getElementById('fax-fax');

            if (companyNameInput) companyNameInput.value = settings.senderInfo.companyName;
            if (departmentInput) departmentInput.value = settings.senderInfo.department;
            if (postalCodeInput) postalCodeInput.value = settings.senderInfo.postalCode;
            if (addressInput) addressInput.value = settings.senderInfo.address;
            if (telInput) telInput.value = settings.senderInfo.tel;
            if (faxInput) faxInput.value = settings.senderInfo.fax;

            // 送信元情報セクションの初期状態を設定
            toggleFaxSenderInfoSection(settings.enabled);

            // 郵便番号の自動フォーマット
            if (postalCodeInput) {
                postalCodeInput.addEventListener('input', function() {
                    let value = this.value.replace(/[^0-9]/g, '');
                    if (value.length > 3) {
                        value = value.slice(0, 3) + '-' + value.slice(3, 7);
                    }
                    this.value = value;
                });
            }
        }

        // 送信元情報セクションの有効/無効を切り替え
        function toggleFaxSenderInfoSection(enabled) {
            const senderInfoSection = document.getElementById('fax-sender-info-section');
            if (senderInfoSection) {
                if (enabled) {
                    senderInfoSection.classList.add('enabled');
                } else {
                    senderInfoSection.classList.remove('enabled');
                }
            }
        }

        // FAX印刷設定を保存（設定モーダルの保存ボタン処理で使用）
        function saveFaxPrintSettingsFromForm() {
            const enabledCheckbox = document.getElementById('fax-print-enabled');
            const companyNameInput = document.getElementById('fax-company-name');
            const departmentInput = document.getElementById('fax-department');
            const postalCodeInput = document.getElementById('fax-postal-code');
            const addressInput = document.getElementById('fax-address');
            const telInput = document.getElementById('fax-tel');
            const faxInput = document.getElementById('fax-fax');

            if (!enabledCheckbox) return;

            const settings = {
                enabled: enabledCheckbox.checked,
                senderInfo: {
                    companyName: companyNameInput ? companyNameInput.value.trim() : '',
                    department: departmentInput ? departmentInput.value.trim() : '',
                    postalCode: postalCodeInput ? postalCodeInput.value.trim() : '',
                    address: addressInput ? addressInput.value.trim() : '',
                    tel: telInput ? telInput.value.trim() : '',
                    fax: faxInput ? faxInput.value.trim() : ''
                }
            };

            // 有効にする場合は会社名必須チェック
            if (settings.enabled && !settings.senderInfo.companyName) {
                alert('FAX印刷を有効にする場合、会社名は必須です。');
                return false;
            }

            saveFaxPrintSettings(settings);
            return true;
        }

        // 設定モーダルのイベントリスナー
        document.addEventListener('DOMContentLoaded', function () {
            const modal = document.getElementById('settings-modal-backdrop');
            const closeBtn = document.getElementById('settings-modal-close');
            const cancelBtn = document.getElementById('settings-cancel-btn');
            const saveBtn = document.getElementById('settings-save-btn');
            const selectAllBtn = document.getElementById('settings-select-all-btn');

            // タブ切り替え機能
            document.querySelectorAll('.settings-tab').forEach(tab => {
                tab.addEventListener('click', function () {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // モーダルを閉じる
            closeBtn?.addEventListener('click', closeSettingsModal);
            cancelBtn?.addEventListener('click', closeSettingsModal);

            // モーダル背景をクリックして閉じる
            modal?.addEventListener('click', function (e) {
                if (e.target === modal) {
                    closeSettingsModal();
                }
            });

            // 保存ボタン
            saveBtn?.addEventListener('click', function () {
                let success = true;

                if (currentActiveTab === 'delivery-options') {
                    const checkboxes = document.querySelectorAll('#delivery-options-grid .delivery-option-checkbox');
                    const settings = {};

                    checkboxes.forEach(checkbox => {
                        settings[checkbox.value] = checkbox.checked;
                    });

                    if (saveDeliveryOptionsSettings(settings)) {
                        updateQuotationDeliverySelect();
                    } else {
                        success = false;
                    }
                } else if (currentActiveTab === 'shipping-companies') {
                    const checkboxes = document.querySelectorAll('#shipping-companies-grid .delivery-option-checkbox');
                    const settings = {};

                    checkboxes.forEach(checkbox => {
                        settings[checkbox.value] = checkbox.checked;
                    });

                    if (saveShippingCompaniesSettings(settings)) {
                        updateDeliveryCarrierSelect();
                    } else {
                        success = false;
                    }
                } else if (currentActiveTab === 'input-assistance') {
                    // 入力支援設定は個別に保存されているので、ここでは特に処理不要
                    // すべて選択ボタンの状態をリセット
                    const selectAllBtn = document.getElementById('settings-select-all-btn');
                    if (selectAllBtn) {
                        selectAllBtn.textContent = 'すべて選択';
                    }
                } else if (currentActiveTab === 'fax-print') {
                    // FAX印刷設定を保存
                    if (!saveFaxPrintSettingsFromForm()) {
                        success = false;
                    }
                }

                if (success) {
                    closeSettingsModal();
                    alert('設定を保存しました。');
                } else {
                    alert('設定の保存に失敗しました。');
                }
            });

            // すべて選択/すべて解除
            selectAllBtn?.addEventListener('click', function () {
                if (currentActiveTab === 'input-assistance') {
                    const checkboxes = document.querySelectorAll('.assistance-item-checkbox');
                    const allChecked = Array.from(checkboxes).every(cb => cb.checked);

                    const assistanceItems = getInputAssistanceItems();
                    assistanceItems.forEach((item, index) => {
                        item.enabled = !allChecked;
                        const checkbox = document.querySelector(`[data-index="${index}"]`);
                        if (checkbox) {
                            checkbox.checked = !allChecked;
                            const itemElement = checkbox.closest('.assistance-item');
                            if (!allChecked) {
                                itemElement.classList.remove('disabled');
                            } else {
                                itemElement.classList.add('disabled');
                            }
                        }
                    });

                    saveInputAssistanceItems(assistanceItems);
                    updateInputAssistanceSelects();
                    this.textContent = allChecked ? 'すべて選択' : 'すべて解除';
                } else {
                    const activeGrid = currentActiveTab === 'delivery-options' ?
                        '#delivery-options-grid' : '#shipping-companies-grid';
                    const checkboxes = document.querySelectorAll(`${activeGrid} .delivery-option-checkbox`);
                    const allChecked = Array.from(checkboxes).every(cb => cb.checked);

                    checkboxes.forEach(checkbox => {
                        checkbox.checked = !allChecked;
                        const item = checkbox.closest('.delivery-option-item');
                        if (checkbox.checked) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }
                    });

                    this.textContent = allChecked ? 'すべて選択' : 'すべて解除';
                }
            });

            // 初期設定で見積処理パネルの納期選択と納品処理パネルの配送会社選択を更新
            updateQuotationDeliverySelect();
            updateDeliveryCarrierSelect();

            // CSV出力項目のボタンイベントリスナー
            const csvResetOrderBtn = document.getElementById('csv-reset-order-btn');
            const csvSelectAllBtn = document.getElementById('csv-select-all-btn');
            const csvDeselectAllBtn = document.getElementById('csv-deselect-all-btn');

            csvSelectAllBtn?.addEventListener('click', function() {
                selectAllCsvExportItems();
            });

            csvDeselectAllBtn?.addEventListener('click', function() {
                if (confirm('すべての項目を解除しますか？')) {
                    deselectAllCsvExportItems();
                }
            });

            // 入力支援項目追加ボタンのイベントリスナー
            const addAssistanceBtn = document.getElementById('add-assistance-btn');
            const newAssistanceInput = document.getElementById('new-assistance-item');

            if (addAssistanceBtn && newAssistanceInput) {
                addAssistanceBtn.addEventListener('click', function () {
                    const text = newAssistanceInput.value.trim();
                    if (addInputAssistanceItem(text)) {
                        newAssistanceInput.value = '';
                        renderInputAssistanceItems();
                        updateInputAssistanceSelects();
                    }
                });

                // エンターキーでも追加できるようにする
                newAssistanceInput.addEventListener('keypress', function (e) {
                    if (e.key === 'Enter') {
                        const text = this.value.trim();
                        if (addInputAssistanceItem(text)) {
                            this.value = '';
                            renderInputAssistanceItems();
                            updateInputAssistanceSelects();
                        }
                    }
                });
            }
        });

        // ====== FAX Modal Functions ======
        // FAXモーダルを開く
        function openFaxModal() {
            const modal = document.getElementById('fax-modal-backdrop');
            if (modal) {
                // 選択された行のデータを取得してFAXテンプレートに反映
                updateFaxTemplate();

                // 初期文字サイズを適用
                updateProductFontSize();
                updateDescriptionFontSize();

                // FAX送付先プルダウンを更新
                updateFaxDestinationSelect();

                // 宛先情報を更新
                updateFaxRecipient();

                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        // FAXモーダルを閉じる
        function closeFaxModal() {
            const modal = document.getElementById('fax-modal-backdrop');
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = '';
            }
        }

        // FAXテンプレートを更新
        function updateFaxTemplate() {
            const selectedRows = document.querySelectorAll('.data-table tbody tr.selected');
            const faxItemsTbody = document.getElementById('fax-items-tbody');

            if (faxItemsTbody && selectedRows.length > 0) {
                faxItemsTbody.innerHTML = '';

                selectedRows.forEach((row, index) => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length >= 3) {
                        const scmCode = cells[1] ? cells[1].textContent.trim() : '';
                        const itemName = cells[2] ? cells[2].textContent.trim() : '';
                        const quantity = cells[3] ? cells[3].textContent.trim() : '1';

                        // 品名から基本情報と説明を分離
                        const itemNameParts = itemName.split('商品番号：');
                        const baseItemName = itemNameParts[0].trim();

                        const faxRow = document.createElement('tr');
                        faxRow.innerHTML = `
                            <td>${index + 1}</td>
                            <td class="item-name size-medium editable-indicator" contenteditable="true">
                                ${baseItemName}<br>
                                商品番号：cat047　　JAN：<br>
                                定価(税込)：4,428円
                            </td>
                            <td class="item-description size-medium editable-indicator" contenteditable="true">
                                SCMコード：${scmCode}　前回：---　注文番号：W160530A0660<br>
                                【材質チェック】430・425・428・520・525・530・630【ケット大※圧延】エルダー・カードリング2.2mm, 2.9mm, 3.8mm※)・ガンメビ・プラ・プレスケート<br>
                                ※50%、60本チェーンの場合、リベットンの項目サングレＭ２で引っぺする便用してください。
                            </td>
                            <td class="quantity">${quantity}</td>
                        `;
                        faxItemsTbody.appendChild(faxRow);
                    }
                });
            }
        }

        // 宛先選択の変更処理
        function updateFaxRecipient() {
            const destinationSelect = document.getElementById('fax-destination');
            const recipientName = document.getElementById('fax-recipient-name');
            const recipientContact = document.getElementById('fax-recipient-contact');

            if (destinationSelect && recipientName && recipientContact) {
                const selectedOption = destinationSelect.options[destinationSelect.selectedIndex];
                if (selectedOption && selectedOption.value && selectedOption.value !== '') {
                    // 選択されたオプションのテキストから企業名と担当者を分離
                    const optionText = selectedOption.textContent;
                    const parts = optionText.split(' - ');

                    if (parts.length >= 2) {
                        recipientName.textContent = parts[0]; // 企業名
                        recipientContact.textContent = parts[1] + '様'; // 担当者名 + 様
                    } else {
                        recipientName.textContent = optionText;
                        recipientContact.textContent = 'ご担当者様';
                    }
                } else {
                    recipientName.textContent = 'デモンストレーション株式会社';
                    recipientContact.textContent = 'ご担当者様';
                }
            }
        }

        // 商品の文字サイズ変更処理
        function updateProductFontSize() {
            const fontSizeSelect = document.getElementById('fax-product-font-size');
            const productElements = document.querySelectorAll('.fax-table .item-name');

            if (fontSizeSelect && productElements.length > 0) {
                const selectedSize = fontSizeSelect.value;

                productElements.forEach(element => {
                    // 既存のサイズクラスを削除
                    element.classList.remove('size-small', 'size-medium', 'size-large');

                    // 新しいサイズクラスを追加
                    element.classList.add(`size-${selectedSize}`);
                });
            }
        }

        // 説明の文字サイズ変更処理
        function updateDescriptionFontSize() {
            const fontSizeSelect = document.getElementById('fax-description-font-size');
            const descriptionElements = document.querySelectorAll('.fax-table .item-description');

            if (fontSizeSelect && descriptionElements.length > 0) {
                const selectedSize = fontSizeSelect.value;

                descriptionElements.forEach(element => {
                    // 既存のサイズクラスを削除
                    element.classList.remove('size-small', 'size-medium', 'size-large');

                    // 新しいサイズクラスを追加
                    element.classList.add(`size-${selectedSize}`);
                });
            }
        }

        // FAXテンプレートのHTMLを取得してPDFとして新しいタブで表示
        function generateAndDisplayPdf() {
            const faxTemplate = document.getElementById('fax-template');
            if (!faxTemplate) {
                alert('FAXテンプレートが見つかりません。');
                return;
            }

            // FAXテンプレートのHTML内容を取得
            let templateHTML = faxTemplate.outerHTML;
            
            // PDF用にcontenteditable属性を削除し、編集関連のクラスも削除
            templateHTML = templateHTML
                .replace(/contenteditable="true"/g, '')
                .replace(/\seditable-indicator/g, '')
                .replace(/class="([^"]*)editable-indicator([^"]*)"/g, 'class="$1$2"')
                .replace(/class="\s*"/g, '');

            // PDF表示用のHTMLページを作成
            const pdfHTML = `
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAX見積依頼書</title>
    <style>
        body {
            font-family: "MS Gothic", "Helvetica", "Arial", sans-serif;
            margin: 0;
            padding: 20px;
            background: white;
            color: black;
        }
        
        .fax-template {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border: 1px solid #000;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .fax-header {
            text-align: center;
            padding: 10px;
            border-bottom: 1px solid #000;
        }
        
        .fax-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .fax-company-info,
        .fax-recipient-info {
            padding: 10px;
            border-bottom: 1px solid #000;
        }
        
        .fax-content {
            padding: 15px;
        }
        
        .fax-greeting {
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .fax-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }
        
        .fax-table th,
        .fax-table td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        
        .fax-table th {
            background-color: #f0f0f0;
            font-weight: bold;
            text-align: center;
        }
        
        .fax-table .item-name {
            min-width: 200px;
        }
        
        .fax-table .item-description {
            min-width: 150px;
        }
        
        .fax-table .quantity {
            text-align: center;
            width: 80px;
        }
        
        .fax-footer {
            padding: 10px;
            border-top: 1px solid #000;
            text-align: center;
        }
        
        @media print {
            body {
                margin: 0;
                padding: 10px;
            }
            .fax-template {
                border: none;
            }
        }
    </style>
</head>
<body>
    ${templateHTML}
    <div style="margin-top: 20px; text-align: center;">
        <button onclick="window.print()" style="padding: 10px 20px; font-size: 14px; background: #2563eb; color: white; border: none; border-radius: 5px; cursor: pointer;">印刷</button>
        <button onclick="window.close()" style="padding: 10px 20px; font-size: 14px; background: #6b7280; color: white; border: none; border-radius: 5px; cursor: pointer; margin-left: 10px;">閉じる</button>
    </div>
</body>
</html>`;

            // 新しいタブでPDFを表示
            const newTab = window.open('', '_blank');
            if (newTab) {
                newTab.document.write(pdfHTML);
                newTab.document.close();
            } else {
                alert('ポップアップがブロックされています。ブラウザの設定を確認してください。');
            }
        }

        // PDFを生成して手配中にする処理
        function generatePdfAndArrange() {
            const destinationSelect = document.getElementById('fax-destination');

            if (!destinationSelect || !destinationSelect.value) {
                alert('宛先を選択してください。');
                return;
            }

            // PDF生成と表示
            generateAndDisplayPdf();

            // 選択された行を手配中ステータスに変更
            const selectedRows = document.querySelectorAll('.data-table tbody tr.selected');
            selectedRows.forEach(row => {
                const statusCell = row.querySelector('td:nth-child(3)'); // ステータス列
                if (statusCell) {
                    statusCell.textContent = '手配中';
                    statusCell.className = 'status-processing';
                }
            });

            alert(`${destinationSelect.options[destinationSelect.selectedIndex].text} 宛のPDFを生成し、選択された案件を手配中に変更しました。`);
            closeFaxModal();
        }

        // PDF生成のみの処理
        function generatePdfOnly() {
            const destinationSelect = document.getElementById('fax-destination');

            if (!destinationSelect || !destinationSelect.value) {
                alert('宛先を選択してください。');
                return;
            }

            // PDF生成と表示
            generateAndDisplayPdf();

            alert(`${destinationSelect.options[destinationSelect.selectedIndex].text} 宛のPDFを生成しました。`);
            closeFaxModal();
        }

        // FAXモーダルのイベントリスナー
        document.addEventListener('DOMContentLoaded', function () {
            const faxModal = document.getElementById('fax-modal-backdrop');
            const faxCloseBtn = document.getElementById('fax-modal-close');
            const faxPdfArrangeBtn = document.getElementById('fax-pdf-arrange-btn');
            const faxPdfOnlyBtn = document.getElementById('fax-pdf-only-btn');
            const faxDestinationSelect = document.getElementById('fax-destination');

            // FAXモーダルを閉じる
            faxCloseBtn?.addEventListener('click', closeFaxModal);
            faxModal?.addEventListener('click', function (e) {
                if (e.target === faxModal) {
                    closeFaxModal();
                }
            });

            // PDF生成ボタンのイベント
            faxPdfArrangeBtn?.addEventListener('click', generatePdfAndArrange);
            faxPdfOnlyBtn?.addEventListener('click', generatePdfOnly);

            // 宛先選択変更時の処理
            faxDestinationSelect?.addEventListener('change', updateFaxRecipient);

            // 商品と説明の個別文字サイズ変更
            const productFontSizeSelect = document.getElementById('fax-product-font-size');
            const descriptionFontSizeSelect = document.getElementById('fax-description-font-size');
            productFontSizeSelect?.addEventListener('change', updateProductFontSize);
            descriptionFontSizeSelect?.addEventListener('change', updateDescriptionFontSize);

            // FAXボタンのクリックイベント
            const faxModalBtn = document.getElementById('fax-modal-btn');
            const orderFaxModalBtn = document.getElementById('order-fax-modal-btn');
            const orderDelayFaxModalBtn = document.getElementById('order-delay-fax-modal-btn');

            faxModalBtn?.addEventListener('click', openFaxModal);
            orderFaxModalBtn?.addEventListener('click', openFaxModal);
            orderDelayFaxModalBtn?.addEventListener('click', openFaxModal);

            // FAXテンプレートの編集機能を有効化
            enableFaxTemplateEditing();
        });

        // FAXテンプレートの編集機能を有効化する関数
        function enableFaxTemplateEditing() {
            // MutationObserverを使用してDOMの変更を監視
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === Node.ELEMENT_NODE) {
                                // 新しく追加された商品・説明テキストに編集機能を付与
                                attachEditingListeners(node);
                            }
                        });
                    }
                });
            });

            // FAXアイテムtbodyを監視
            const faxItemsTbody = document.getElementById('fax-items-tbody');
            if (faxItemsTbody) {
                observer.observe(faxItemsTbody, { childList: true, subtree: true });
                
                // 既存の要素にも編集機能を付与
                attachEditingListeners(faxItemsTbody);
            }
        }

        // 編集可能な要素にイベントリスナーを付与
        function attachEditingListeners(container) {
            const editableElements = container.querySelectorAll('.item-name[contenteditable="true"], .item-description[contenteditable="true"]');
            
            editableElements.forEach(element => {
                // フォーカス時の処理
                element.addEventListener('focus', function() {
                    this.dataset.originalContent = this.innerHTML;
                });

                // ブラー時の処理（フォーカスが外れた時）
                element.addEventListener('blur', function() {
                    // 内容が変更されたかチェック
                    if (this.innerHTML !== this.dataset.originalContent) {
                        console.log('内容が変更されました:', this.innerHTML);
                        // 必要に応じて変更の保存処理を追加
                        showEditNotification('編集内容が反映されました');
                    }
                });

                // Enterキーでの改行を制御
                element.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        // Shift+Enterで改行、Enterのみで編集完了
                        if (!e.shiftKey) {
                            e.preventDefault();
                            this.blur();
                        }
                    }
                    
                    // Escapeキーで編集をキャンセル
                    if (e.key === 'Escape') {
                        this.innerHTML = this.dataset.originalContent;
                        this.blur();
                    }
                });

                // ペースト時のフォーマット処理
                element.addEventListener('paste', function(e) {
                    e.preventDefault();
                    const paste = (e.clipboardData || window.clipboardData).getData('text/plain');
                    const selection = window.getSelection();
                    if (!selection.rangeCount) return;
                    
                    selection.deleteContents();
                    selection.getRangeAt(0).insertNode(document.createTextNode(paste));
                    selection.collapseToEnd();
                });
            });
        }

        // 編集通知を表示
        function showEditNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #10b981;
                color: white;
                padding: 12px 24px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                font-size: 14px;
                animation: slideInRight 0.3s ease-out;
            `;

            // アニメーション用のCSSを追加
            if (!document.querySelector('#edit-notification-styles')) {
                const style = document.createElement('style');
                style.id = 'edit-notification-styles';
                style.textContent = `
                    @keyframes slideInRight {
                        from {
                            transform: translateX(100%);
                            opacity: 0;
                        }
                        to {
                            transform: translateX(0);
                            opacity: 1;
                        }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(notification);

            // 3秒後に通知を削除
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
    </script>

    <script>
        // Logout functionality
        (function() {
            // ログアウトボタンのイベントリスナーを追加
            document.addEventListener('click', function(e) {
                if (e.target.closest('[data-action="logout"]')) {
                    e.preventDefault();
                    
                    // 確認ダイアログを表示
                    if (confirm('ログアウトしますか？')) {
                        // ログイン状態をクリア
                        localStorage.removeItem('isLoggedIn');
                        localStorage.removeItem('username');
                        
                        // ログイン画面に遷移
                        window.location.href = 'index.html';
                    }
                }
            });

            // ユーザー名表示の更新（ログインユーザー名を表示）
            const username = localStorage.getItem('username');
            if (username) {
                const userNameBtn = document.getElementById('user-name-btn');
                if (userNameBtn) {
                    userNameBtn.textContent = username;
                }
                
                // アバターの更新（ユーザー名の最初の文字を表示）
                const userAvatar = document.querySelector('.user-avatar');
                if (userAvatar && username.length > 0) {
                    userAvatar.textContent = username.charAt(0);
                }
            }
        })();
    </script>

    <!-- Settings Modal -->
    <div class="settings-modal-backdrop" id="settings-modal-backdrop">
        <div class="settings-modal">
            <div class="settings-modal-header">
                <h3 class="settings-modal-title">自社共通設定</h3>
                <button class="settings-modal-close" id="settings-modal-close">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="settings-tabs">
                <button class="settings-tab active" data-tab="delivery-options">見積納期マスタ</button>
                <button class="settings-tab" data-tab="shipping-companies">配送会社マスタ</button>
                <button class="settings-tab" data-tab="input-assistance">備考入力支援</button>
                <button class="settings-tab" data-tab="fax-print">FAX印刷</button>
                <button class="settings-tab" data-tab="fax-destinations">FAX送付先</button>
                <button class="settings-tab" data-tab="csv-export-items">CSV出力項目</button>
            </div>
            <div class="settings-modal-body">
                <!-- 納期項目設定タブ -->
                <div class="settings-tab-content active" id="delivery-options-tab">
                    <div class="settings-section">
                        <div class="settings-section-title">見積処理パネルで利用する納期項目を選択してください</div>
                        <div class="delivery-options-grid" id="delivery-options-grid">
                            <!-- 納期項目がここに動的に追加されます -->
                        </div>
                    </div>
                </div>

                <!-- 配送会社設定タブ -->
                <div class="settings-tab-content" id="shipping-companies-tab">
                    <div class="settings-section">
                        <div class="settings-section-title">納品処理パネルで利用する配送会社を選択してください</div>
                        <div class="delivery-options-grid" id="shipping-companies-grid">
                            <!-- 配送会社項目がここに動的に追加されます -->
                        </div>
                    </div>
                </div>

                <!-- 入力支援設定タブ -->
                <div class="settings-tab-content" id="input-assistance-tab">
                    <div class="settings-section">
                        <div class="settings-section-title">入力支援項目の設定</div>
                        <div class="input-assistance-controls">
                            <div class="add-item-section">
                                <div class="add-item-form">
                                    <input type="text" id="new-assistance-item" class="form-input"
                                        placeholder="新しい入力支援項目を入力してください">
                                    <button type="button" id="add-assistance-btn" class="btn btn-primary">追加</button>
                                </div>
                            </div>
                            <div class="assistance-items-list" id="assistance-items-list">
                                <!-- 入力支援項目がここに動的に追加されます -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FAX印刷設定タブ -->
                <div class="settings-tab-content" id="fax-print-tab">
                    <div class="settings-section">
                        <div class="settings-section-title">FAX印刷設定</div>
                        <div class="fax-print-enable-section">
                            <label class="fax-print-enable-label">
                                <input type="checkbox" id="fax-print-enabled" class="fax-print-enable-checkbox">
                                FAX印刷機能を有効にする
                            </label>
                        </div>
                    </div>
                    <div class="settings-section" id="fax-sender-info-section">
                        <div class="settings-section-title">送信元情報</div>
                        <div class="fax-sender-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fax-company-name" class="form-label">会社名 <span class="required-mark">*</span></label>
                                    <input type="text" id="fax-company-name" class="form-input" placeholder="会社名を入力">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fax-department" class="form-label">部署名</label>
                                    <input type="text" id="fax-department" class="form-input" placeholder="部署名を入力">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fax-postal-code" class="form-label">郵便番号</label>
                                    <input type="text" id="fax-postal-code" class="form-input" placeholder="000-0000" maxlength="8">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fax-address" class="form-label">住所</label>
                                    <input type="text" id="fax-address" class="form-input" placeholder="住所を入力">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fax-tel" class="form-label">TEL</label>
                                    <input type="text" id="fax-tel" class="form-input" placeholder="00-0000-0000">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="fax-fax" class="form-label">FAX</label>
                                    <input type="text" id="fax-fax" class="form-input" placeholder="00-0000-0000">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FAX送付先設定タブ -->
                <div class="settings-tab-content" id="fax-destinations-tab">
                    <div class="settings-section">
                        <div class="settings-section-title">FAX送付先の設定</div>
                        <div class="input-assistance-controls">
                            <div class="add-item-section">
                                <div class="fax-destination-form">
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label for="new-company-name">企業名</label>
                                            <input type="text" id="new-company-name" class="form-input"
                                                placeholder="企業名を入力してください">
                                        </div>
                                        <div class="form-group">
                                            <label for="new-contact-person">担当者</label>
                                            <input type="text" id="new-contact-person" class="form-input"
                                                placeholder="担当者名を入力してください">
                                        </div>
                                        <div class="form-group">
                                            <button type="button" id="add-fax-destination-btn" class="btn btn-primary"
                                                onclick="addFaxDestination()">追加</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="fax-destinations-list" id="fax-destinations-list">
                                <!-- FAX送付先がここに動的に追加されます -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CSV出力項目設定タブ -->
                <div class="settings-tab-content" id="csv-export-items-tab">
                    <div class="settings-section">
                        <div class="settings-section-title">CSV出力時の項目と順番を設定してください</div>
                        <div class="csv-export-controls">
                            <div class="csv-export-items-list" id="csv-export-items-list">
                                <!-- CSV出力項目がここに動的に追加されます -->
                            </div>
                            <div class="csv-export-actions">
                                <button class="btn btn-secondary" id="csv-select-all-btn">すべて選択</button>
                                <button class="btn btn-secondary" id="csv-deselect-all-btn">すべて解除</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="settings-modal-footer">
                <button class="settings-select-all-btn" id="settings-select-all-btn">すべて選択</button>
                <div class="settings-footer-actions">
                    <button class="settings-cancel-btn" id="settings-cancel-btn">キャンセル</button>
                    <button class="settings-save-btn" id="settings-save-btn">保存</button>
                </div>
            </div>
        </div>
    </div>

    <!-- FAX Modal -->
    <div class="fax-modal-backdrop" id="fax-modal-backdrop">
        <div class="fax-modal">
            <div class="fax-modal-header">
                <h3 class="fax-modal-title">FAX出力</h3>
                <button class="fax-modal-close" id="fax-modal-close">
                    <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="fax-modal-controls">
                <div class="fax-destination-field">
                    <label for="fax-destination">宛先</label>
                    <select id="fax-destination" class="fax-destination-select">
                        <option value="">宛先を選択してください</option>
                        <option value="demo-company">デモンストレーション株式会社</option>
                        <option value="test-corp">株式会社テスト</option>
                        <option value="sample-inc">サンプル工業株式会社</option>
                        <option value="example-co">エグザンプル商事株式会社</option>
                    </select>
                </div>
                <div class="fax-font-size-field">
                    <label for="fax-product-font-size">商品文字サイズ</label>
                    <select id="fax-product-font-size" class="fax-font-size-select">
                        <option value="small">小 (10px)</option>
                        <option value="medium" selected>中 (12px)</option>
                        <option value="large">大 (14px)</option>
                    </select>
                </div>
                <div class="fax-font-size-field">
                    <label for="fax-description-font-size">説明文字サイズ</label>
                    <select id="fax-description-font-size" class="fax-font-size-select">
                        <option value="small">小 (10px)</option>
                        <option value="medium" selected>中 (12px)</option>
                        <option value="large">大 (14px)</option>
                    </select>
                </div>
            </div>
            <div class="fax-modal-body">
                <div class="fax-template font-medium" id="fax-template">
                    <div class="fax-header">
                        <div class="fax-title">【見積依頼】</div>
                    </div>
                    <div class="fax-company-info">
                        FAX送信元（株式会社テスト）<br>
                        テスト部<br>
                        〒000-0000<br>
                        テスト県テスト市テスト町20-02-2<br>
                        TEL：000-000-0000　FAX：000-000-0000<br>
                        担当：SCM TEST
                    </div>
                    <div class="fax-recipient-info">
                        <span id="fax-recipient-name">デモンストレーション株式会社</span><br>
                        <span id="fax-recipient-contact">ご担当者様</span>
                    </div>
                    <div class="fax-content">
                        <div class="fax-greeting">
                            いつもお世話になっております。下記＞見積＞をお願いいたします。<br>
                            ※金額の変更がありましたらお知らせください。
                        </div>
                        <table class="fax-table">
                            <thead>
                                <tr>
                                    <th width="40">No.</th>
                                    <th>商品</th>
                                    <th>説明</th>
                                    <th width="60">数量</th>
                                </tr>
                            </thead>
                            <tbody id="fax-items-tbody">
                                <tr>
                                    <td>1</td>
                                    <td class="item-name editable-indicator" contenteditable="true">
                                        チェーンカップ＆カバー/レッド<br>
                                        商品番号：cat047　　JAN：<br>
                                        定価(税込)：4,428円
                                    </td>
                                    <td class="item-description editable-indicator" contenteditable="true">
                                        SCMコード：160530R02654　前回：---　注文番号：W160530A0660<br>
                                        【材質チェック】430・425・428・520・525・530・630【ケット大※圧延】エルダー・カードリング2.2mm, 2.9mm,
                                        3.8mm※)・ガンメビ・プラ・プレスケート<br>
                                        ※50%、60本チェーンの場合、リベットンの項目サングレＭ２で引っぺする便用してください。
                                    </td>
                                    <td class="quantity">1</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="fax-footer">
                    </div>
                </div>
                <div class="fax-action-buttons">
                    <button class="fax-pdf-arrange-btn" id="fax-pdf-arrange-btn">PDFを生成して手配中にする</button>
                    <button class="fax-pdf-only-btn" id="fax-pdf-only-btn">PDF生成のみ</button>
                </div>
            </div>
        </div>
    </div>

    </script>

</body>

</html>
